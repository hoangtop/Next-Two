"use strict";function FocusControllerProvider(a){function b(a,b){return!!angular.isFunction(b)&&(a.push(b),!0)}function c(a,b){var c=a.indexOf(b);return c>-1&&(a.splice(c,1),!0)}function d(a,c){return!!b(o,a)&&(a.order=c||0,o.sort(e),!0)}function e(a,b){return a.order-b.order}function f(a){return b(p,a)}function g(a){return c(o,a)}function h(a){return c(p,a)}function i(){return angular.copy(n)}var j=".focus-controller",k="group:",l=a.DEFAULT.DEPTH,m={},n=a.DEFAULT.KEY_MAP,o=[],p=[],q=!1;m[a.DEFAULT.DEPTH]=a.DEFAULT.GROUP,this.setInitialDepth=function(a){return l=a,this},this.setInitialGroupOfDepth=function(b,c){var d={};return void 0===c&&(c=b,b=a.DEFAULT.DEPTH),angular.isObject(c)?d=c:d[b]=c,angular.extend(m,d),this},this.setKeyMap=function(a){return angular.extend(n,a),this},this.getKeyMap=i,this.addBeforeKeydownHandler=d,this.addAfterKeydownHandler=f,this.removeBeforeKeydownHandler=g,this.removeAfterKeydownHandler=h,this.setFocusWhenDisabled=function(a){return q=a,this},this.isFocusWhenDisabled=function(){return q},this.$get=["$rootScope","$window","$document","$timeout","$animate","FocusUtil","nearestFocusableFinder",function(b,c,e,r,s,t,u){function v(a){var c,d,e;if(H){if(void 0===(c=t.getData(H).nextFocus[a]))return u.getNearest(H,a);if(c){if(0===c.indexOf(k))return c.replace(k,"");if(d=u.$$get(c),t.isVisible(d)&&(e=t.getData(d),(!e.disabled||q)&&t.getData(H).depth===e.depth))return d}return null}return C(L)||w()}function w(a,b){return C(K,a,b)||u.getInitial(D(a),E(b))}function x(a,b){var c;t.isFocusable(a=t.getElement(a))&&(c=t.getData(a),c.depth===I&&(A(a,"blurred",[b]),a===H&&(B(L,a),H=null)))}function y(a,b){var c;t.isFocusable(a=t.getElement(a))&&a!==H&&(c=t.getData(a),c.depth!==I||c.disabled&&!q||(H&&x(H,b),A(a,"focused",[b]),J=c.group,H=a))}function z(a,b){t.isFocusable(a=t.getElement(a))&&t.isVisible(a)?a!==H||t.getData(a).disabled?y(a,b):A(a,"selected",[b]):(a=C(L),a?y(a,b):y(a=w(),b))}function A(a,b,c){a&&jQuery(a).trigger(b,c)}function B(a,b,c,d){c=D(c),d=E(d),a[c]=a[c]||{},a[c][d]=b}function C(a,b,c){var d;return b=D(b),c=E(c),!t.isVisible(d=a[b]&&a[b][c])||t.getData(d).disabled&&!q?null:d}function D(a){return void 0===a?I:a}function E(a){return void 0===a?J:a}function F(a){return a?angular.isString(a)?u.$$get(a):a:H}function G(a,b,c){var d;t.isFocusable(a=t.getElement(a))&&(d=t.getData(a),d.disabled!==b&&(d.disabled=b,t.setData(a,d),c&&c(a)))}var H,I=l,J=m[l]||a.DEFAULT.GROUP,K={},L={},M={getCurrentDepth:function(){return I},getCurrentGroup:function(){return J},getCurrentFocusItem:function(){return H},setDepth:function(b,c,d){var e,f;return angular.isNumber(b)&&I!==b&&(e=!1===d?w(b,f=m[b]||a.DEFAULT.GROUP):C(L,b,f=c||m[b]||a.DEFAULT.GROUP)||w(b,f))&&(x(H),I=b,J=f,y(e)),this},setGroup:function(a){var b;return a&&J!==a&&(b=C(L,I,a)||w(I,a))&&(x(H),J=a,y(b)),this},focus:function(a,b){return y(F(a),b),this},blur:function(a,b){return x(F(a),b),this},select:function(a,b){return z(F(a),b),this},enable:function(a){return G(F(a),!1,function(a){s.removeClass(a,"disabled")}),this},disable:function(a){return G(F(a),!0,function(a){a===H&&x(H,jQuery.Event("disabled")),s.addClass(a,"disabled")}),this},addBeforeKeydownHandler:d,addAfterKeydownHandler:f,removeBeforeKeydownHandler:g,removeAfterKeydownHandler:h,getKeyMap:i,$$getNextFocusItem:v,$$getInitialFocusItem:w,$$setInitialFocusItem:function(a){var b;return t.isFocusable(a=t.getElement(a))&&(b=t.getData(a),b.initialFocus&&B(K,a,b.depth,b.group)),this}};return jQuery(c).on("load",function(a){r(function(){y(C(K),a)})}),e.on("keydown"+j,function(c){var d,e=c.keyCode||c.which||c.charCode;if(o.some(function(a){return!1===a({event:c,previousFocusedItem:C(L),currentFocusItem:H},M)}))return void b.$applyAsync();switch(e){case n.LEFT:d=v(a.DIRECTION.LEFT);break;case n.RIGHT:d=v(a.DIRECTION.RIGHT);break;case n.UP:d=v(a.DIRECTION.UP);break;case n.DOWN:d=v(a.DIRECTION.DOWN);break;case n.ENTER:z(H,c)}d&&(angular.isString(d)?M.setGroup(d):(x(H,c),y(d,c))),p.forEach(function(a){a({event:c,previousFocusedItem:C(L),currentFocusItem:H},M)}),b.$applyAsync()}),b.$on("$destroy",function(){e.off(j)}),M}]}function NearestFocusableFinderProvider(a,b){function c(a){var b=jQuery(a),c=b.offset();return{left:c.left,top:c.top,width:b.width(),height:b.height()}}var d={},e=[],f=a.DEFAULT.DISTANCE_CALCULATION_STRATEGY;d[a.DEFAULT.DISTANCE_CALCULATION_STRATEGY]=function(){function b(b,c){var d={x:b.left,y:b.top};switch(c){case a.DIRECTION.RIGHT:d.x+=b.width;case a.DIRECTION.LEFT:d.y+=b.height/2;break;case a.DIRECTION.DOWN:d.y+=b.height;case a.DIRECTION.UP:d.x+=b.width/2}return d}function c(b,c,d){switch(d){case a.DIRECTION.LEFT:return b.x>=c.x;case a.DIRECTION.RIGHT:return b.x<=c.x;case a.DIRECTION.UP:return b.y>=c.y;case a.DIRECTION.DOWN:return b.y<=c.y}return!1}var d={left:"right",right:"left",up:"down",down:"up"};return function(a,e,f){var g=b(a,f),h=b(e,d[f]);return c(g,h,f)?Math.sqrt(Math.pow(g.x-h.x,2)+Math.pow(g.y-h.y,2)):1/0}}(),this.registerDistanceCalculationStrategy=function(a,b,c){if(!1===c&&angular.isFunction(d[a]))throw new Error('The given name "'+a+'" is already registered. If you want to override it, please do not pass the third parameter.');return d[a]=b,this},this.useDistanceCalculationStrategy=function(b){return b?angular.isFunction(d[b])&&(f=b):f=a.DEFAULT.DISTANCE_CALCULATION_STRATEGY,this},this.getRegisteredDistanceCalculationStrategies=function(){return Object.keys(d)},this.getCurrentDistanceCalculationStrategy=function(){return f},this.addBeforeDistanceCalculationHandler=function(a){return!!angular.isFunction(a)&&(e.push(a),!0)},this.removeBeforeDistanceCalculationHandler=function(a){var b=e.indexOf(a);return b>-1&&(e.splice(b,1),!0)},this.$get=["$rootScope","$document","FocusUtil",function(g,h,i){var j,k=Array.prototype.slice,l={},m={getInitial:function(c,d){var e;return c=c||a.DEFAULT.DEPTH,d=d||a.DEFAULT.GROUP,Object.keys(l).some(function(a){var f=l[a],g=i.getData(f);return!i.isVisible(f)||g.disabled&&!b.isFocusWhenDisabled()||g.depth!==c||g.group!==d?void 0:(e=f,!0)}),e},getNearest:function(a,g){var h,j,k,m,n,o=1/0;return i.isFocusable(a=i.getElement(a))&&(n=i.getData(a))&&(k=c(a),Object.keys(l).forEach(function(p){var q=l[p],r=i.getData(q);if(q!==a&&i.isVisible(q)&&(!r.disabled||b.isFocusWhenDisabled())&&n.depth===r.depth){if(e.some(function(a){return!1===a(q)}))return;m=c(q),h=d[f](k,m,g),o>h&&(j=q,o=h)}})),j},$$put:function(a,b){var c;return i.isFocusable(a=i.getElement(a))&&(c=i.setData(a,b))&&(l[c]=i.getElement(a)),this},$$get:function(a){return l[a]},$$remove:function(a){var b,c;return angular.isString(a)||(a=i.getData(a)),a&&(b=a.name,(c=l[b])&&delete l[b]),c}};return window.MutationObserver&&(j=new MutationObserver(function(a){a.forEach(function(a){"childList"===a.type&&k.call(a.removedNodes).forEach(function(a){i.isElement(a)&&i.isFocusable(a)&&i.unbindEvent(m.$$remove(a))})})}),j.observe(h[0],{childList:!0,subtree:!0}),g.$on("$destroy",function(){j.disconnect()})),m}]}function ListItemLoaderProvider(a){function b(a){this.url=a.url,this.method=a.method||"JSONP",this.headers=a.headers,this.parameterNames=angular.extend({},e,a.parameterNames||{}),this.loadingCount=a.loadingCount,this.thresholdCount=a.thresholdCount,this.onGetTotalCount=a.getTotalCount||angular.noop,this.onGetItems=a.getItems||angular.identity,this.onBeforeLoad=a.onBeforeLoad||angular.noop,this.onAfterLoad=a.onAfterLoad||angular.noop,this.items=[],this.totalCount,this.loading=!1,this.offset=0,this.http,this.initiailzed=!1}function c(a,b,c){var d=0,e=[];for(b=b||0,c=c||a.length;c>b;)e[d++]=a[b++];return e}var d={},e={page:"page",offset:"offset",count:"count",callback:"callback"};a.addBeforeKeydownHandler(function(){return!Object.keys(d).some(function(a){return!!d[a].isLoading()||void 0})&&void 0},-1e3),b.prototype.isInitialized=function(){return this.initiailzed},b.prototype.isLoading=function(){return this.loading},b.prototype.getTotalCount=function(){return this.totalCount},b.prototype.getCurrentCount=function(){return this.items.length},b.prototype.getLoadingCount=function(){return this.loadingCount},b.prototype.setLoadingCount=function(a){return this.loadingCount||(this.loadingCount=a),this},b.prototype.getThresholdCount=function(){return this.thresholdCount},b.prototype.setThresholdCount=function(a){return this.thresholdCount||(this.thresholdCount=a),this},b.prototype.getOffset=function(){return this.offset},b.prototype.setOffset=function(a){return this.offset=a,this},b.prototype.setHttp=function(a){return this.http=a,this},b.prototype.initialize=function(a){this.initiailzed||this.loading||this.request(function(b,c,d){if(this.append(b),this.offset+=this.loadingCount,this.totalCount=this.onGetTotalCount(c,d),null==this.totalCount)throw new Error('Check the "getTotalCount" callback function. It should return total item count as a number.');this.initiailzed=!0,(a||angular.noop)(b,this.totalCount,c,d,this)}.bind(this))},b.prototype.beforeRequest=function(){this.loading=!0,this.onBeforeLoad(this)},b.prototype.afterRequest=function(a,b){if(this.onAfterLoad(a,b,this),this.loading=!1,!this.initiailzed)throw new Error("Fail to request. Please check the given url or connection.")},b.prototype.request=function(a){this.loading||(this.beforeRequest(),this.http({url:this.url,method:this.method,headers:this.headers,params:this.getParams()}).success(function(b,c){var d=this.onGetItems(b);d&&d.length>0&&(a||angular.noop)(d,b,c,this),this.afterRequest(b,c)}.bind(this)).error(function(a,b){this.afterRequest(a,b)}.bind(this)))},b.prototype.getParams=function(){var a={};return a[this.parameterNames.page]=Math.floor(this.offset/this.loadingCount)+1,a[this.parameterNames.offset]=this.offset,a[this.parameterNames.count]=this.loadingCount,a[this.parameterNames.callback]="JSON_CALLBACK",a},b.prototype.isNeededForPrevious=function(a){var b=this.offset-2*this.loadingCount;return b>0&&a<b+this.thresholdCount},b.prototype.isNeededForNext=function(a){var b=this.getCurrentCount();return b<this.getTotalCount()&&b-this.thresholdCount<a},b.prototype.get=function(a){if(!this.initiailzed)throw new Error("Do not ready to use. Please use after initializing properly. Also verify whether the given url is available or not.");return this.items[a]},b.prototype.prepend=function(a){var b;this.offset>0&&(b=[],b.length=this.offset-2*this.loadingCount,this.items=b.concat(a).concat(c(this.items,this.offset-this.loadingCount,this.offset)))},b.prototype.append=function(a){var b,d;this.offset>this.loadingCount?(d=this.offset-this.loadingCount,b=[],b.length=d,this.items=b.concat(c(this.items,d)).concat(a)):this.items=this.items.concat(a)},this.register=function(a,c){if(d[a])throw new Error("The given name "+a+" already has been registered.");return d[a]=new b(c||{}),this},this.unregister=function(a){return delete d[a],this},this.$get=["$http",function(a){return{get:function(b){var c=d[b];return c&&!c.isInitialized()&&c.setHttp(a),c}}}]}function registerKeys(){["0","ChannelUp","ChannelDown"].forEach(function(keyName){tizen.tvinputdevice.registerKey(keyName)})}function Controller($rootScope,$scope,$state,$timeout,$document,FocusUtil,FocusConstant,focusController,CONSTANT,DataService,$http,UltilService,VideoService,Principal,LoginService,Auth,toaster,$interval,localStorageService){function main(){setInternetConnectionTimer(),processKeydownEvent(),$timeout(function(){DataService.getChannelList().then(function(channelList){allChannelList=channelList,$scope.allChannelList=channelList,updateCategoryListData(channelList,0,!0),(isChannelListLoaded=!0)&&isVodListLoaded&&isSeriesVodLoaded&&isGotSpotlight&&onInitCompleted()},function(response){}),DataService.getMenuCategories().then(function(menus){$scope.menuArray=menus,noCategoryInHome=menus[0].children.length;for(var homeCategoryNameList=[],index=1;index<menus[0].children.length;index++){var menuItem=menus[0].children[index];homeCategoryNameList.push({index:index,name:menuItem.this.name[0].text})}$scope.homeCategoryNameList=homeCategoryNameList;for(var index=1;index<menus[0].children.length;index++){var menuItem=menus[0].children[index];UltilService.isSeriesCategory(menuItem)?processSeriesVODList(index,menuItem,UltilService.getVodCategoryId(menuItem)):processVODList(menuItem,index)}$scope.focusedMenu=menus[0]},function(){}),processSpotlightVodList()},CONSTANT.EFFECT_DELAY_TIME)}function onPlayerPointerSelect(){}function setInternetConnectionTimer(){setInterval(function(){isOnline=navigator.onLine,isOnline?lastOnlineStatus||(lastOnlineStatus=!0,$timeout(function(){$scope.warning.show=!1},300)):(lastOnlineStatus=!1,showNetworkDisconnectedWarning())},1500)}function processSpotlightVodList(){isGotSpotlight||DataService.getSpotlightContents().then(function(spotlightVodList){var intervalIndex=0;$scope.spotlightVodList=spotlightVodList,spotlightVodList[0].isSpotlight=!0,currentSpotlight=spotlightVodList[0],setSpotlightPackground(spotlightVodList[0].bigPhotoUrl),$scope.spotlightOverview=spotlightVodList[0],$scope.lastOverview=$scope.spotlightOverview,intervalIndex++;var firstRound=$interval(function(){$scope.currentDepthZone===$scope.DEPTH_ZONE.INDEX.SPOTLIGHT&&$timeout(function(){spotlightVodList[intervalIndex].isSpotlight=!0,currentSpotlight=spotlightVodList[intervalIndex],setSpotlightPackground(spotlightVodList[intervalIndex].bigPhotoUrl),$scope.spotlightOverview=spotlightVodList[intervalIndex],$scope.lastOverview=$scope.spotlightOverview,intervalIndex<spotlightVodList.length-1?intervalIndex++:($interval.cancel(firstRound),intervalIndex=0,$interval(function(){$scope.currentDepthZone===$scope.DEPTH_ZONE.INDEX.SPOTLIGHT&&$timeout(function(){spotlightVodList[intervalIndex].isSpotlight=!0,currentSpotlight=spotlightVodList[intervalIndex],setSpotlightPackground(spotlightVodList[intervalIndex].bigPhotoUrl),$scope.spotlightOverview=spotlightVodList[intervalIndex],$scope.lastOverview=$scope.spotlightOverview,intervalIndex<spotlightVodList.length-1?intervalIndex++:($interval.cancel(firstRound),intervalIndex=0)},400)},15e3))},0)},100);focusController.focus("btnView"),isGotSpotlight=!0,isChannelListLoaded&&isVodListLoaded&&isSeriesVodLoaded&&isGotSpotlight&&onInitCompleted()},function(){})}function processVODList(menuItem,index){DataService.getVodListByCategoryId(UltilService.getVodCategoryId(menuItem)).then(function(response){var vodList=response;vodList&&(updateCategoryListData(vodList,index,!0),isVodListLoaded=!0,isChannelListLoaded&&isVodListLoaded&&isSeriesVodLoaded&&isGotSpotlight&&onInitCompleted())},function(response){setTimeout(function(){processVODList(menuItem,index)},200)})}function onInitCompleted(){setTimeout(function(){$scope.isInitCompleted=!0,setMenuFocusedPackground(),$scope.dataCategory[1][0]&&setVodDetailPackground($scope.dataCategory[1][0].bigPhotoUrl)},1e3)}function processSeriesVODList(index,menuItem,categoryId){DataService.getSeriesVodList(categoryId,16).then(function(response){var seriesVodList=response;seriesVodList&&(updateCategoryListData(seriesVodList,index,!0),isSeriesVodLoaded=!0,isChannelListLoaded&&isVodListLoaded&&isSeriesVodLoaded&&isGotSpotlight&&onInitCompleted())},function(response){setTimeout(function(){processSeriesVODList(index,menuItem,categoryId)},200)})}function onScrollStart(){isScrolling=!0}function onScrollFinish(){isScrolling=!1,updateOverview()}function onVodFocused($event,category,data,$index){if(currentCategoryInHome=category,$scope.currentDepth===$scope.DEPTH.INDEX){$scope.episodePlaylist=[],$scope.currentDetailRelatedList=null,$scope.currentDetailEpisodeList=null,$scope.currentDepthZone=$scope.DEPTH_ZONE.INDEX.CATEGORY;var scrollCount=category;if(moveContainer(category,"list-category",-CONSTANT.SCROLL_HEIGHT_OF_INDEX*scrollCount+160),removeFadeoutUpClassToCurrentSlider(),addFadeoutUpClassToPrevSlider(),$scope.isForceSpotlightHide=!0,$scope.isForceChannelInfoShown=!1,!data||!data||!1===data.loaded)return;currentItemData=data,(void 0===$scope.currentDetailOverview||null===$scope.currentDetailOverview||void 0!==$scope.currentDetailOverview&&data.program.id!==$scope.currentDetailOverview.program.id)&&($scope.isVodShown=!0,$scope.isVodMaskSlow=!1,setVodDetailPackground(currentItemData.bigPhotoUrl),$scope.isSpotlightShown=!1),$scope.currentDetailOverview=null,!1===isScrolling&&updateOverview(),$scope.currentOverview=$scope.overview,lastFocusedGroup=FocusUtil.getData($event.currentTarget).group}}function onRelatedVodFocused($event,category,data,$index){$scope.bgGradient1=CONSTANT.CATEGORY_BG_GRADIENT1,$scope.bgGradient2=CONSTANT.CATEGORY_BG_GRADIENT2,$scope.bgSize=CONSTANT.CATEGORY_BG_SIZE,currentItemData=data,setVodDetailPackground(currentItemData.bigPhotoUrl),$scope.isSpotlightShown=!1,$scope.isVodShown=!0,!1===isScrolling&&updateOverview()}function onCategoryVodFocused($event,data,element,$index){if(data&&data&&!1!==data.loaded){$scope.isVodCategoryOpened=!0,$scope.isForceChannelInfoShown=!1,currentItemData=data,currentItemData.isChannel||($scope.currentDepthZone=$scope.DEPTH_ZONE.CATEGORY.VOD),currentItemData.isChannel?$scope.channelOverview=currentItemData:$scope.overview=currentItemData;var itemHeight,vodList=$scope.selectedSidebarCategory.vodListByCategory,showElements=$(".category-vod-item:not(.item-fadeout)"),hideElements=$(".category-vod-item.item-fadeout"),isItemInView=!1,isItemBeforeView=!1,isItemAfterView=!1,isLoadMoreItems=!1,noItemPerRow=8,noItemInView=2;$scope.currentDepthZone===$scope.DEPTH_ZONE.CATEGORY.VOD?(noItemPerRow=8,itemHeight=307,noItemInView=2):(noItemPerRow=5,itemHeight=177,noItemInView=3);for(var currentRowCount=Math.floor($index/noItemPerRow),index=0;index<noItemPerRow*noItemInView;index++)showElements[index]&&showElements[index].id==="category-vod-item-"+$index&&(isItemInView=!0);for(var index=0;index<hideElements.length;index++)hideElements[index].id==="category-vod-item-"+$index&&(isItemBeforeView=!0);if(isItemInView||isItemBeforeView||(isItemAfterView=!0),$scope.currentDepthZone===$scope.DEPTH_ZONE.CATEGORY.VOD&&vodList.length-$index<=noItemPerRow&&vodList.length-$index>0&&isItemAfterView&&(isLoadMoreItems=!0),isLoadMoreItems)getMoreVodsInCategory(function(){moveCategoryVodContainer($scope.currentDepthZone===$scope.DEPTH_ZONE.CATEGORY.VOD?-(currentRowCount-1)*itemHeight-5:-(currentRowCount-2)*(itemHeight+7));for(var index=0;index<noItemPerRow;index++){var ele=showElements[index];$(ele).addClass("item-fadeout")}});else if(isItemAfterView&&!isLoadMoreItems){moveCategoryVodContainer($scope.currentDepthZone===$scope.DEPTH_ZONE.CATEGORY.VOD?-(currentRowCount-1)*itemHeight-5:-(currentRowCount-2)*(itemHeight+7));for(var index=0;index<noItemPerRow;index++){var ele=showElements[index];$(ele).addClass("item-fadeout")}}else if(isItemBeforeView){moveCategoryVodContainer(-currentRowCount*(itemHeight+7));for(var index=$index-$index%noItemPerRow;index<$index-$index%noItemPerRow+noItemPerRow;index++){var ele=$("#category-vod-item-"+index);ele.removeClass("item-fadeout")}}$scope.isMenuShown=!0,$scope.isVodShown=!1,setMenuFocusedPackground("images/menu_bg_focused_"+$scope.selectedCategoryMenuIndex+".jpg"),$scope.currentOverview=currentItemData,lastFocusedGroup=FocusUtil.getData($event.currentTarget).group,currentItemData.isChannel?lastCategoryChannelFocusedGroup=FocusUtil.getData($event.currentTarget).group:lastCategoryVodFocusedGroup=FocusUtil.getData($event.currentTarget).group}}function onEpisodeVodFocused($event,category,data,$index){data&&data.item&&!1!==data.item.loaded&&($scope.bgGradient1=CONSTANT.CATEGORY_BG_GRADIENT1,$scope.bgGradient2=CONSTANT.CATEGORY_BG_GRADIENT2,$scope.bgSize=CONSTANT.CATEGORY_BG_SIZE,currentItemData=data.item,$timeout(function(){$scope.bgImgCoverOpacity=0,$scope.bgImgUrl=currentItemData.photoUrl},400),!1===isScrolling&&updateOverview())}function onCategoryMenuFocused($event,category,data,$index){if($scope.currentDepth===$scope.DEPTH.INDEX){if($scope.currentDepthZone=$scope.DEPTH_ZONE.INDEX.CATEGORY,moveToCategoryMenu(),!data||!data.item||!1===data.item.loaded)return;currentItemData=data.item,$scope.focusedMenu=currentItemData,$scope.sidebarCategories=data.item.children,setMenuFocusedPackground("images/menu_bg_focused_"+$index+".jpg"),$scope.isSpotlightShown=!1,$scope.isVodShown=!1,$scope.isMenuShown=!0,$scope.isForceSpotlightHide=!1,$scope.isVodMaskSlow=!0,lastCategoryVodFocusedGroup="",lastCategoryChannelFocusedGroup="",lastFocusedGroup=FocusUtil.getData($event.currentTarget).group,categoryMenuFocusedGroup=FocusUtil.getData($event.currentTarget).group}}function onChannelFocused($event,category,data,$index){if($scope.currentDepth===$scope.DEPTH.INDEX){$scope.currentDepthZone=$scope.DEPTH_ZONE.INDEX.CHANNEL;if(removeFadeoutUpClassToCurrentSlider(),$scope.isForceSpotlightHide=!0,$scope.isSpotlightShown=!1,$scope.isChannelHeaderShown=!0,$scope.isForceChannelInfoShown=!0,moveContainer(category,"list-category",-72),!data||!data.item||!1===data.item.loaded)return;currentItemData=data.item,DataService.getChannelGuide(currentItemData).then(function(channelItem){processSelectedChannelNow(channelItem),$scope.currentOverview=$scope.channelOverview,$scope.spotlightOverview=null,$scope.overview=null},function(response){}),lastHomeChannelFocusedGroup=FocusUtil.getData($event.currentTarget).group,$scope.isVodMaskSlow=!0,setSpotlightPackground()}}function onQuickChannelFocused($event,category,data,$index){$timeout(function(){function scrollQuickListView1(){quickListView.animate({scrollTop:quickListView[0].scrollTop-2*focusedItem[0].offsetHeight-(lastFocusedItem[0].offsetTop-focusedItem[0].offsetTop)},500,"linear",function(){$timeout(function(){itemTopHeight=focusedItem.position().top+focusedItem[0].offsetHeight,viewTopHeight=quickListView.position().top+quickListView[0].offsetHeight,viewPaddingTop=(quickListView.outerHeight()-quickListView.innerHeight())/2,isItemInView=focusedItem.position().top>=viewPaddingTop&&itemTopHeight<=viewTopHeight,focusedItem[0].offsetTop<lastFocusedItem[0].offsetTop&&!isItemInView&&scrollQuickListView1()},200)})}function scrollQuickListView2(){quickListView.animate({scrollTop:quickListView[0].scrollTop+2*focusedItem[0].offsetHeight+(focusedItem[0].offsetTop-lastFocusedItem[0].offsetTop)},500,"linear",function(){$timeout(function(){itemTopHeight=focusedItem.position().top+focusedItem[0].offsetHeight,viewTopHeight=quickListView.position().top+quickListView[0].offsetHeight,viewPaddingTop=(quickListView.outerHeight()-quickListView.innerHeight())/2,isItemInView=focusedItem.position().top>=viewPaddingTop&&itemTopHeight<=viewTopHeight,focusedItem[0].offsetTop>lastFocusedItem[0].offsetTop&&!isItemInView&&scrollQuickListView2()},200)})}var channelItem=data,focusedItem=$("#channel-quick-list-item-"+channelItem.channelId),quickListView=$(".channel-quick-list"),itemTopHeight=focusedItem.position().top+focusedItem[0].offsetHeight,viewTopHeight=quickListView.position().top+quickListView[0].offsetHeight,viewPaddingTop=(quickListView.outerHeight()-quickListView.innerHeight())/2,isItemInView=focusedItem.position().top>=viewPaddingTop+30&&itemTopHeight<=viewTopHeight-30,isItemBelowView=(focusedItem.position().top,itemTopHeight>viewTopHeight);lastFocusedItem?focusedItem[0].offsetTop<lastFocusedItem[0].offsetTop&&!isItemInView?scrollQuickListView1():focusedItem[0].offsetTop>lastFocusedItem[0].offsetTop&&!isItemInView&&scrollQuickListView2():isItemBelowView&&quickListView.animate({scrollTop:quickListView[0].scrollTop+4*focusedItem[0].offsetHeight+(focusedItem[0].offsetTop-quickListView[0].offsetTop-quickListView[0].offsetHeight)},500,"linear"),lastFocusedItem=focusedItem},300)}function processChannelListNow(allChannelList){angular.forEach(allChannelList,function(channelItem,key){var program;angular.forEach(channelItem.guides,function(guide,key){if("now"===guide.is_playing){var now=new Date,passed=now.getTime()-guide.startTime.getTime();guide.passedDuration=passed,channelItem.playingProgram=guide,program=guide}}),channelItem.channelId===$scope.channelOverview.channelId&&($scope.channelOverview.playingProgram=program)})}function processSelectedChannelNow(channelItem){angular.forEach(channelItem.guides,function(guide,key){if("now"===guide.is_playing){var now=new Date,passed=now.getTime()-guide.startTime.getTime();guide.passedDuration=passed,channelItem.playingProgram=guide,$scope.channelOverview=channelItem}})}function getCurrentChannelProgram(channelItem){var program;return channelItem&&channelItem.guides?(angular.forEach(channelItem.guides,function(guide,key){if("now"===guide.is_playing){var now=new Date,passed=now.getTime()-program.startTime.getTime();program=guide,program.passedDuration=passed}}),program):null}function onVodBlurred($event,category,data){}function onCategoryMenuSelected($event,category,data,$index){isLoadNewCategory=!0,data&&data.item&&!1!==data.item.loaded&&(0===$index?(moveToSpotlightDown(),focusController.focus("btnView")):1===$index?($scope.overview=null,$scope.sidebarCategories=CONSTANT.CHANNEL_CATEGORY_LIST,$scope.selectedCategoryMenu=data.item.this.name[0].text,$scope.selectedCategoryMenuIndex=$index,$scope.vodListByCategory=[],$scope.isMainLoaderShown=!0,changeDepth($scope.DEPTH.CATEGORY,function(){$timeout(function(){focusController.focus(document.getElementById("sidebar-category-item-0"))},100)}),$scope.currentDepthZone=$scope.DEPTH_ZONE.CATEGORY.CHANNEL,lastFocusedGroup=FocusUtil.getData($event.currentTarget).group):($scope.overview=null,$scope.sidebarCategories=data.item.children,$scope.selectedCategoryMenu=data.item.this.name[0].text,$scope.selectedCategoryMenuIndex=$index,$scope.vodListByCategory=[],$scope.isMainLoaderShown=!0,changeDepth($scope.DEPTH.CATEGORY,function(){focusController.focus(document.getElementById("sidebar-category-item-0"))}),$scope.currentDepthZone=$scope.DEPTH_ZONE.CATEGORY.VOD,lastFocusedGroup=FocusUtil.getData($event.currentTarget).group))}function setSpotlightPackground(bgrUrl,callback){$scope.bgGradient1=CONSTANT.SPOTLIGHT_BG_GRADIENT1,$scope.bgGradient2=CONSTANT.SPOTLIGHT_BG_GRADIENT2,$scope.bgSpotlightSize=CONSTANT.SPOTLIGHT_BG_SIZE,$scope.bgSpotlightWidth=CONSTANT.SPOTLIGHT_BG_WIDTH,$scope.isVodShown=!1,$scope.isMenuShown=!1,$scope.isSpotlightShown=!0,$scope.bgImgCoverOpacity=0,bgrUrl&&($scope.bgSpotlightImgUrl=bgrUrl),callback&&callback()}function moveToSpotlightDown(){$scope.currentDepthZone=$scope.DEPTH_ZONE.INDEX.SPOTLIGHT,$(".menu-container ").css({transform:"translate3d(0,-1080px,0)"}),$(".overview-container ").css({transform:"translate3d(0,0px,0)"}),$(".list-category").css({transform:"translate3d(0,0px,0)"})}function moveToCategoryMenu(){$(".menu-container ").css({transform:"translate3d(0,0px,0)"}),$(".overview-container ").css({transform:"translate3d(0,1080px,0)"}),$(".list-category").css({transform:"translate3d(0,1080px,0)"})}function setVodDetailPackground(bgrUrl){$scope.bgImgCoverOpacity=1,$scope.bgImgUrl=bgrUrl,$scope.bgGradient1=CONSTANT.VOD_DETAIL_BG_GRADIENT1,$scope.bgGradient2=CONSTANT.VOD_DETAIL_BG_GRADIENT2,$scope.bgSize=CONSTANT.VOD_DETAIL_BG_SIZE,$scope.bgWidth=CONSTANT.VOD_DETAIL_BG_WIDTH,$timeout(function(){$scope.bgImgCoverOpacity=0},400)}function setMenuFocusedPackground(bgrUrl){$scope.bgGradient1=CONSTANT.MENU_BG_GRADIENT1,$scope.bgGradient2=CONSTANT.MENU_BG_GRADIENT2,$scope.bgMenuSize=CONSTANT.MENU_BG_SIZE,$scope.bgMenuWidth=CONSTANT.MENU_BG_WIDTH,$scope.bgMenuImgUrl=bgrUrl||CONSTANT.MENU_BG_IMG_URL}function onSidebarCategoryFocused($event,item,$index){onSidebarCategoryFocusedTimer&&$timeout.cancel(onSidebarCategoryFocusedTimer),onSidebarCategoryFocusedTimer=$timeout(function(){if($scope.isVodCategoryOpened=!1,item)if($scope.selectedSidebarCategory=item,$scope.vodListByCategory=[],$scope.isVodCategoryOpened=!1,moveCategoryVodContainer(0),$(".item-fadeout").removeClass("item-fadeout"),isLoadNewCategory&&(item.vodListByCategory=[],isLoadNewCategory=!1),item.vodListByCategory&&item.vodListByCategory.length>0)$scope.vodListByCategory=item.vodListByCategory,$scope.overview=null,$timeout(function(){$scope.isMainLoaderShown=!1},500);else{var offset=0,limit=24;if($scope.currentDepthZone===$scope.DEPTH_ZONE.CATEGORY.CHANNEL){if(0===$index)$scope.vodListByCategory=allChannelList,item.vodListByCategory=allChannelList;else{var tempChannelList=[];angular.forEach(allChannelList,function(channelItem,key){(","+$scope.selectedSidebarCategory.CONFIG_SERVICES+",").indexOf(","+channelItem.service_id+",")>=0&&tempChannelList.push(channelItem),$scope.vodListByCategory=tempChannelList,item.vodListByCategory=tempChannelList})}$scope.overview=null,$timeout(function(){$scope.isMainLoaderShown=!1},500)}else retrieveVodListInCategory($scope.selectedSidebarCategory,limit,offset)}},200)}function getMoreVodsInCategory(callback){var selectedSidebarCategory=$scope.selectedSidebarCategory,offset=selectedSidebarCategory.vodListByCategory.length;retrieveVodListInCategory(selectedSidebarCategory,offset+24,offset,callback)}function retrieveVodListInCategory(sidebarCategory,limit,offset,callback){var cb=callback||angular.noop;$scope.isMainLoaderShown=!0,UltilService.isSeriesCategory(sidebarCategory)?DataService.getCategorySeriesVodListByCategoryId(UltilService.getVodCategoryId(sidebarCategory),limit,offset).then(function(response){var seriesVodList=response;if(seriesVodList)return sidebarCategory.vodListByCategory||(sidebarCategory.vodListByCategory=[]),sidebarCategory.vodListByCategory=sidebarCategory.vodListByCategory.concat(seriesVodList),$scope.vodListByCategory=sidebarCategory.vodListByCategory,$scope.overview=null,$timeout(function(){$scope.isMainLoaderShown=!1},500),cb()},function(response){setTimeout(function(){},200)}):DataService.getCategoryVodListByCategoryId(UltilService.getVodCategoryId(sidebarCategory),limit,offset).then(function(response){var vodList=response;if(vodList)return sidebarCategory.vodListByCategory||(sidebarCategory.vodListByCategory=[]),sidebarCategory.vodListByCategory=sidebarCategory.vodListByCategory.concat(vodList),$scope.vodListByCategory=sidebarCategory.vodListByCategory,$scope.overview=null,$timeout(function(){$scope.isMainLoaderShown=!1},500),cb()},function(response){setTimeout(function(){},200)})}function onChannelSelected($event,category,data){if(data){if($scope.isAuthenticated()){if($scope.channelOverview=data,$scope.currentOverview=data,$scope.channelOverview.encryption)return toaster.clear("*"),void toaster.pop({type:"error",title:"Kênh chưa được hỗ trợ!",body:"Kênh hiện tại chưa được hỗ trợ trên ứng dụng dành cho SmartTV. Quý khách vui lòng xem nội dung kênh trên Truyền hình số Viettel hoặc ứng dụng ViettelTV dành cho SmartPhone hoặc Máy tính bảng iOS/ Android.",timeout:1e4,toasterId:1});playingChannel=$scope.channelOverview,playChannel($scope.channelOverview)}else LoginService.openLoginPage(function(){$scope.lastDepth=$scope.currentDepth,changeDepth($scope.DEPTH.LOGIN,function(){})});lastFocusedGroup=FocusUtil.getData($event.currentTarget).group}}function playChannel(channelItem){VideoService.stopStream(video),video=$("#videoMainPlay")[0],$scope.isMediaLoaderHidden=!1,$scope.isPlayerShown=!0,DataService.getChannelProduct(channelItem.channelId).then(function(response){var channelProduct=response,playable=!1;if(channelProduct.encryption)return toaster.clear("*"),void toaster.pop({type:"error",title:"Kênh chưa được hỗ trợ!",body:"Kênh hiện tại chưa được hỗ trợ trên ứng dụng dành cho SmartTV. Quý khách vui lòng xem nội dung kênh trên Truyền hình số Viettel hoặc ứng dụng ViettelTV dành cho SmartPhone hoặc Máy tính bảng iOS/ Android.",timeout:1e4,toasterId:1});channelProduct.isVisiable?(channelProduct.isPublish?playable=!0:channelProduct.isExclusivePackage?channelProduct.isPurchasedExclusive&&(playable=!0):channelProduct.isVtvCab?channelProduct.isPurchasedPackage&&(playable=!0):channelProduct.isFreeNoPair?playable=!0:(channelProduct.isWifiPackage||channelProduct.isPurchasedPackage)&&(playable=!0),playable?($(".background-layer").css("z-index",23),$(".wrapper-container").css("z-index",24),changeDepth($scope.DEPTH.PLAYER),VideoService.playChannelStream(channelProduct.service_id,video).then(function(response){
$timeout(function(){$timeout(function(){$timeout(function(){$scope.isChannelHeaderShown=!1},5e3),$scope.isListPageFadeOut=!0,$scope.isMediaLoaderHidden=!0},1e3),$(".background-layer").fadeOut(2e3,"linear",function(){$(".background-layer").css("z-index",21),$(".wrapper-container").css("z-index",21)})},300)},function(errorData){"ENCRYPTED_CONTENT_ERROR"===errorData.name&&($scope.isMediaLoaderHidden=!0,toaster.clear("*"),toaster.pop({type:"error",title:"Nội dung chưa được hỗ trợ",body:"Nội dung chưa được hỗ trợ trên ứng dụng cho SmartTV. Vui lòng xem nội dung trên Set-Top-Box hoặc ứng dụng Viettel trên điện thoại!",timeout:1e4,toasterId:1}))})):(toaster.clear("*"),toaster.pop({type:"error",title:"Chưa mua dịch vụ",body:"Quý khách vui lòng đăng ký gói cước trên ứng dụng ViettelTV dành cho SmartPhone/Máy tính bảng iOS/Android hoặc truy cập website http://vietteltv.vn",timeout:1e4,toasterId:1}))):(toaster.clear("*"),toaster.pop({type:"warning",title:"Không xem được Nội dung",body:"Quý khách vui lòng đăng ký gói cước trên ứng dụng ViettelTV dành cho SmartPhone/Máy tính bảng iOS/Android hoặc truy cập website http://vietteltv.vn",timeout:1e4,toasterId:1}),$scope.isMediaLoaderHidden=!0)},function(response){})}function onQuickChannelSelected($event,category,data){if(data){if(previousPlayingChannel=playingChannel,playingChannel=data,playingChannel.encryption)return toaster.clear("*"),void toaster.pop({type:"error",title:"Kênh chưa được hỗ trợ!",body:"Kênh hiện tại chưa được hỗ trợ trên ứng dụng dành cho SmartTV. Quý khách vui lòng xem nội dung kênh trên Truyền hình số Viettel hoặc ứng dụng ViettelTV dành cho SmartPhone hoặc Máy tính bảng iOS/ Android.",timeout:1e4,toasterId:1});VideoService.stopStream(video),video=$("#videoMainPlay")[0],$scope.currentDepth===$scope.DEPTH.PLAYER&&$scope.isChannelQuicklistShown||($scope.isMediaLoaderHidden=!1),$scope.isPlayerShown=!0,$scope.isMediaLoaderHidden=!1,DataService.getChannelProduct(playingChannel.channelId).then(function(response){var channelProduct=response,playable=!1;if(channelProduct.encryption)return toaster.clear("*"),void toaster.pop({type:"error",title:"Kênh chưa được hỗ trợ!",body:"Kênh hiện tại chưa được hỗ trợ trên ứng dụng dành cho SmartTV. Quý khách vui lòng xem nội dung kênh trên Truyền hình số Viettel hoặc ứng dụng ViettelTV dành cho SmartPhone hoặc Máy tính bảng iOS/ Android.",timeout:1e4,toasterId:1});channelProduct.isVisiable?(channelProduct.isPublish?playable=!0:channelProduct.isExclusivePackage?channelProduct.isPurchasedExclusive&&(playable=!0):channelProduct.isVtvCab?channelProduct.isPurchasedPackage&&(playable=!0):channelProduct.isFreeNoPair?playable=!0:(channelProduct.isWifiPackage||channelProduct.isPurchasedPackage)&&(playable=!0),playable?(toaster.clear("*"),VideoService.playChannelStream(playingChannel.channelId,video).then(function(response){$timeout(function(){$scope.isMediaLoaderHidden=!0},300)},function(errorData){$scope.isMediaLoaderHidden=!0,"ENCRYPTED_CONTENT_ERROR"===errorData.name&&($scope.back(),toaster.clear("*"),toaster.pop({type:"error",title:"Nội dung không hỗ trợ",body:"Nội dung chưa được hỗ trợ trên TV. Vui lòng xem nội dung trên Set-Top-Box hoặc ứng dụng Viettel trên điện thoại!",timeout:1e4,toasterId:1}))})):($scope.isMediaLoaderHidden=!0,toaster.clear("*"),toaster.pop({type:"error",title:"Chưa mua dịch vụ",body:"Quý khách vui lòng đăng ký gói cước trên ứng dụng ViettelTV dành cho SmartPhone/Máy tính bảng iOS/Android hoặc truy cập website http://vietteltv.vn",timeout:1e4,toasterId:1}))):(toaster.clear("*"),toaster.pop({type:"warning",title:"Không xem được Nội dung",body:"Quý khách vui lòng đăng ký gói cước trên ứng dụng ViettelTV dành cho SmartPhone/Máy tính bảng iOS/Android hoặc truy cập website http://vietteltv.vn",timeout:1e4,toasterId:1}),$scope.isMediaLoaderHidden=!0)},function(response){}),lastFocusedGroup=FocusUtil.getData($event.currentTarget).group}}function onChannelBlurred($event,category,data){$scope.isOverviewDark=!0,$scope.channelWatchPreviewLoaded=!1}function onVodSelected($event,category,item,$index){!1!==item.loaded&&goToVodDetailPage(item,$event)}function onCategoryVodSelected($event,item,$index){if(!1!==item.loaded)if($scope.currentDepthZone===$scope.DEPTH_ZONE.CATEGORY.CHANNEL){if($scope.isAuthenticated()){if($scope.channelOverview=item,$scope.currentOverview=item,previousPlayingChannel&&(previousPlayingChannel=null),playingChannel=item,$scope.channelOverview.encryption)return toaster.clear("*"),void toaster.pop({type:"error",title:"Kênh chưa được hỗ trợ!",body:"Kênh hiện tại chưa được hỗ trợ trên ứng dụng dành cho SmartTV. Quý khách vui lòng xem nội dung kênh trên Truyền hình số Viettel hoặc ứng dụng ViettelTV dành cho SmartPhone hoặc Máy tính bảng iOS/ Android.",timeout:1e4,toasterId:1});VideoService.stopStream(video),video=$("#videoMainPlay")[0],$scope.isMediaLoaderHidden=!1,DataService.getChannelProduct($scope.channelOverview.channelId).then(function(response){var channelProduct=response,playable=!1;channelProduct.isVisiable?(channelProduct.isPublish?playable=!0:channelProduct.isExclusivePackage?channelProduct.isPurchasedExclusive&&(playable=!0):channelProduct.isVtvCab?channelProduct.isPurchasedPackage&&(playable=!0):channelProduct.isFreeNoPair?playable=!0:(channelProduct.isWifiPackage||channelProduct.isPurchasedPackage)&&(playable=!0),playable?(changeDepth($scope.DEPTH.PLAYER),toaster.clear("*"),VideoService.playChannelStream($scope.channelOverview.channelId,video).then(function(response){$timeout(function(){$scope.isPlayerShown=!0,$scope.isMediaLoaderHidden=!0,$timeout(function(){$(".category-page").fadeOut(1e3,"linear")},3e3),$(".background-layer").fadeOut(2e3,"linear")},300)},function(errorData){"ENCRYPTED_CONTENT_ERROR"===errorData.name&&($scope.isMediaLoaderHidden=!0,$scope.back(),toaster.clear("*"),toaster.pop({type:"error",title:"Nội dung không hỗ trợ",body:"Nội dung chưa được hỗ trợ trên TV. Vui lòng xem nội dung trên Set-Top-Box hoặc ứng dụng Viettel trên điện thoại!",timeout:1e4,toasterId:1}))})):(toaster.clear("*"),toaster.pop({type:"error",title:"Chưa mua dịch vụ",body:"Quý khách vui lòng đăng ký gói cước trên ứng dụng ViettelTV dành cho SmartPhone/Máy tính bảng iOS/Android hoặc truy cập website http://vietteltv.vn",timeout:1e4,toasterId:1}))):(toaster.clear("*"),toaster.pop({type:"warning",title:"Không xem được Nội dung",body:"Quý khách vui lòng đăng ký gói cước trên ứng dụng ViettelTV dành cho SmartPhone/Máy tính bảng iOS/Android hoặc truy cập website http://vietteltv.vn",timeout:1e4,toasterId:1}),$scope.isMediaLoaderHidden=!0)},function(response){})}else LoginService.openLoginPage(function(){$scope.lastDepth=$scope.currentDepth,changeDepth($scope.DEPTH.LOGIN,function(){})});lastFocusedGroup=FocusUtil.getData($event.currentTarget).group}else $scope.isMainLoaderShown=!0,lastFocusedGroup=FocusUtil.getData($event.currentTarget).group,lastCategoryVodFocusedGroup=FocusUtil.getData($event.currentTarget).group,$scope.lastDepthZone="",goToVodDetailPage(item,$event)}function onRelatedVodSelected($event,category,item,$index){!1!==item.loaded&&playVOD(item)}function onEpisodeVodSelected($event,category,data,$index){data&&data.item&&!1!==data.item.loaded&&playVOD(data.item)}function goToVodDetailPage(vod,$event){$scope.currentItemData=null;var depth;depth=$scope.DEPTH.DETAIL,depth&&changeDepth(depth),$scope.currentDepthZone=0,$scope.isInfoShownInPlayer=!0,detailPlayFocusedGroup=FocusUtil.getData($event.currentTarget).group,$(".related-play-list").css("z-index",23),$(".episode-play-list").css("z-index",23),vod.relateds=[],vod.episodes=[],vod.isVodInSeries?DataService.getRelatedVodList(vod.program.programId).then(function(relatedVodList){vod.relateds=relatedVodList;var seriesId=vod.program.series.id;DataService.getEpisodesInSeries(seriesId).then(function(episodeVodList){vod.episodes=episodeVodList,updateRelatedEpisodeListInDetail(vod)},function(response){})},function(response){}):vod.isSeries?DataService.getEpisodeListBySeriesId(vod.id).then(function(episodeVodList){vod=episodeVodList[0],vod=UltilService.transformVOD(vod),vod.episodes=episodeVodList,DataService.getRelatedVodList(vod.program.id).then(function(relatedVodList){vod.relateds=relatedVodList,updateRelatedEpisodeListInDetail(vod)})},function(response){}):DataService.getRelatedVodList(vod.program.id).then(function(relatedVodList){vod.relateds=relatedVodList,updateRelatedEpisodeListInDetail(vod)},function(response){})}function updateRelatedEpisodeListInDetail(vod){$scope.relatedPlaylist=vod.relateds,$scope.episodePlaylist=vod.episodes,$scope.currentDetailRelatedList=$scope.relatedPlaylist,$scope.currentDetailOverview=vod,currentItemData=vod,$scope.isRelatedShown=!1,$scope.isEpisodeShown=!1,$scope.isEpisodeBtnNotShown=!0,$scope.relatedPlaylist.length>0?($scope.isRelatedShown=!0,$scope.episodePlaylist.length>0?$scope.isEpisodeBtnNotShown=!1:$scope.isEpisodeBtnNotShown=!0):($scope.isRelatedShown=!1,$scope.episodePlaylist.length>0?($scope.isEpisodeShown=!0,$scope.isEpisodeBtnNotShown=!0):($scope.isEpisodeShown=!1,$scope.isEpisodeBtnNotShown=!1)),updateOverview(),$scope.lastDepthZone!==$scope.DEPTH_ZONE.INDEX.SPOTLIGHT&&!0!==vod.isSpotlight&&($scope.isVodShown=!0,setVodDetailPackground(vod.bigPhotoUrl)),!0===vod.isSpotlight&&($scope.isVodShown=!1,$scope.isSpotlightShown=!0),$scope.isMainLoaderShown=!1,$scope.isMenuShown=!1,$timeout(function(){$("#list-related-vod").trigger("reload"),$("#list-episode-vod").trigger("reload")},0)}function onBtnVodPlayFocusInDetail($event,$originalEvent){$scope.isFromVodDetail=!0,$scope.currentDetailOverview&&($scope.overview=$scope.currentDetailOverview),$scope.currentDetailRelatedList&&($scope.relatedPlaylist=$scope.currentDetailRelatedList),$scope.currentDetailEpisodeList&&($scope.episodePlaylist=$scope.currentDetailEpisodeList),$scope.lastDepthZone!==$scope.DEPTH_ZONE.INDEX.SPOTLIGHT&&$scope.lastDepth!==$scope.DEPTH.PLAYER&&$scope.lastDepth!==$scope.DEPTH.CATEGORY&&updateRelatedEpisodeListInDetail($scope.currentDetailOverview),lastFocusedGroup=FocusUtil.getData($event.currentTarget).group,$scope.lastDepthZone=$scope.DEPTH_ZONE.DETAIL.SPOTLIGHT}function onBtnVodEpisodeFocusInDetail($event,$originalEvent){$scope.isOverviewDark=!1,$scope.isEpisodeShown=!0,$scope.isRelatedShown=!1,$scope.currentDetailOverview&&($scope.overview=$scope.currentDetailOverview),$scope.currentDetailEpisodeList&&($scope.episodePlaylist=$scope.currentDetailEpisodeList)}function onBtnVodRelatedFocusInDetail($event,$originalEvent){$scope.isOverviewDark=!1,$scope.isEpisodeShown=!1,$scope.relatedPlaylist.length>0&&($scope.isRelatedShown=!0)}function onBtnViewSpotlightFocused($event,$originalEvent){currentItemData=$scope.lastOverview,$scope.currentFocusItem=focusController.getCurrentFocusItem();$($scope.currentFocusItem).parents(".list-area");$scope.overview&&$scope.overview.isChannel?(VideoService.stopStream(video),$scope.lastDepthZone=$scope.currentDepthZone,$scope.currentDepthZone=$scope.DEPTH_ZONE.INDEX.SPOTLIGHT,$scope.spotlightOverview=$scope.lastOverview,$(".list-category").css({transform:"translate3d(0, 0px, 0)"})):($scope.spotlightOverview=currentSpotlight,$scope.bgImgCoverOpacity=1,moveToSpotlightDown()),setSpotlightPackground(),$scope.isSpotlightShown=!0,$scope.isMenuShown=!1,$scope.currentCategory="",$scope.currentDetailOverview=null,$scope.isForceChannelInfoShown=!1}function playVOD(vod){$scope.isAuthenticated()?(video=$("#videoMainPlay")[0],$rootScope.isAppLoadedAfterLogin?playVODStream(vod,video,function(){}):DataService.getVodDetails($scope.overview.program.id).then(function(responseVod){$scope.overview=responseVod,playVODStream($scope.overview,video,function(){})},function(response){})):LoginService.openLoginPage(function(){changeDepth($scope.DEPTH.LOGIN),focusController.focus("btnLogin")})}function onBtnVodPlaySelected($event){$scope.currentDepth!==$scope.DEPTH.PLAYER&&(lastFocusedGroup=FocusUtil.getData($event.currentTarget).group,playVOD($scope.overview))}function onBtnViewSpotlightSelected($event,item){$scope.isMainLoaderShown=!0,$scope.lastDepthZone=$scope.DEPTH_ZONE.INDEX.SPOTLIGHT,goToVodDetailPage(item,$event),lastFocusedGroup=FocusUtil.getData($event.currentTarget).group,$timeout(function(){$scope.isMainLoaderShown=!1},200)}function playVODStream(vod,video,callback){if($scope.currentDepth!==$scope.DEPTH.PLAYER){if(vod.isEncrypted)return $scope.isMediaLoaderHidden=!0,$scope.isPlayDisabled=!1,toaster.clear("*"),void toaster.pop({type:"error",title:"Nội dung chưa hỗ trợ!",body:"Nội dung này chưa được hỗ trợ trên ứng dụng cho SmartTV. Quý khách vui lòng xem nội dung này trên Truyền hình số Viettel hoặc ứng dụng ViettelTV dành cho SmartPhone hoặc Máy tính bảng iOS/ Android.",timeout:12e3,toasterId:2});$scope.isPlayDisabled=!0;var playable=!1;vod.isExclusivePackage?vod.isPurchasedExclusive&&(playable=!0):(vod.isFreeNoPair||vod.isWifiPackage||vod.isPurchasedPackage)&&(playable=!0),playable?($scope.isMediaLoaderHidden=!1,VideoService.playVODStream(vod,video,callback).then(function(response){$scope.lastDepth=$scope.currentDepth,processPlayerTimer=$timeout(function(){changeDepth($scope.DEPTH.PLAYER),detailSectionTimmer=$timeout(function(){$(".category-section").fadeOut(4e3,"linear")},8e3),$scope.isMediaLoaderHidden=!0,$scope.showMediaController=!1,$scope.isPlayerShown=!0,$(".background-layer").fadeOut(3e3,"linear")},500),video=$("#videoMainPlay")[0],$scope.overview.durationInSeconds=video.duration,$scope.overview.endPosition=($scope.overview.durationInSeconds+"").toHHMMSS(),$scope.overview.passedDuration=Math.ceil(video.currentTime),playTime=Math.ceil(video.currentTime),void 0!==videoProgressTrackTimer&&null!==videoProgressTrackTimer||(videoProgressTrackTimer=$interval(function(){video.currentTime&&($scope.overview.passedDuration=Math.ceil(video.currentTime),playTime+=1,playTime<$scope.overview.durationInSeconds?($scope.overview.passedDuration=Math.ceil(video.currentTime),$scope.overview.playPosition=($scope.overview.passedDuration+"").toHHMMSS()):($scope.currentDepth===$scope.DEPTH.PLAYER&&$scope.back(),$interval.cancel(videoProgressTrackTimer)))},1e3))},function(errorData){"ENCRYPTED_CONTENT_ERROR"===errorData.name?($scope.isMediaLoaderHidden=!0,$scope.isPlayDisabled=!1,toaster.clear("*"),toaster.pop({type:"error",title:"Nội dung không hỗ trợ",body:"Nội dung chưa được hỗ trợ trên ứng dụng cho SmartTV. Vui lòng xem nội dung trên Set-Top-Box hoặc ứng dụng Viettel trên điện thoại!",timeout:12e3,toasterId:2})):"NETWORK_ERROR"!==errorData.name&&"UNRECOVERABLE_ERROR"!==errorData.name||($scope.isMediaLoaderHidden=!0,$scope.isPlayDisabled=!1,toaster.clear("*"),toaster.pop({type:"error",title:"Có lỗi xảy ra",body:errorData.description,timeout:12e3,toasterId:2}))})):(toaster.clear("*"),toaster.pop({type:"warning",title:"Nội dung tính phí!",body:"Để xem nội dung Quý khách vui lòng đăng ký gói dịch trên ứng dụng ViettelTV phiên bản dành cho SmartPhone hoặc Máy tính bảng iOS/Android.",timeout:1e4,toasterId:1}),$scope.isMediaLoaderHidden=!0)}}function onLoginCancelButtonSelected(event){$scope.back()}function onLoginButtonSelected(event){event.preventDefault(),$scope.isMainLoaderShown=!0,Auth.login({username:$scope.login.username,password:$scope.login.password}).then(function(response){$scope.isMainLoaderShown=!1,response.data.error?($scope.authenticationError=!0,toaster.clear("*"),toaster.pop({type:"error",title:"Đăng nhập không thành công",body:"Số điện thoại hoặc mật khẩu không đúng!",timeout:1e4,toasterId:1})):(removeKeyboardListenerFunc(),$scope.authenticationError=!1,LoginService.closeLoginPage(),Principal.identity().then(function(account){$scope.isAuthenticated=Principal.isAuthenticated,toaster.clear("*"),toaster.pop({type:"success",title:"Đăng nhập thành công",timeout:2e3,toasterId:1})}),$scope.back())}).catch(function(error){$scope.authenticationError=!0,$scope.back()})}function showQuickChannelList(){if(!($scope.isChannelQuicklistShown&&(void 0===previousPlayingChannel||null===previousPlayingChannel)||void 0!==previousPlayingChannel&&null!==previousPlayingChannel&&previousPlayingChannel.index===playingChannel.index))return $scope.isChannelQuicklistShown&&null!==previousPlayingChannel&&void 0!==previousPlayingChannel&&previousPlayingChannel.index!==playingChannel.index?void focusController.focus($("#channel-quick-list-item-"+playingChannel.channelId)):(processChannelListNow(allChannelList),$scope.allChannelList=allChannelList,$timeout(function(){$scope.isForceChannelInfoShown=!0,$scope.isChannelHeaderShown=!1,$scope.isChannelQuicklistShown=!0,$timeout(function(){focusController.focus($("#channel-quick-list-item-"+playingChannel.channelId))},100)},100),!1)}function processKeydownEvent(){document.addEventListener("click",function(){if($scope.currentDepth!==$scope.DEPTH.PLAYER||$scope.currentOverview.isChannel){if($scope.currentDepth===$scope.DEPTH.PLAYER&&$scope.currentOverview.isChannel){if($scope.isChannelQuicklistShown&&(void 0===previousPlayingChannel||null===previousPlayingChannel)||void 0!==previousPlayingChannel&&null!==previousPlayingChannel&&previousPlayingChannel.index===playingChannel.index)return;if($scope.isChannelQuicklistShown&&null!==previousPlayingChannel&&void 0!==previousPlayingChannel&&previousPlayingChannel.index!==playingChannel.index)return;return processChannelListNow(allChannelList),$scope.allChannelList=allChannelList,$timeout(function(){$scope.isForceChannelInfoShown=!0,$scope.isChannelHeaderShown=!1,$scope.isChannelQuicklistShown=!0,$timeout(function(){focusController.focus($("#channel-quick-list-item-"+playingChannel.channelId))},100)},100),!1}}else if(!1===$scope.showMediaController)return $scope.isMediaLoaderHidden&&$timeout(function(){$scope.setMediaControllerTimer(),video=$("#videoMainPlay")[0],$scope.overview.durationInSeconds=video.duration,$scope.overview.endPosition=($scope.overview.durationInSeconds+"").toHHMMSS(),$scope.overview.passedDuration=Math.ceil(video.currentTime)},50),!1}),focusController.addBeforeKeydownHandler(function(context){if(isOnline&&($scope.isChannel=!1,!1!==$scope.isInitCompleted)){if($scope.currentDepth!==$scope.DEPTH.PLAYER||$scope.currentOverview.isChannel){if($scope.currentDepth===$scope.DEPTH.PLAYER&&$scope.currentOverview.isChannel)switch($scope.isChannel=!0,context.event.keyCode){case CONSTANT.KEY_CODE.ENTER:if($scope.isChannelQuicklistShown&&(void 0===previousPlayingChannel||null===previousPlayingChannel)||void 0!==previousPlayingChannel&&null!==previousPlayingChannel&&previousPlayingChannel.index===playingChannel.index)return;if($scope.isChannelQuicklistShown&&null!==previousPlayingChannel&&void 0!==previousPlayingChannel&&previousPlayingChannel.index!==playingChannel.index)return;return processChannelListNow(allChannelList),$scope.allChannelList=allChannelList,$timeout(function(){$scope.isForceChannelInfoShown=!0,$scope.isChannelHeaderShown=!1,$scope.isChannelQuicklistShown=!0,$timeout(function(){focusController.focus($("#channel-quick-list-item-"+playingChannel.channelId))},100)},100),!1;case CONSTANT.KEY_CODE.CHANNEL_DOWN:case CONSTANT.KEY_CODE.LG_CHANNEL_DOWN:$scope.isMediaLoaderHidden=!1,playingChannel?(previousPlayingChannel=playingChannel,playingChannel=UltilService.getChannelByIndex(allChannelList,playingChannel.index+1),$scope.isChannelQuicklistShown&&showQuickChannelList(),playChannel(playingChannel)):(playingChannel=$scope.channelOverview,playChannel($scope.channelOverview));break;case CONSTANT.KEY_CODE.CHANNEL_UP:case CONSTANT.KEY_CODE.LG_CHANNEL_UP:if(0===playingChannel.index)return;$scope.isMediaLoaderHidden=!1,playingChannel?(previousPlayingChannel=playingChannel,playingChannel=UltilService.getChannelByIndex(allChannelList,playingChannel.index-1),$scope.isChannelQuicklistShown&&showQuickChannelList(),playChannel(playingChannel)):(playingChannel=$scope.channelOverview,playChannel($scope.channelOverview))}}else{if(context.event.keyCode!==CONSTANT.KEY_CODE.RETURN&&context.event.keyCode!==CONSTANT.KEY_CODE.BACK&&context.event.keyCode!==CONSTANT.KEY_CODE.LG_POINT_DISAPPEARED&&!1===$scope.showMediaController)return $scope.isMediaLoaderHidden&&$timeout(function(){$scope.setMediaControllerTimer(),video=$("#videoMainPlay")[0],$scope.overview.durationInSeconds=video.duration,$scope.overview.endPosition=($scope.overview.durationInSeconds+"").toHHMMSS(),$scope.overview.passedDuration=Math.ceil(video.currentTime)},50),!1;$scope.isChannel=!1}if($scope.currentDepth===$scope.DEPTH.CATEGORY)switch($scope.currentFocusItem=focusController.getCurrentFocusItem(),context.event.keyCode){case CONSTANT.KEY_CODE.UP:case CONSTANT.KEY_CODE.DOWN:break;case CONSTANT.KEY_CODE.RETURN:case CONSTANT.KEY_CODE.BACK:case CONSTANT.KEY_CODE.ESC:$scope.back()}else switch(context.event.keyCode){case CONSTANT.KEY_CODE.UP:case CONSTANT.KEY_CODE.DOWN:break;case CONSTANT.KEY_CODE.RETURN:case CONSTANT.KEY_CODE.BACK:case CONSTANT.KEY_CODE.ESC:$scope.back()}}})}function mediaTogglePlay(isPlaying){if($scope.currentOverview.isChannel||$scope.$applyAsync(function(){$scope.isPlaying=isPlaying}),!$scope.currentOverview.isChannel&&!isPlaying)return $interval.cancel(videoProgressTrackTimer),videoProgressTrackTimer=null,void(playTime>$scope.overview.durationInSeconds-3&&$scope.back());if(!$scope.currentOverview.isChannel&&isPlaying){if(void 0!==videoProgressTrackTimer&&null!==videoProgressTrackTimer)return;video=$("#videoMainPlay")[0],$scope.overview.durationInSeconds=video.duration,$scope.overview.endPosition=($scope.overview.durationInSeconds+"").toHHMMSS(),$scope.overview.passedDuration=Math.ceil(video.currentTime),playTime=Math.ceil(video.currentTime),videoProgressTrackTimer=$interval(function(){$scope.overview.passedDuration=Math.ceil(video.currentTime),playTime+=1,playTime<$scope.overview.durationInSeconds?($scope.overview.passedDuration=Math.ceil(video.currentTime),$scope.overview.playPosition=($scope.overview.passedDuration+"").toHHMMSS()):($scope.currentDepth===$scope.DEPTH.PLAYER&&$scope.back(),$interval.cancel(videoProgressTrackTimer))},1e3)}}function mediaPause(){$scope.currentOverview.isChannel||($interval.cancel(videoProgressTrackTimer),playTime>$scope.overview.durationInSeconds-3&&$scope.back())}function mediaEnded(){$scope.currentOverview.isChannel||($interval.cancel(videoProgressTrackTimer),$scope.back())}function mediaForward(){$scope.currentOverview.isChannel||($scope.overview.passedDuration+=15,$scope.overview.playPosition=($scope.overview.passedDuration+"").toHHMMSS())}function mediaRewind(){$scope.currentOverview.isChannel||($scope.overview.passedDuration-=15,$scope.overview.playPosition=($scope.overview.passedDuration+"").toHHMMSS())}function mediaRestart(){$scope.currentOverview.isChannel||($scope.overview.passedDuration-=120,$scope.overview.playPosition=($scope.overview.passedDuration+"").toHHMMSS())}function mediaNext(){$scope.currentOverview.isChannel||($scope.overview.passedDuration+=120,$scope.overview.playPosition=($scope.overview.passedDuration+"").toHHMMSS())}function mediaSeeked(){video=$("#videoMainPlay")[0],$scope.currentOverview.isChannel||($scope.overview.passedDuration=Math.ceil(video.currentTime),playTime=Math.ceil(video.currentTime),$scope.overview.playPosition=($scope.overview.passedDuration+"").toHHMMSS())}function mediaSeeking(){video=$("#videoMainPlay")[0]}function setMediaControllerTimer(){$scope.showMediaController=!0,mediaControllerTimer&&$timeout.cancel(mediaControllerTimer),mediaControllerTimer=$timeout(function(){$scope.showMediaController=!1,mediaControllerTimer=null},CONSTANT.MEDIA_CONTROLLER_TIMEOUT)}function changeDepth(depth,callback){$scope.lastDepth=$scope.currentDepth,$scope.currentDepth=depth,$timeout(function(){focusController.setDepth(depth),depth===$scope.DEPTH.DETAIL&&focusController.focus("btnPlay"),callback&&callback()},100)}function updateCategoryListData(response,category,reload){$scope.dataCategory[category]=response,$timeout(function(){reload&&$("#list-"+category).trigger("reload")},0)}function updateOverview(){$scope.overview=currentItemData,$scope.currentOverview=currentItemData,$scope.isOverviewDark=!1}function moveContainer(category,regionId,targetTop){category!==$scope.currentCategory&&($("."+regionId).css({transform:"translate3d(0, "+targetTop+"px, 0)"}),$scope.currentCategory=category)}function moveCategoryVodContainer(targetTop){$(".category-container").css({transform:"translate3d(0, "+targetTop+"px, 0)"})}function showExitConfirmDialog(){$timeout(function(){$scope.dialog.show=!0,$scope.dialog.isConfirm=!0,$scope.dialog.message="Bạn có muốn thoát ứng dụng ViettelTV không?",$scope.dialog.title="Thoát ứng dụng"},CONSTANT.EFFECT_DELAY_TIME)}function showNetworkDisconnectedWarning(){$timeout(function(){$scope.warning.show=!0,$scope.warning.message="Mất kết nối Internet. Vui lòng kiểm tra lại kết nối",$scope.warning.title="Mất kết nối"},CONSTANT.EFFECT_DELAY_TIME)}function back(){if(!0===$scope.showMediaController)return $scope.showMediaController=!1,void(mediaControllerTimer=null);if($scope.currentDepth===$scope.DEPTH.PLAYER&&$scope.isChannelQuicklistShown)return $scope.isForceChannelInfoShown=!1,void($scope.isChannelQuicklistShown=!1);toaster.clear("*"),$timeout.cancel(detailSectionTimmer),$timeout.cancel(processPlayerTimer),$interval.cancel(videoProgressTrackTimer),VideoService.stopStream(video),$scope.isPlayDisabled=!1,$scope.isMediaLoaderHidden=!0,$scope.isForceInfoShown=!1,$scope.isListPageFadeOut=!1,$scope.isPlayerShown=!1;var targetDepth;switch($scope.currentDepth){case $scope.DEPTH.INDEX:return void($scope.dialog.show?$scope.dialog.show=!1:showExitConfirmDialog());case $scope.DEPTH.DETAIL:$(".related-play-list").css("z-index",19),$(".episode-play-list").css("z-index",19),$scope.isListPageFadeOut=!1,"VOD_LIST_CATEGORY"===lastCategoryVodFocusedGroup?($scope.bgImgUrl="",$scope.relatedPlaylist=[CONSTANT.ITEM],targetDepth=$scope.DEPTH.CATEGORY,$scope.currentDepth=$scope.DEPTH.CATEGORY,$timeout(function(){focusController.setDepth(targetDepth,lastCategoryVodFocusedGroup)},CONSTANT.EFFECT_DELAY_TIME)):($scope.relatedPlaylist=[CONSTANT.ITEM],targetDepth=$scope.DEPTH.INDEX,$scope.currentDepth=$scope.DEPTH.INDEX,$scope.currentOverview.isSpotlight&&($scope.currentDepthZone=$scope.DEPTH_ZONE.INDEX.SPOTLIGHT),focusController.setDepth(targetDepth,lastFocusedGroup));break;case $scope.DEPTH.PLAYER:targetDepth=$scope.lastDepth,$scope.isPlayDisabled=!1,$scope.isForceInfoShown=!0,$scope.currentOverview.isChannel||setVodDetailPackground($scope.currentOverview.bigPhotoUrl),$timeout(function(){$(".background-layer").fadeIn(100,"linear"),$(".channel-page").fadeIn(1e3,"linear"),$scope.currentOverview.isChannel||$(".category-section").fadeIn(500,"linear"),$scope.isInfoShownInPlayer=!0,$scope.isForceInfoShown=!0,$scope.currentOverview.isChannel?"VOD_LIST_CATEGORY"===lastCategoryChannelFocusedGroup?($(".category-page").fadeIn(500,"linear"),$scope.lastDepth=$scope.currentDepth,targetDepth=$scope.DEPTH.CATEGORY,$scope.currentDepth=targetDepth,$timeout(function(){focusController.setDepth(targetDepth,"VOD_LIST_CATEGORY"),focusController.focus("category-vod-item-"+$scope.channelOverview.channelId)},300)):(targetDepth=$scope.DEPTH.INDEX,$(".channel-page").fadeIn(500,"linear"),$(".category-section").fadeIn(500,"linear"),$(".category-page").fadeIn(500,"linear"),$(".list-wrapper.page").fadeIn(500,"linear"),changeDepth(targetDepth,function(){focusController.focus($("#channel-item-"+$scope.channelOverview.channelId))})):focusController.setDepth(targetDepth,lastFocusedGroup),$scope.lastDepth=$scope.DEPTH.PLAYER},CONSTANT.EFFECT_DELAY_TIME),".btn-resume";break;case $scope.DEPTH.LOGIN:LoginService.closeLoginPage(),targetDepth=$scope.lastDepth,".btn-resume",$scope.lastDepth===$scope.DEPTH.DETAIL?changeDepth($scope.DEPTH.DETAIL):$scope.lastDepth===$scope.DEPTH.INDEX?changeDepth($scope.DEPTH.INDEX):$scope.lastDepth===$scope.DEPTH.CATEGORY&&changeDepth($scope.DEPTH.CATEGORY);break;case $scope.DEPTH.CATEGORY:"VOD_LIST_CATEGORY"===focusController.getCurrentGroup()?(targetDepth=$scope.DEPTH.CATEGORY,$timeout(function(){focusController.setGroup("SIDEBAR_CATEGORY")},150)):(targetDepth=$scope.DEPTH.INDEX,$timeout(function(){focusController.setDepth(targetDepth,"MENU")},CONSTANT.EFFECT_DELAY_TIME)),".btn-resume";break;default:targetDepth=$scope.DEPTH.INDEX}$scope.currentDepth=targetDepth}function removeFadeoutUpClassToCurrentSlider(){$scope.currentFocusItem=focusController.getCurrentFocusItem(),$($scope.currentFocusItem).parents(".list-area").removeClass("list-fadeout-up")}function addFadeoutUpClassToPrevSlider(){$scope.currentFocusItem=focusController.getCurrentFocusItem(),$($scope.currentFocusItem).parents(".list-area").parent().prev().find(".list-area").addClass("list-fadeout-up")}$scope.onScrollFinish=onScrollFinish,$scope.onVodFocused=onVodFocused,$scope.onScrollStart=onScrollStart,$scope.onRelatedVodFocused=onRelatedVodFocused,$scope.onCategoryVodFocused=onCategoryVodFocused,$scope.onEpisodeVodFocused=onEpisodeVodFocused,$scope.onCategoryMenuFocused=onCategoryMenuFocused,$scope.onCategoryMenuSelected=onCategoryMenuSelected,$scope.onChannelFocused=onChannelFocused,$scope.onVodBlurred=onVodBlurred,$scope.onSidebarCategoryFocused=onSidebarCategoryFocused,$scope.onChannelSelected=onChannelSelected,$scope.onChannelBlurred=onChannelBlurred,$scope.onVodSelected=onVodSelected,$scope.onCategoryVodSelected=onCategoryVodSelected,$scope.onRelatedVodSelected=onRelatedVodSelected,$scope.onEpisodeVodSelected=onEpisodeVodSelected,$scope.onBtnVodPlayFocusInDetail=onBtnVodPlayFocusInDetail,$scope.onBtnVodEpisodeFocusInDetail=onBtnVodEpisodeFocusInDetail,$scope.onBtnVodRelatedFocusInDetail=onBtnVodRelatedFocusInDetail,$scope.onBtnViewSpotlightFocused=onBtnViewSpotlightFocused,$scope.onBtnVodPlaySelected=onBtnVodPlaySelected,$scope.onBtnViewSpotlightSelected=onBtnViewSpotlightSelected,$scope.onLoginCancelButtonSelected=onLoginCancelButtonSelected,$scope.onLoginButtonSelected=onLoginButtonSelected,$scope.setMediaControllerTimer=setMediaControllerTimer,$scope.back=back,$scope.getCurrentChannelProgram=getCurrentChannelProgram,$scope.onQuickChannelSelected=onQuickChannelSelected,$scope.onQuickChannelFocused=onQuickChannelFocused,$scope.mediaPause=mediaPause,$scope.mediaForward=mediaForward,$scope.mediaRewind=mediaRewind,$scope.mediaNext=mediaNext,$scope.mediaRestart=mediaRestart,$scope.mediaTogglePlay=mediaTogglePlay,$scope.mediaSeeked=mediaSeeked,$scope.mediaSeeking=mediaSeeking,$scope.mediaEnded=mediaEnded,$scope.onPlayerPointerSelect=onPlayerPointerSelect,$scope.CATEGORY=CONSTANT.CATEGORY,$scope.DEPTH={INDEX:1,DETAIL:2,CATEGORY:3,PLAYER:4,LOGIN:5,DIALOG:6,WARNING:7,ALERT:8},$scope.DEPTH_ZONE={INDEX:{SPOTLIGHT:1,CHANNEL:2,CATEGORY:3},DETAIL:{SPOTLIGHT:4,CHANNEL:5,CATEGORY:6},CATEGORY:{VOD:7,CHANNEL:8}},$scope.currentCategory=CONSTANT.CATEGORY.COLORS,$scope.currentDepth=$scope.DEPTH.INDEX,$scope.currentDepthZone=$scope.DEPTH_ZONE.INDEX.SPOTLIGHT;var currentCategoryInHome;$scope.isOverviewDark=!0,$scope.showMediaController=!1,$scope.lastDepth=$scope.currentDepth;var items=($scope.currentDepthZone,CONSTANT.ITEMS);CONSTANT.ITEM;$scope.dataCategory=[items,items,items,items,items,items,items,items,items,items,items],$scope.relatedPlaylist=items,$scope.episodePlaylist=items;$scope.vodListByCategory=[],$scope.isVodCategoryOpened=!1,$scope.bgImgUrl=CONSTANT.SPOTLIGHT_BG_IMG_URL,$scope.bgGradient1=CONSTANT.SPOTLIGHT_BG_GRADIENT1,$scope.bgGradient2=CONSTANT.SPOTLIGHT_BG_GRADIENT2,$scope.bgSize=CONSTANT.SPOTLIGHT_BG_SIZE,$scope.isAuthenticated=Principal.isAuthenticated,$timeout(function(){$scope.bgImgCoverOpacity=0,$scope.bgImgUrl=CONSTANT.SPOTLIGHT_BG_IMG_URL},400),$scope.login={username:"",password:""},$scope.CATEGORY_MENU=CONSTANT.PREPARED_DATA.CATEGORY_MENUS;var video;$scope.menuArray=[],$scope.headerMenus=[],$scope.homeCategoryNameList=[],$scope.homeCategoryDataMap={},$scope.isMediaLoaderHidden=!0,$scope.isMainLoaderShown=!1,$scope.selectedSidebarCategory=null
;var currentSpotlight=null,allChannelList=null,noCategoryInHome=0,isOnline=!0,isChannelListLoaded=!1,isVodListLoaded=!1,isSeriesVodLoaded=!1;main();var lastFocusedGroup,categoryMenuFocusedGroup,lastCategoryVodFocusedGroup,lastCategoryChannelFocusedGroup,lastHomeChannelFocusedGroup,detailPlayFocusedGroup,currentItemData,lastFocusedItem,onSidebarCategoryFocusedTimer,lastOnlineStatus=!0,isGotSpotlight=!1,isScrolling=!1,isLoadNewCategory=!1;$scope.isPlayerShown=!1,$scope.isRelatedShown=!1,$scope.isPlayDisabled=!1,$scope.isInfoShownInPlayer=!0;var detailSectionTimmer,processPlayerTimer,videoProgressTrackTimer,playTime=0;$scope.isChannel=!1,$scope.setting={subTitle:!0};var playingChannel,previousPlayingChannel,mediaControllerTimer;(new Date).getTime(),(new Date).getTime();$scope.dialog={show:!1,center:!0,isConfirm:!0,focusOption:{depth:$scope.DEPTH.DIALOG},onSelectButton:function(buttonIndex,$event){if($scope.dialog.isConfirm)if(0===buttonIndex)try{tizen.application.getCurrentApplication().exit()}catch(error){window.close()}else $scope.dialog.show=!1;else $scope.dialog.show=!1}},$scope.alert={show:!1,center:!0,focusOption:{depth:$scope.DEPTH.ALERT},onSelectButton:function(buttonIndex,$event){$scope.dialog.show=!1}},$scope.warning={show:!1,center:!0,isConfirm:!0,focusOption:{depth:$scope.DEPTH.WARNING}}}function usernameInputClick(){"true"!==$(".login-account-row").attr("focused")&&$("#backToUsername").click()}function passwordInputClick(){"true"!==$(".login-pass-row").attr("focused")&&$("#nextToPass").click()}angular.module("caph.focus",[],["$provide","$compileProvider",function(a,b){function c(a){return a&&a+""}function d(a){var b=jQuery(a).data(),d={};return Object.keys(i.DIRECTION).forEach(function(a){var e=i.DIRECTION[a],f="focusableNextFocus"+h(e),g=b[f];(g||null===g)&&(d[e]=c(g))}),{depth:b.focusableDepth,group:c(b.focusableGroup),name:c(b.focusableName),initialFocus:b.focusableInitialFocus,disabled:b.focusableDisabled,nextFocus:d}}function e(a,b){return a=jQuery(a),a.data({focusableDepth:angular.isNumber(b.depth)?b.depth:i.DEFAULT.DEPTH,focusableGroup:b.group||i.DEFAULT.GROUP,focusableName:b.name||k.get(),focusableInitialFocus:!0===b.initialFocus,focusableDisabled:!0===b.disabled}),b.nextFocus&&Object.keys(b.nextFocus).forEach(function(c){var d="focusableNextFocus"+h(c),e=b.nextFocus[c];(e||null===e)&&a.data(d,e)}),a.data("focusableName")}function f(a){return a&&a instanceof jQuery?a[0]:a}function g(a){return!(!a||a.nodeType!==Node.ELEMENT_NODE)}function h(a){return a?a.charAt(0).toUpperCase()+a.substr(1):a}var i={DIRECTION:{LEFT:"left",RIGHT:"right",UP:"up",DOWN:"down"},DEFAULT:{DEPTH:0,GROUP:"default",KEY_MAP:{LEFT:37,RIGHT:39,UP:38,DOWN:40,ENTER:13},DISTANCE_CALCULATION_STRATEGY:"default"}},j=0,k={get:function(){return"focusable-"+j++}},l=".focusable",m={mouseover:"focus",mouseout:"blur"};void 0!==window.Hammer?(m.tap="select",m.doubletap="select"):m.click="select";var n=["focused","blurred","selected"],o={NameGenerator:k,isFocusable:function(a){return g(a=f(a))&&null!==a.getAttribute("focusable")},isElement:function(a){return g(f(a))},isVisible:function(a){if(g(a=f(a))){for(;a;){if("none"===jQuery.css(a,"display")||"hidden"===jQuery.css(a,"visibility"))return!1;a=a.parentElement}return!0}return!1},getElement:function(a){return g(a=f(a))?a:null},getData:function(a){return o.isFocusable(a)?d(f(a)):null},setData:function(a,b){return o.isFocusable(a)?e(a=f(a),b&&angular.extend(d(a),b)||d(a)):null},bindMouseEvent:function(a,b){return o.isElement(a)&&Object.keys(m).forEach(function(c){jQuery(a).on(c+l,{method:m[c]},b)}),this},bindFocusableEvent:function(a,b){return o.isElement(a)&&n.forEach(function(c){jQuery(a).on(c+l,b)}),this},unbindEvent:function(a){return o.isElement(a)&&jQuery(a).off(l),this}};a.constant("FocusConstant",i),a.constant("FocusUtil",o),a.provider({focusController:FocusControllerProvider,nearestFocusableFinder:NearestFocusableFinderProvider}),b.directive("focusable",focusableDirective)}]),FocusControllerProvider.$inject=["FocusConstant"];var focusableDirective=["$parse","$interpolate","$animate","FocusUtil","nearestFocusableFinder","focusController",function(a,b,c,d,e,f){function g(a,b){return angular.isString(a)&&0===a.indexOf(b)}function h(a,b){return angular.isString(a)&&a.indexOf(b)===a.length-b.length}function i(a,b){switch(b){case"focused":c.addClass(a,j);break;case"blurred":c.removeClass(a,j)}}var j="focused",l=[{focusableDepth:function(a){return 1*a}},{focusableGroup:angular.identity},{focusableName:angular.identity},{focusableInitialFocus:function(a){return"true"===a}},{focusableDisabled:function(a){return"true"===a}},{focusableNextFocusLeft:angular.identity},{focusableNextFocusRight:angular.identity},{focusableNextFocusUp:angular.identity},{focusableNextFocusDown:angular.identity}];return{restrict:"A",scope:!0,link:function(j,m,n){j.$applyAsync(function(a){var d=m.data();l.forEach(function(c){var e=Object.keys(c)[0],f=d[e];f&&g(f,b.startSymbol())&&h(f,b.endSymbol())&&m.data(e,c[e](b(f)(a)))}),e.$$put(m[0],a.$eval(n.focusable)),f.$$setInitialFocusItem(m[0]),d.focusableDisabled&&c.addClass(m,"disabled")}),d.bindMouseEvent(m[0],function(a){var b=a.currentTarget||a.target;!0!==f.$$ignoreMouseEvent&&d.getData(b).depth===f.getCurrentDepth()&&f[a.data.method](b,a)}),d.bindFocusableEvent(m[0],function(b,c){j.$applyAsync(function(d){i(m,b.type),(a(n[n.$normalize("on-"+b.type)])||angular.noop)(d,{$event:b,$originalEvent:c})})}),j.$on("$destroy",function(){d.unbindEvent(e.$$remove(m[0])),m.remove()}),void 0!==window.Hammer&&(Hammer.defaults.domEvents=!0,new Hammer(m[0]))}}}];NearestFocusableFinderProvider.$inject=["FocusConstant","focusControllerProvider"];var caphButtonDirective=["$parse","focusController","FocusUtil",function(a,b,c){return{restrict:"E",transclude:!0,template:'<div class="{{buttonClass}}" focusable ng-transclude on-focused="focus($event, $originalEvent)" on-selected="select($event, $originalEvent)" on-blurred="blur($event, $originalEvent)"></div>',scope:!0,link:function(b,d,e){var f=!1,g=d.find("div"),h=b.$eval(e.toggle)||{};b.buttonClass=e.buttonClass||"caph-button";var i=b.$eval(e.focusOption);e.$observe("buttonClass",function(a){b.buttonClass=a}),i&&c.setData(g,i),b.focus=function(c,d){(a(e.onFocused)||angular.noop)(b.$parent,{$event:c,$originalEvent:d})},b.blur=function(c,d){(a(e.onBlurred)||angular.noop)(b.$parent,{$event:c,$originalEvent:d})},b.select=function(c,d){h?(f=!f,(a(e.onSelected)||angular.noop)(b.$parent,{$event:c,$selected:f,$originalEvent:d}),g.toggleClass("selected")):(a(e.onSelected)||angular.noop)(b.$parent,{$event:c,$originalEvent:d})}}}}],caphCheckboxDirective=["$parse","focusController","FocusUtil",function(a,b,c){return{restrict:"E",transclude:!0,template:'<div class="{{checkboxClass}}"focusable ng-transclude on-focused="focus($event, $originalEvent)" on-selected="select($event, $originalEvent)" on-blurred="blur($event, $originalEvent)" ng-class="{checked : checked}">{{check}}</div>',scope:!0,link:function(b,d,e){b.checked=b.$eval(e.checked)||!1,b.checkboxClass=e.class||"caph-checkbox",e.$observe("checkboxClass",function(a){b.checkboxClass=a});var f=d.find("div"),g=b.$eval(e.focusOption);g&&c.setData(f,g),b.focus=function(c,d){(a(e.onFocused)||angular.noop)(b.$parent,{$event:c,$originalEvent:d})},b.blur=function(c,d){(a(e.onBlurred)||angular.noop)(b.$parent,{$event:c,$originalEvent:d})},b.select=function(c,d){b.checked=!b.checked,(a(e.onSelected)||angular.noop)(b.$parent,{$event:c,$checked:b.checked,$originalEvent:d})}}}}],caphTranscludeDirective=[function(){return{restrict:"A",link:function(a,b,c,d,e){var f=c.caphTransclude;e(function(a){if(f){var c="";for(var d in a)if(a[d].tagName&&f.toLowerCase()===a[d].tagName.toLowerCase()){c=a[d];break}b.empty(),b.append(c)}else b.empty(),b.append(a)})}}}],caphContextMenuItemTemplateDirective=["$sce","$compile",function(a,b){return{restrict:"E",require:["?^caphContextMenu"],tranclude:!0,link:function(c,d){c.$parent.$watch("item",function(b){for(var d in b)c[d]="content"===d?a.trustAsHtml(b[d]+""):b[d]},!0),d.replaceWith(b("<span>"+d.html()+"</span>")(c))}}}],caphContextMenuArrowUpTemplateDirective=function(){return{restrict:"E",require:["?^caphContextMenu"],tranclude:!0}},caphContextMenuArrowDownTemplateDirective=function(){return{restrict:"E",require:["?^caphContextMenu"],tranclude:!0}},caphContextMenuDirective=["$parse","focusController","FocusConstant","$timeout","$window",function(a,b,c,d,e){var f={FOCUSABLE_DEPTH:1e4},g={translateTo:function(a,b,c){a&&a.css("transform","translate3d("+b+"px,"+c+"px, 0)")},getSuitablePosition:function(a,b,c){var d=a.offset();for(var f in b)if(d.left+b[f].x>0&&d.left+b[f].x+a.outerWidth()<angular.element(e).width()&&(c||d.top+b[f].y>0&&d.top+b[f].y+a.outerHeight()<angular.element(e).height()))return b[f];return b.length>0?b[0]:void 0},getCalculatedOffset:function(a,b){var c=a.offset();return{x:b.x-c.left,y:b.y-c.top}}};return{restrict:"E",template:'<div class="caph-context-menu {{menuList[\'root\'].option.class}}" ng-class="{{menuList[\'root\'].option.class}}"><div class="arrow-up" ng-show="menuList[\'root\'].option.visibleItemCount > 0 && menuList[\'root\'].option.visibleItemCount < menuList[\'root\'].itemList.length" ng-click="onSelectUpButton($event)" caph-transclude="caph-context-menu-arrow-up-template"></div><ul ng-style="menuList[\'root\'].option.style" data-visible-item-count="{{menuList[\'root\'].option.visibleItemCount}}" data-scroll-count="0" data-submenu-id="root"><li ng-repeat="item in menuList[\'root\'].itemList" id="{{item.id}}" focusable data-focusable-depth="{{menuList[\'root\'].focusableDepth}}" data-focusable-initial-focus="{{$index===0}}" ng-class="{hasSubMenu:menuList[item.id], opened:(menuList[item.id] && menuList[item.id].show), disabled:item.disabled}"  data-focusable-disabled="{{item.disabled || checkItemExist(menuList[\'root\'].itemList, item)}}" on-selected="onSelectItem($event, (menuList[item.id])?item.id:false)" ng-click="onClickItem((menuList[item.id])?item.id:false)"  on-focused="focusItem($event, $originalEvent)" on-blurred="blurItem($event, $originalEvent)" caph-transclude="caph-context-menu-item-template"></li></ul><div class="arrow-down" ng-show="menuList[\'root\'].option.visibleItemCount > 0 && menuList[\'root\'].option.visibleItemCount < menuList[\'root\'].itemList.length" ng-click="onSelectDownButton($event)" caph-transclude="caph-context-menu-arrow-down-template"></div></div><div class="caph-context-menu {{submenu.option.class}}" ng-repeat="(menuId, submenu) in menuList" ng-if="menuId != \'root\'" ng-show="submenu.show" id="sub_{{menuId}}" data-submenu-id="{{menuId}}"><div class="arrow-up" ng-show="submenu.option.visibleItemCount > 0 && submenu.option.visibleItemCount < submenu.itemList.length" ng-click="onSelectUpButton($event)" caph-transclude="caph-context-menu-arrow-up-template"></div><ul ng-style="submenu.option.style" data-visible-item-count="{{submenu.option.visibleItemCount}}" data-scroll-count="0" data-submenu-id="{{menuId}}"><li ng-repeat="item in submenu.itemList" id="{{item.id}}" focusable data-focusable-depth="{{submenu.focusableDepth}}" data-focusable-initial-focus="{{$index===0}}"  data-focusable-disabled="{{item.disabled || checkItemExist(submenu.itemList, item)}}" on-selected="onSelectItem($event, (menuList[item.id])?item.id:false)" ng-click="onClickItem((menuList[item.id])?item.id:false)"  on-focused="focusItem($event, $originalEvent)" on-blurred="blurItem($event, $originalEvent)" data-previous-depth="{{subMenu.previousDepth}}" ng-class="{hasSubMenu:menuList[item.id], opened:(menuList[item.id] && menuList[item.id].show), disabled:item.disabled}" caph-transclude="caph-context-menu-item-template"></li></ul><div class="arrow-down" ng-show="submenu.option.visibleItemCount > 0 && submenu.option.visibleItemCount < submenu.itemList.length" ng-click="onSelectDownButton($event)" caph-transclude="caph-context-menu-arrow-down-template"></div></div>',transclude:!0,scope:!0,link:function(e,h,i){e.focusableDepth=angular.isNumber(1*i.focusableDepth)?1*i.focusableDepth:f.FOCUSABLE_DEPTH,e.show=!0,e.menuList={};var j,k=b.getCurrentDepth();e.checkItemExist=function(a,b){return $.inArray(b,a)<0},e.onSelectItem=function(b,c){var d=angular.element(b.currentTarget);c?e.menuList[c].show?y(c):x(c,d):(a(i.onSelectItem)||angular.noop)(e.$parent,{$itemId:d.attr("id"),$event:b})},e.focusItem=function(b,c){(a(i.onFocusItem)||angular.noop)(e.$parent,{$event:b,$originalEvent:c})},e.blurItem=function(b,c){(a(i.onBlurItem)||angular.noop)(e.$parent,{$event:b,$originalEvent:c})},e.onClickItem=function(a){a&&(w[a]=d(function(){y(a),delete w[a]},700))},e.onSelectUpButton=function(a){var b=angular.element(a.currentTarget).next();z(b,"up",b.data("visibleItemCount"))},e.onSelectDownButton=function(a){var b=angular.element(a.currentTarget).prev();z(b,"down",b.data("visibleItemCount"))};var l=function(a){b.setDepth(angular.element(a.currentTarget).data("focusableDepth")),b.focus(a.currentTarget)},m=function(a){var b=angular.element(a.currentTarget).data("submenuId");b&&(w[b]=d(function(){y(b),delete w[b]},700))},n=function(a){var b=angular.element(a.currentTarget).data("submenuId"),c=e.menuList[b]?e.menuList[b].parentId:void 0;b&&w[b]&&(d.cancel(w[b]),delete w[b]),c&&w[c]&&(d.cancel(w[c]),delete w[c])},o=function(){B()},p=function(a){var b,d,e;if(a.event.keyCode===c.DEFAULT.KEY_MAP.LEFT){var f=angular.element(a.currentFocusItem).parent().data("submenuId");"root"===f?B():y(f)}else if(a.event.keyCode===c.DEFAULT.KEY_MAP.DOWN){if(b=angular.element(a.currentFocusItem).parent(),b.data("visibleItemCount")){d=b.find("li"),e=jQuery.inArray(a.currentFocusItem,d);var g=e-b.data("scrollCount")-b.data("visibleItemCount")+1;e-b.data("scrollCount")>=b.data("visibleItemCount")&&z(b,"down",b.data("visibleItemCount"),g)}}else a.event.keyCode===c.DEFAULT.KEY_MAP.UP&&(b=angular.element(a.currentFocusItem).parent(),b.data("visibleItemCount")&&(d=b.find("li"),(e=jQuery.inArray(a.currentFocusItem,d))-b.data("scrollCount")<0&&z(b,"up",b.data("visibleItemCount"),b.data("scrollCount")-e)))},q=function(){angular.element(document).off("click",o)},r=function(){angular.isNumber(k)&&(b.setDepth(k),angular.element(document).on("click",o))},s=function(a,b){var c={};for(var d in a){if(a[d].parent||(a[d].parent="root"),!a[d].id||!a[d].content)throw new Error("Each data should have properties 'id' and 'content'");if(c[a[d].id])throw new Error("Item's id is duplicated. (id = '"+a[d].id+"')");c[a[d].id]=a[d]}var e={},f=function(a,b){e[a]={focusableDepth:b+Object.keys(e).length,previousDepth:void 0,menuDepth:void 0,itemList:[],option:{},show:!1}};f("root",b);for(var g in a)e[a[g].parent]||f(a[g].parent,b),e[a[g].parent].itemList.push(a[g]);for(var h in e)if("root"===h)e[h].menuDepth=0;else{if(!c[h])throw Error("Parent item is not exist for the item (id = '"+h+"')");for(var i=h,j=1,k=e[c[i].parent].focusableDepth;c[i]&&"root"!==c[i].parent;)i=c[i].parent,j++;e[h].previousDepth=k,e[h].menuDepth=j,e[h].parentId=c[h].parent}return e},t=function(a){if(a)for(var b in e.menuList)a[e.menuList[b].menuDepth]&&(e.menuList[b].option=a[e.menuList[b].menuDepth])};e.$watch(i.items,function(a){e.menuList=s(a,e.focusableDepth),j=e.$eval(i.menuOption)||{},t(j)},!0),e.$watch(i.menuOption,function(a){j=a,t(j)},!0);var u;e.$watch(i.position,function(a){u=a;var b=h.find(".caph-context-menu:first-child");if(u&&angular.isNumber(u.x)&&angular.isNumber(u.y)){g.translateTo(b,0,0);var c=g.getCalculatedOffset(b,u);g.translateTo(b,c.x,c.y)}});var v=h.offset(),w={},x=function(a,c){e.menuList[a].show=!0;var d=angular.element(c).offset(),f=e.menuList[a].option.offset||{x:0,y:0},h=angular.element("#sub_"+a);h.removeClass("ng-hide");var i=g.getSuitablePosition(h,[{x:angular.element(c).outerWidth()+d.left-v.left+f.x,y:d.top-v.top+f.y},{x:d.left-v.left-h.outerWidth()-f.x,y:d.top-v.top+f.y}],!0);g.translateTo(h,i.x,i.y),b.setDepth(e.menuList[a].focusableDepth);var j=angular.element("#sub_"+a+">ul>li");e.menuList[a].option.visibleItemCount=Math.min(j.length,e.menuList[a].option.visibleItemCount),e.menuList[a].option.visibleItemCount&&(e.menuList[a].option.style.height=j.eq(0).outerHeight()*e.menuList[a].option.visibleItemCount,e.menuList[a].option.style.overflow="hidden")},y=function(a){if(a){e.menuList[a].show=!1;for(var c in e.menuList)e.menuList[c].parentId===a&&(e.menuList[c].show=!1);b.setDepth(e.menuList[a].previousDepth)}else{for(var f in e.menuList)e.menuList[f].show=!1,w[f]&&(d.cancel(w[f]),delete w[f]);b.setDepth(e.menuList.root.focusableDepth)}},z=function(a,b,c,d){var e=a.find("li");d=Math.abs(d)||1,"up"===b&&a.data("scrollCount")>0?a.data("scrollCount",a.data("scrollCount")-d):"down"===b&&a.data("scrollCount")<e.length-c&&a.data("scrollCount",a.data("scrollCount")+d),g.translateTo(e,0,a.data("scrollCount")*e.eq(0).outerHeight()*-1)};e.$watch(i.show,function(a){!0===a?A():B()});var A=function(){if(!e.$eval(i.show)){a(i.show).assign(e,!0),e.$applyAsync()}h.removeClass("ng-hide");var d=h.find(".caph-context-menu:first-child");if(u&&angular.isNumber(u.x)&&angular.isNumber(u.y)){g.translateTo(d,0,0);var f=g.getCalculatedOffset(d,u);g.translateTo(d,f.x,f.y)}var j=d.find(">ul>li");e.menuList.root.option.visibleItemCount=Math.min(j.length,e.menuList.root.option.visibleItemCount),e.menuList.root.option.visibleItemCount&&(e.menuList.root.option.style.height=j.eq(0).outerHeight()*e.menuList.root.option.visibleItemCount,e.menuList.root.option.style.overflow="hidden"),angular.isNumber(e.focusableDepth)&&b.setDepth(e.focusableDepth),b.addAfterKeydownHandler(p),angular.element(document).on("click",o);var k=h.find("div.caph-context-menu");k.on("mouseover",n).on("mouseleave",m),k.find("> ul > li").on("mouseover",l),h.on("mouseover",q).on("mouseleave",r),e.$applyAsync()},B=function(){h.addClass("ng-hide"),y(),angular.isNumber(k)&&b.setDepth(k),b.removeAfterKeydownHandler(p),angular.element(document).off("click",o);var c=h.find("div.caph-context-menu");if(c.off("mouseover",n).off("mouseleave",m),c.find("> ul > li").off("mouseover",l),h.off("mouseover",q).off("mouseleave",r),e.$eval(i.show)){a(i.show).assign(e,!1),e.$applyAsync()}};if(void 0!==window.Hammer){var C,D,E=h.find(".caph-context-menu > ul"),F=new Hammer.Manager(E[0],{recognizers:[[Hammer.Pan,{direction:Hammer.DIRECTION_ALL}]]}),G=0;F.on("panmove",function(a){var b=$(a.target).parents("div.caph-context-menu>ul");return!(!b.data("submenuId")||!H(b.data("visibleItemCount"),e.menuList[b.data("submenuId")].itemList.length))&&void g.translateTo(D,0,G+a.deltaY)}),F.on("panstart",function(a){var b=$(a.target).parents("div.caph-context-menu>ul");return!(!b.data("submenuId")||!H(b.data("visibleItemCount"),e.menuList[b.data("submenuId")].itemList.length))&&(D=E.find("> li"),G=E.data("scrollCount")*D.outerHeight()*-1,C=D.css("transition"),void D.css("transition","transform 0s ease"))}),F.on("panend",function(a){var b=$(a.target).parents("div.caph-context-menu>ul");if(!b.data("submenuId")||!H(b.data("visibleItemCount"),e.menuList[b.data("submenuId")].itemList.length))return!1;var c=D.outerHeight();if(a.deltaY>0)var d=-1*Math.ceil(a.deltaY/c);else var d=-1*Math.floor(a.deltaY/c);var f=b.find("li").length-b.data("visibleItemCount");E.data("scrollCount")+d<0?(d=0,E.data("scrollCount",0)):E.data("scrollCount")+d>f&&(d=0,E.data("scrollCount",f));var h=(E.data("scrollCount")+d)*c*-1;g.translateTo(D,0,h),E.data("scrollCount",E.data("scrollCount")+d),C&&D.css("transition",C)});var H=function(a,b){return!(!$.isNumeric(a)||!$.isNumeric(b))&&b>a}}}}}],caphDialogTitleDirective=function(){return{restrict:"E",require:"?^caphDialog",template:'<div class="title-area"><div class="title-wrapper"><div class="title" ng-transclude></div></div></div>',transclude:!0}},caphDialogContentDirective=function(){return{restrict:"E",require:"?^caphDialog",transclude:!0,template:'<div class="content-area"><div class="content" ng-transclude></div></div>'}},caphDialogButtonsDirective=["DialogUtil","$parse",function(a,b){return{restrict:"E",require:"^caphDialog",scope:!0,template:'<div class="caph-dialog-button-area"><div class="button-wrapper" ng-if="btnTypeConfirm"><div class="caph-dialog-button" on-selected="onSelectButton(0, $event)" focusable="{depth: {{focusOption.depth}}, initialFocus: true}" data-focusable-group="{{focusOption.group}}" on-focused="focus($event)" on-blurred="blur($event)"><div class="button-text">Đồng ý</div></div><div class="caph-dialog-button" on-selected="onSelectButton(1, $event)" focusable="{depth: {{focusOption.depth}}}" on-focused="focus($event)" data-focusable-group="{{focusOption.group}}" on-blurred="blur($event)"><div class="button-text">Hủy</div></div></div><div class="button-wrapper" ng-if="btnTypeAlert"><div class="caph-dialog-button" on-selected="onSelectButton(0, $event)" focusable="{depth: {{focusOption.depth}}, initialFocus: true}" data-focusable-group="{{focusOption.group}}" on-focused="focus($event)" on-blurred="blur($event)"><div class="button-text">OK</div></div></div></div>',link:function(a,c,d,e){var f=d.buttonType;f&&"confirm"===f?a.btnTypeConfirm=!0:f&&"alert"===f&&(a.btnTypeAlert=!0),a.focusOption=e.getFocusOption(),a.onSelectButton=function(c,e){(b(d.onSelectButton)||angular.noop)(a.$parent,{$buttonIndex:c,$event:e})}}}}],caphDialogDirective=["dialogManager","$parse","DialogUtil","DialogConstant","focusController","$timeout",function(a,b,c,d,e,f){return{restrict:"E",template:'<div class="caph-dialog" ng-transclude></div>',transclude:!0,scope:!1,controller:["$scope","$element","$attrs",function(a,b,c){var e=a.$eval(c.focusOption)||{depth:d.DEFAULT.focusableDepth};e.group=e.group||"default",this.getFocusOption=function(){return e}}],link:function(g,h,i){var j={};j.timeout=g.$eval(i.timeout),j.center=g.$eval(i.center),j.position=g.$eval(i.position),j.focusOption=g.$eval(i.focusOption)||{depth:d.DEFAULT.focusableDepth},j.focusOption.group=j.focusOption.group||"default",j.modal=!0;var k,l=a.generateDialogId();a.addDialog(l,h,j);var m=e.getCurrentDepth(),n=h.find("> :first-child"),o=function(){if(!g.$eval(i.show)){b(i.show).assign(g,!0)}!0===j.center?c.moveToCenter(n):j.position&&c.translateTo(n,j.position.x,j.position.y),e.setDepth(j.focusOption.depth,j.focusOption.group),a.manageModal(l,!0),(b(i.onOpen)||angular.noop)(g),k&&(f.cancel(k),k=null),angular.isNumber(j.timeout)&&(k=f(function(){h.addClass("ng-hide"),p(),k=null},j.timeout))},p=function(){if(g.$eval(i.show)){b(i.show).assign(g,!1)}k&&(f.cancel(k),k=null),angular.isNumber(m)&&e.setDepth(m),a.manageModal(l,!1),(b(i.onClose)||angular.noop)(g)};g.$watch(i.center,function(a,b){a&&b&&!0===a&&c.moveToCenter(n)}),g.$watch(i.position,function(a,b){a&&b&&a&&c.translateTo(n,a.x,a.y)}),h.addClass("caph-dialog"),g.$watch(i.show,function(a){!0===a?(h.removeClass("ng-hide"),o()):!1===a&&(h.addClass("ng-hide"),p())})}}}],dialogManagerProvider=function(){var a,b={},c=0,d={generateDialogId:function(){return c+++"_"+(new Date).getTime()},addDialog:function(a,c,d){if(this.getDialog(a))throw new Error("Dialog ID ("+a+") is already registered.");b[a]={element:c,option:d,isOpened:!1}},getDialog:function(a){return b[a]},createDim:function(){a||(a=document.createElement("div"),a.classList.add("caph-dim-init"),document.getElementsByTagName("body")[0].appendChild(a))},activateDim:function(){a||this.createDim(),a.classList.add("caph-dim-translucent")},deactivateDim:function(){a&&a.classList.remove("caph-dim-translucent")},manageModal:function(a,c){var e=this.getDialog(a);if(!e)throw new Error("Dialog ("+a+") is not registered. Is this id correct?");if(e.isOpened=c,e.option.modal){c?d.activateDim():d.deactivateDim();for(var f in b)f!==a&&b[f].option.modal&&b[f].isOpened&&(b[f].element.addClass("ng-hide"),b[f].isOpened=!1)}}};return{$get:function(){return{generateDialogId:d.generateDialogId,addDialog:d.addDialog,getDialog:d.getDialog,manageModal:d.manageModal}}}},caphDropdownListItemTemplateDirective=["$sce","$compile",function(a,b){return{restrict:"E",require:["?^caphDropdownList"],tranclude:!0,link:function(c,d){c.$parent.$watch("item",function(b){for(var d in b)c[d]="content"===d?a.trustAsHtml(b[d]+""):b[d]},!0),d.replaceWith(b("<span>"+d.html()+"</span>")(c))}}}],caphDropdownListPlaceholderTemplateDirective=["$compile",function(a){return{restrict:"E",require:"?^caphDropdownList",tranclude:!0,link:function(b,c){c.replaceWith(a("<span>"+c.html()+"</span>")(b))}}}],caphDropdownArrowUpTemplateDirective=[function(){return{restrict:"E",require:"?^caphDropdownList",tranclude:!0}}],caphDropdownArrowDownTemplateDirective=[function(){return{restrict:"E",require:"?^caphDropdownList",tranclude:!0}}],caphDropdownListDirective=["$parse","focusController","FocusConstant","FocusUtil","$timeout",function(a,b,c,d,e){var f={FOCUSABLE_DEPTH:2e4},g={translateTo:function(a,b,c){a&&a.css("transform","translate3d("+b+"px,"+c+"px, 0)")}};return{restrict:"E",template:'<div class="caph-dropdown-list"><div class="placeholder" ng-class="{focused: focused, selected: showList}" focusable="focusForPlaceholder" caph-transclude="caph-dropdown-list-placeholder-template"></div><div class="list-container" ng-show="showList"><div class="textbox arrow-up" ng-show="showArrowUp" ng-click="onSelectUpButton($event)"><div class="label center" caph-transclude="caph-dropdown-list-arrow-up-template"></div></div><div class="list-items" ng-style="listContainerStyle" data-scroll-count="0" data-visible-item-count="{{visibleItemCount}}"><div class="textbox" ng-repeat="item in items" focusable="focusForList" data-disabled="{{item.disabled}}" on-selected="onSelectItem($event, item.id)"><div class="label" caph-transclude="caph-dropdown-list-item-template"></div></div></div><div class="textbox arrow-down" ng-show="showArrowDown" ng-click="onSelectDownButton($event)"><div class="label center" caph-transclude="caph-dropdown-list-arrow-down-template"></div></div></div></div>',transclude:!0,scope:!0,link:function(d,h,i){d.visibleItemCount=d.$eval(i.visibleItemCount)||0,d.focusForPlaceholder=d.$eval(i.focusOption)||{depth:b.getCurrentDepth()},d.focusForList={depth:d.focusForPlaceholder.depth+f.FOCUSABLE_DEPTH||f.FOCUSABLE_DEPTH,group:d.focusForPlaceholder.group,disabled:!0},d.showList=d.focused=d.selected=d.disabled=!1;var j=h.find(".placeholder"),k=h.find(".list-container"),l=k.find(".list-items"),m=function(){d.$applyAsync(function(a){a.showList=!0}),d.visibleItemCount>0&&d.visibleItemCount<d.items.length&&(d.listContainerStyle={height:d.visibleItemCount*h.find(".list-items>.textbox").outerHeight(),overflow:"hidden"},d.showArrowUp=h.find("caph-dropdown-list-arrow-up-template").length>0,d.showArrowDown=h.find("caph-dropdown-list-arrow-down-template").length>0),b.addBeforeKeydownHandler(p),b.addAfterKeydownHandler(q),k.on("mouseover",s).on("mouseleave",t),e(function(){h.find(".list-items>.textbox").each(function(){!0!==angular.element(this).data("disabled")&&b.enable(this)}),b.setDepth(d.focusForList.depth),angular.element(document).on("click",r)},0)},n=function(){h.find(".list-items>.textbox").each(function(){b.disable(this)}),d.showList=!1,b.setDepth(d.focusForPlaceholder.depth),b.removeBeforeKeydownHandler(p),b.removeAfterKeydownHandler(q),k.off("mouseover",s).off("mouseleave",t),angular.element(document).off("click",r)},o=function(a,b,c,d){var e=a.find(".textbox");d=Math.abs(d)||1,"up"===b&&a.data("scrollCount")>0?a.data("scrollCount",a.data("scrollCount")-d):"down"===b&&a.data("scrollCount")<e.length-c&&a.data("scrollCount",a.data("scrollCount")+d),g.translateTo(e,0,a.data("scrollCount")*e.eq(0).outerHeight()*-1)};d.$watch(i.items,function(a){d.items=a},!0);var p=function(a){return a.event.keyCode===c.DEFAULT.KEY_MAP.LEFT||a.event.keyCode===c.DEFAULT.KEY_MAP.RIGHT?(n(),!1):void 0},q=function(a){var b,d,e;if(a.event.keyCode===c.DEFAULT.KEY_MAP.DOWN){if(b=angular.element(a.currentFocusItem).parent(),b.data("visibleItemCount")){d=b.find(".textbox"),e=jQuery.inArray(a.currentFocusItem,d);var f=e-b.data("scrollCount")-b.data("visibleItemCount")+1;e-b.data("scrollCount")>=b.data("visibleItemCount")&&o(b,"down",b.data("visibleItemCount"),f)}}else a.event.keyCode===c.DEFAULT.KEY_MAP.UP&&(b=angular.element(a.currentFocusItem).parent(),b.data("visibleItemCount")&&(d=b.find(".textbox"),(e=jQuery.inArray(a.currentFocusItem,d))-b.data("scrollCount")<0&&o(b,"up",b.data("visibleItemCount"),b.data("scrollCount")-e)))},r=function(){n()},s=function(){angular.element(document).off("click",r)},t=function(){angular.element(document).on("click",r)};if(d.onSelectItem=function(b,c){(a(i.onSelectItem)||angular.noop)(d.$parent,{$itemId:c,$event:b}),n()},d.onSelectUpButton=function(a){var b=angular.element(a.currentTarget).next();o(b,"up",b.data("visibleItemCount"))},d.onSelectDownButton=function(a){var b=angular.element(a.currentTarget).prev();o(b,"down",b.data("visibleItemCount"))},j.on("focused",function(){d.focused=!0}),j.on("blurred",function(){d.focused=!1}),j.on("selected",function(){d.showList?n():m()}),void 0!==window.Hammer){var u,v,w=new Hammer.Manager(l[0],{recognizers:[[Hammer.Pan,{direction:Hammer.DIRECTION_ALL}]]}),x=0;w.on("panmove",function(a){g.translateTo(v,0,x+a.deltaY)}),w.on("panstart",function(){return!!y(d.visibleItemCount,d.items.length)&&(v=l.find(".textbox"),x=l.data("scrollCount")*l.find(".textbox").outerHeight(),u=v.css("transition"),void v.css("transition","transform 0s ease"))}),w.on("panend",function(a){var b=l.find(".textbox").outerHeight();if(a.deltaY>0)var c=Math.ceil(a.deltaY/b);else var c=Math.floor(a.deltaY/b);c+l.data("scrollCount")>0&&(c=0,l.data("scrollCount",0));var e=d.items.length-d.visibleItemCount;e<Math.abs(l.data("scrollCount")+c)&&(c=0,l.data("scrollCount",-1*e)),g.translateTo(v,0,(l.data("scrollCount")+c)*b),l.data("scrollCount",l.data("scrollCount")+c),u&&v.css("transition",u)});var y=function(a,b){return!!($.isNumeric(a)&&$.isNumeric(b)&&a>0)&&b>a}}}}}],caphInputDirective=["$parse","focusController","FocusConstant","FocusUtil",function(a,b,c,d){return{restrict:"E",transclude:!0,template:'<input type="{{inputType}}" placeholder={{placeHolder}} value={{inputValue}} maxLength={{maxLength}} class="{{inputClass}}" focusable on-focused="focus($event, $originalEvent)" on-selected="select($event, $originalEvent)" on-blurred="blur($event, $originalEvent)">',scope:!0,link:function(e,f,g){e.inputClass=g.inputClass||"caph-input",e.inputType=g.type||"text",e.maxLength=e.$eval(g.maxLength)||40,e.placeHolder=g.placeHolder||"";var h=!1;g.$observe("inputClass",function(a){e.inputClass=a}),e.$watch("inputValue",function(){a(g.value).assign(e.$parent,e.inputValue)}),e.$parent.$watch(g.value,function(){e.inputValue=e.$eval(g.value)}),b.addBeforeKeydownHandler(function(a){var b=i[0],d=a.currentFocusItem;if(!h)return!0;if(b!==d)return!1;var e=b.selectionStart,f=b.value.length,g=a.event.keyCode;return!(g===c.DEFAULT.KEY_MAP.RIGHT&&f>e||g===c.DEFAULT.KEY_MAP.LEFT&&e>0)&&void 0});var i=f.find("> input"),j=e.$eval(g.focusOption);j&&d.setData(i,j),e.focus=function(b,d){(a(g.onFocused)||angular.noop)(e.$parent,{$event:b,$originalEvent:d}),d&&"keydown"===d.type&&d.keyCode===c.DEFAULT.KEY_MAP.ENTER&&i.focus()},e.blur=function(b,c){(a(g.onBlurred)||angular.noop)(e.$parent,{$event:b,$originalEvent:c}),c&&"keydown"===c.type&&i.blur()},e.select=function(b,c){i.blur(),i.focus(),(a(g.onSelected)||angular.noop)(e.$parent,{$event:b,$originalEvent:c})},i.on("focus",function(a){h=!0}),i.on("blur",function(a){h=!1}),i.on("change",function(b){e.$applyAsync(function(c){var d=b.target.value;c.inputValue=d,(a(g.onChanged)||angular.noop)(e.$parent,{$event:b,value:e.inputValue})})})}}}],caphListDirective=["$parse","$document","$window","$timeout","$interval","VendorUtil","FocusConstant","FocusUtil","focusController","listItemLoader",function(a,b,c,d,e,f,g,h,i,j){function k(a){return a>0&&a!==1/0}var l=".caph-list",m={ROW_COUNT:1,COLUMN_COUNT:1,DIRECTION:"horizontal",CONTAINER_CLASS:"caph-list-container",WRAPPER_CLASS:"caph-list-wrapper",DURATION:"0.5s",EASE:"ease-out",LOOP:!1,DELAY:100,
MOUSE_SCROLL_AREA_SIZE:20,PAGE_BUFFER_SIZE:1,KEY:"item"},n=[{name:"containerClass",defaultValue:m.CONTAINER_CLASS},{name:"wrapperClass",defaultValue:m.WRAPPER_CLASS},{name:"initialized",defaultValue:!1}],o=i.getKeyMap();return{restrict:"E",transclude:!0,scope:!0,template:'<div class="{{containerClass}}" ng-show="initialized"><div class="{{wrapperClass}}" style="position: absolute"></div></div>',compile:function(g,p){function q(a,b){var c,d,e,f,g=B.width,h=B.height,i=C.width,j=C.height,l=h/j,m=g/i;if(!k(l)||!k(m))throw new Error("The caph-list's container and template view should have their own size such as width and height.");if(c=Math.floor(l),d=Math.floor(m),1>c||1>d)throw new Error("Please check the container and template view size. The calculated row or column count is less than 1.");e=Math.ceil(l),f=Math.ceil(m);var n={getMaxItemViewCount:function(){return this.getItemViewCountPerPage()*(2*b+1)},getMaxPageIndex:function(a){return Math.floor((a-1)/this.getItemViewCountPerPage())},getPageIndex:function(a){return Math.floor(a/this.getItemViewCountPerPage())},getStartItemIndex:function(a){return(a-b)*this.getItemViewCountPerPage()},getNextStartItemIndex:function(a){return(a+b+1)*this.getItemViewCountPerPage()},getPosition:function(a){var b=this.getRowIndex(a),c=this.getColumnIndex(a);return{top:b*j,left:c*i,rowIndex:b,columnIndex:c}},getNextPosition:function(a,b){var c=this.getPosition(a);switch(b){case o.LEFT:c.left-=i,c.columnIndex--;break;case o.RIGHT:c.left+=i,c.columnIndex++;break;case o.UP:c.top-=j,c.rowIndex--;break;case o.DOWN:c.top+=j,c.rowIndex++}return c}};return{horizontal:angular.extend({},n,{getItemViewCountPerPage:function(){return c*(d+1)},getRowIndex:function(a){return a%c},getColumnIndex:function(a){return Math.floor(a/c)},getTranslate:function(a,b,c){return c=angular.isNumber(c)?c:0,"translate3d("+(b*-i+c)+"px, 0px, 0px)"},getScrollIndex:function(a,b){return Math.max(0,this.getColumnIndex(a)-b)},getNextScrollIndex:function(a,b,c){var e=Math.ceil(b/i),f=a-e;return 0>b&&f++,f>c-d?f=c-d:0>f&&(f=0),f},isVisibleItem:function(a,b,c){return b>=c&&c+f>b},getMouseScrollKeyCode:function(b,c){var d=Math.abs(b-A.left);return a>d?o.LEFT:d>g-a?o.RIGHT:0},isScrollDirection:function(a){switch(a){case o.LEFT:case o.RIGHT:return!0}return!1},getRotateItemIndex:function(a,b,d){return b>0?a:Math.min(d-1,this.getMaxColumnIndex(d)*c+a)},getMaxRowIndex:function(){return c-1},getMaxColumnIndex:function(a){return Math.floor((a-1)/c)},getScrollStartCount:function(){return d},getInitialScrollCount:function(a){return Math.min(this.getScrollStartCount(),this.getColumnIndex(a))},isPreviousDirection:function(a){return a===o.LEFT},isNextDirection:function(a){return a===o.RIGHT},getScrollCountVariation:function(a,b){return this.getColumnIndex(b)-this.getColumnIndex(a)},isReachedStart:function(a){return 0===this.getColumnIndex(a)},isReachedEnd:function(a,b){return this.getColumnIndex(a)===this.getMaxColumnIndex(b)}}),vertical:angular.extend({},n,{getItemViewCountPerPage:function(){return(c+1)*d},getRowIndex:function(a){return Math.floor(a/d)},getColumnIndex:function(a){return a%d},getTranslate:function(a,b,c){return c=angular.isNumber(c)?c:0,"translate3d(0px, "+(b*-j+c)+"px, 0px)"},getScrollIndex:function(a,b){return Math.max(0,this.getRowIndex(a)-b)},getNextScrollIndex:function(a,b,d){var e=Math.ceil(b/j),f=a-e;return 0>b&&f++,f>d-c?f=d-c:0>f&&(f=0),f},isVisibleItem:function(a,b,c){return a>=c&&c+e>a},getMouseScrollKeyCode:function(b,c){var d=Math.abs(c-A.top);return a>d?o.UP:d>h-a?o.DOWN:0},isScrollDirection:function(a){switch(a){case o.UP:case o.DOWN:return!0}return!1},getRotateItemIndex:function(a,b,c){return a>0?b:Math.min(c-1,this.getMaxRowIndex(c)*d+b)},getMaxRowIndex:function(a){return Math.floor((a-1)/d)},getMaxColumnIndex:function(){return d-1},getScrollStartCount:function(){return c},getInitialScrollCount:function(a){return Math.min(this.getScrollStartCount(),this.getRowIndex(a))},isPreviousDirection:function(a){return a===o.UP},isNextDirection:function(a){return a===o.DOWN},getScrollCountVariation:function(a,b){return this.getRowIndex(b)-this.getRowIndex(a)},isReachedStart:function(a){return 0===this.getRowIndex(a)},isReachedEnd:function(a,b){return this.getRowIndex(a)===this.getMaxRowIndex(b)}})}}function r(a,b,c){function d(a,b){var d;w.append(a.addClass("ng-hide")),d=a.filter(function(){return this.nodeType===Node.ELEMENT_NODE}).on("focused"+l,c),b.$on("$destroy",function(){d.off(l)}),f.push({element:d,scope:b})}var e,f=[];for(e=0;b>e;e++)a(d);return f}var s,t,u,v,w,x,y,z,A,B,C,D=p.items,E=p.itemLoader,F=m.KEY;if(D&&E)throw new Error('The "items" and "item-loader" option cannot be used together.');if(D){if(!(t=D.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)\s*$/)))throw new Error('Expected expression in form of "_item_ in _array_" but got "'+D+'".');F=t[1],u=t[2]}return v=g.find("> :first-child"),w=v.find("> :first-child"),x=p.direction||m.DIRECTION,y=p.duration||m.DURATION,z=p.ease||m.EASE,function(g,k,p,t,D){function G(){Ba=s.getItemViewCountPerPage(),Ca=s.getMaxItemViewCount(),Pa=s.getScrollStartCount()}function H(a){Da=a,Ea=a.length}function I(){return{width:v.width(),height:v.height()}}function J(){var a,b;return D(function(b,c){a={element:b,scope:c},ia(a),w.append(a.element)}),b=w.find("> :first-child"),g.$applyAsync(function(){a.scope.$destroy(),a.element.remove()}),{width:b.outerWidth(!0),height:b.outerHeight(!0)}}function K(a){if(Ta>=Ea)throw new Error('Item Count is too small. It\'s should be greater than or equals to "initial-item-index value (default:0)".');A=k.offset(),Ia=s.getMaxPageIndex(Ea),Qa=s.getInitialScrollCount(Ta),Aa=r(D,Ca,function(a,b){var c,d,e,f;b&&(c=b.type,d=jQuery(a.currentTarget).data(),e=d.listItemIndex,Ta!==e&&("mouseover"!==c&&"keydown"!==c||(f=s.getPageIndex(e),ra(e),ma(Ha,f),U(e,d.listItemRowIndex,d.listItemColumnIndex,f),"keydown"===c&&T(e))),fa(e))}),U(Ta),N(s.getStartItemIndex(Ha),s.getNextStartItemIndex(Ha),a),T(Ta),g.initialized=!0}function L(){return(Ca+(Ra-1))%Ca}function M(){return(Ra+1)%Ca}function N(a,b,c){for(var d;b>a&&(d=Aa[Ra],Q(d,F,Sa.get(a),a++,Sa.getTotalCount()),Ra=M(),!1!==(c||angular.noop)(d)););}function O(a,b,c){for(var d;a>b;)if(Ra=L(),d=Aa[Ra],!1===(c||angular.noop)(d,a--)){Ra=M();break}}function P(a,b,c){O(a,b,function(a,b){return Q(a,F,Sa.get(b),b,Sa.getTotalCount()),(c||angular.noop)(a)})}function Q(a,b,c,d,e){c=d>-1&&e>d?c:null,R(a.scope,b,c,d,e),S(a.element,d,s.getPosition(d),c),c&&ia(a)}function R(a,b,c,d,e){a[b]=c||{},a.$index=d,a.$first=0===d,a.$last=d===e-1,a.$odd=!(a.$even=0==(1&d))}function S(a,b,c,d){a.css({position:"absolute",transform:"translate3d("+c.left+"px, "+c.top+"px, 0px)"}).data({listItem:!0,listItemIndex:b,listItemRowIndex:c.rowIndex,listItemColumnIndex:c.columnIndex,isVisibleListItem:function(a,b){return s.isVisibleItem(a,b,Oa)}}),d?a.removeClass("ng-hide"):a.addClass("ng-hide")}function T(a,b){var c;b?Oa=s.getScrollIndex(a,0):0===Qa?Oa=s.getScrollIndex(a,Qa):Qa===Pa&&(Oa=s.getScrollIndex(a,Qa-1)),za||(za=s.getTranslate(a,Oa),w.css("transform",za)),((c=s.getTranslate(a,Oa))!==za||b)&&(b&&ta("touched"),w.css("transform",c),za=c,La||(La=!0,ha("on-scroll-start")))}function U(a,b,c,d){Ta=a,Fa=b||s.getRowIndex(a),Ga=c||s.getColumnIndex(a),Ha=d||s.getPageIndex(a)}function V(a){var b,c=-1;Ia=s.getMaxPageIndex(Ea),H(a),Ha>=Ia-1&&(b=s.getNextStartItemIndex(Ha),O(b-1,-1,function(a,b){return a.element.hasClass("ng-hide")?void 0:(c=b,!1)}),N(c+1,b))}function W(a){var b,c,d,e=!1;H(a),b=Ea-1,Ia=s.getMaxPageIndex(Ea),Ha>Ia?(N(s.getStartItemIndex(Ia),s.getNextStartItemIndex(Ia),function(a){var b;c||(b=a.element,b.data().listItemIndex+1===Ea&&(c=b))}),ra(b),U(b),T(b),Z(i.getCurrentFocusItem())&&i.focus(c)):Ha>=Ia-1&&(d=s.getNextStartItemIndex(Ha),O(d-1,-1,function(a,d){var f=a.element;return f.hasClass("focused")&&(e=!0,d!==b&&i.blur(f)),d===b?(c=f,!1):void 0}),N(b+1,d),Ta>b?(ra(b),U(b),T(b),e&&i.focus(c),fa(b)):s.isReachedEnd(Ta,Ea)&&ha("on-reach-end"))}function X(){var a=Z(i.getCurrentFocusItem());a&&i.blur(),oa(),K(function(b){var c=b.element;a&&Ta===c.data().listItemIndex&&d(function(){i.focus(c)})})}function Y(){var a=Z(i.getCurrentFocusItem());a&&i.blur(),oa(),Ta=va;var b;a?K(function(a){var c=a.element;0!==c.data().listItemIndex&&!0!==c.data().focusableInitialFocus||(b=c)}):K(),b&&d(function(){i.focus(b)})}function Z(a){return!!a&&(a=jQuery(a),a.data().listItem&&w[0]===a.parent()[0])}function $(){return Ma}function _(){Ma=!0,da()}function aa(){xa=d(function(){Ma=!1},Na)}function ba(){return ya}function ca(a){ba()||(ya=e(function(){var b=Ta;$()||Sa.isLoading()||(sa(),ea(s.getNextPosition(Ta,a),!0),b!==Ta&&ga(Ta))},Na))}function da(){ba()&&(e.cancel(ya),ya=null)}function ea(a,b){var c=la(a);if(c){if(c.index===Ta)return!1;if(U(c.index,c.rowIndex,c.columnIndex,c.pageIndex),T(c.index),Sa.isNeededForPrevious(Ta)?(Sa.setOffset(Sa.getOffset()-3*Sa.getLoadingCount()),Sa.request(function(a,b){Sa.setOffset(Sa.getOffset()+2*Sa.getLoadingCount()),Sa.prepend(a)})):Sa.isNeededForNext(Ta)&&Sa.request(function(a,b){Sa.append(a),Sa.setOffset(Sa.getOffset()+Sa.getLoadingCount())}),(b||c.force)&&c.element)return i.focus(c.element),!1}else{if(La)return!1;Ja&&!b&&(oa(),Ta=s.getRotateItemIndex(Fa,Ga,Ea),K(function(a){var b=a.element;Ta===b.data().listItemIndex&&d(function(){i.focus(b)})}))}}function fa(a){ha("on-focus-item-view"),ga(a)}function ga(a){s.isReachedStart(a)?ha("on-reach-start"):s.isReachedEnd(a,Ea)&&ha("on-reach-end")}function ha(b){g.$applyAsync(function(c){(a(p[p.$normalize(b)])||angular.noop)(c,{$context:{itemIndex:Ta,rowIndex:Fa,columnIndex:Ga,pageIndex:Ha,maxPageIndex:Ia,itemCount:Ea,itemViewCountPerPage:Ba}})})}function ia(b){(a(p[p.$normalize("on-decorate-item-view")])||angular.noop)(g,{$itemView:b})}function ja(a){return 0>a||s.getMaxRowIndex(Ea)<a}function ka(a){return 0>a||s.getMaxColumnIndex(Ea)<a}function la(a){var b,c,d,e,f,g,h,i,j=Ea-1;return b=a.rowIndex,c=a.columnIndex,ja(b)||ka(c)?i:(Aa.forEach(function(a){d=a.element,h=d.data(),h.listItemIndex===j&&(g=d),b===h.listItemRowIndex&&c===h.listItemColumnIndex&&(d.hasClass("ng-hide")?(e=j,i={rowIndex:s.getRowIndex(e),columnIndex:s.getColumnIndex(e),force:!0}):(e=h.listItemIndex,i={rowIndex:b,columnIndex:c,element:d}),f=s.getPageIndex(e),ma(Ha,f),i.index=e,i.pageIndex=f)}),i&&i.force&&(i.element=g),i)}function ma(a,b){var c;b>a?(c=(b+Ka)*Ba,N(c,c+Ba)):a>b&&(c=(b-Ka+1)*Ba-1,P(c,c-Ba))}function na(){var a=I(),b=J();B.width===a.width&&B.height===a.height&&C.width===b.width&&C.height===b.height||g.$applyAsync(function(){_(),B=a,C=b,s=q(wa,Ka)[x],G(),X(),aa()})}function oa(){Aa.forEach(function(a){a.scope.$destroy(),a.element.remove()}),Aa=null}function pa(a){b.trigger({type:"keydown",keyCode:a})}function qa(a){s.isPreviousDirection(a)&&Qa>0?Qa--:s.isNextDirection(a)&&Pa>Qa&&Qa++}function ra(a){Qa=Math.max(0,Math.min(Pa,Qa+s.getScrollCountVariation(Ta,a)))}function sa(){1===Qa?Qa=0:Qa===Pa-1&&(Qa=Pa)}function ta(a){switch(a){case"touched":w.css("transition","transform 1s ease-out");break;default:w.css("transition",[f.getVendorStyle("transform"),y,z].join(" "))}}function ua(a){var b,c=a.event.keyCode;if($()||Sa.isLoading())return!1;if(Z(a.currentFocusItem)&&s.isScrollDirection(c))return _(),qa(c),b=ea(s.getNextPosition(Ta,c)),aa(),b;if(La){if(h.isVisible(w))return!1;La=!1}}var va=g.$eval(p.initialItemIndex)||0,wa=g.$eval(p.mouseScrollAreaSize);angular.isNumber(wa)||(wa=m.MOUSE_SCROLL_AREA_SIZE);var xa,ya,za,Aa,Ba,Ca,Da,Ea,Fa,Ga,Ha,Ia,Ja=g.$eval(p.loop)||m.LOOP,Ka=g.$eval(p.pageBufferSize)||m.PAGE_BUFFER_SIZE,La=!1,Ma=!1,Na=g.$eval(p.delay)||m.DELAY,Oa=0,Pa=0,Qa=0,Ra=0,Sa={getTotalCount:function(){return Ea},get:function(a){return Da[a]},isNeededForPrevious:angular.noop,isNeededForNext:angular.noop,isLoading:angular.noop,request:angular.noop,prepend:angular.noop,append:angular.noop},Ta=va;if(E&&Ja)throw new Error('Cannot use continuous circular loop mode when using "item-loader".');if(i.addBeforeKeydownHandler(ua),n.forEach(function(a){g[a.name]=p[a.name]||a.defaultValue}),u&&g.$watchCollection(u,function(a){var b=a.length;_(),g.initialized?b>Ea?V(a):Ea>b?W(a):H(a):b>0&&(H(a),B=I(),C=J(),s=q(wa,Ka)[x],G(),K()),aa()}),k.on("moveleft"+l,function(a){pa(o.LEFT),a.stopPropagation()}).on("moveright"+l,function(a){pa(o.RIGHT),a.stopPropagation()}).on("moveup"+l,function(a){pa(o.UP),a.stopPropagation()}).on("movedown"+l,function(a){pa(o.DOWN),a.stopPropagation()}).on("reload"+l,function(a){g.$applyAsync(function(){_(),X(),aa()}),a.stopPropagation()}).on("reset"+l,function(a){g.$applyAsync(function(){_(),Y(),aa()}),a.stopPropagation()}).on("resize"+l,na),v.on("mousemove"+l,function(a){var b=s.getMouseScrollKeyCode(a.clientX,a.clientY);0!==b?ca(b):da()}).on("mouseout"+l,function(a){Z(a.relatedTarget)||(da(),i.blur())}),w.on("transitionend webkitTransitionEnd oTransitionEnd otransitionend",function(){La=!1,ha("on-scroll-finish")}),void 0!==window.Hammer){var Ua,Va=new Hammer.Manager(w[0],{recognizers:[[Hammer.Pan,{direction:Hammer.DIRECTION_ALL}]]});Va.on("panmove",function(a){var b="horizontal"===x?a.deltaX:a.deltaY,c=s.getTranslate(Oa,Oa,b);w.css("transform",c);var d=s.getNextScrollIndex(Oa,b,Ea);Ta!==d&&g.$applyAsync(function(){var a=s.getPageIndex(d);ma(Ha,a),ra(d),U(d)})}),Va.on("panstart",function(a){Ua=w.css("transition"),w.css("transition","transform 0s ease")}),Va.on("panend",function(a){var b="horizontal"===x?a.deltaX:a.deltaY;T(s.getNextScrollIndex(Oa,b,Ea),!0),Ua&&w.css("transition",Ua)})}jQuery(c).on("resize"+l,na),d(function(){if(ta(),E){if(!(Sa=j.get(E)))throw new Error("No such item loader: "+E);B=I(),C=J(),s=q(wa,Ka)[x],G(),Sa.setLoadingCount(Ca+Ba),Sa.setThresholdCount(Ba*Ka+Ba),Sa.initialize(function(a,b,c,d){_(),Ea=b,K(),aa()})}}),g.$on("$destroy",function(){La=!1,Ma=!1,oa(),v.off(l),k.off(l),jQuery(c).off(l),i.removeBeforeKeydownHandler(ua)})}}}}];ListItemLoaderProvider.$inject=["focusControllerProvider"];var caphRadioButtonDirective=["radiobuttonManager","$parse","focusController","FocusUtil",function(a,b,c,d){return{restrict:"E",transclude:!0,template:'<div ng-class="radiobuttonClass" focusable ng-transclude on-focused="focus($event, $originalEvent)" on-selected="select($event, $originalEvent)" on-blurred="blur($event, $originalEvent)"></div>',scope:!0,link:function(c,e,f){c.radiobuttonClass=f.radiobuttonclass||"caph-radiobutton";var g=c.$eval(f.focusOption),h=f.group||"default",i=e.find("> div");a.addRadio(i,h),void 0!==f.selected&&a.selectRadio(i,h),g&&d.setData(i,g),f.$observe("radiobuttonClass",function(a){c.radiobuttonClass=a}),c.focus=function(a,d){(b(f.onFocused)||angular.noop)(c.$parent,{$event:a,$originalEvent:d})},c.blur=function(a,d){(b(f.onBlurred)||angular.noop)(c.$parent,{$event:a,$originalEvent:d})},c.select=function(d,e){a.selectRadio(i,h),(b(f.onSelected)||angular.noop)(c.$parent,{$event:d,$originalEvent:e})}}}}],radiobuttonManagerProvider=function(){var a={},b={addRadio:function(b,c){a[c]=a[c]||[],a[c].push(b)},selectRadio:function(b,c){for(var d in a[c])void 0!==a[c][d].parent().attr("selected")&&(a[c][d].removeClass("selected"),a[c][d].parent().removeAttr("selected"));void 0===b.parent().attr("selected")&&b.parent().attr("selected",""),b.addClass("selected")}};return{$get:function(){return{addRadio:b.addRadio,selectRadio:b.selectRadio}}}};angular.module("caph.ui",["caph.focus"],["$provide","$compileProvider","nearestFocusableFinderProvider",function(a,b,c){function d(a){var b,c,d=a.charAt(0).toUpperCase()+a.substr(1);return null===g?(b=f.style,a in b?(g="",a):(e.some(function(a){return c=a+d,c in b?(g=a,!0):void 0}),f=null,c)):g?g+d:a}var e=["Webkit","Moz","O","ms"],f=document.createElement("div"),g=null,h={DEFAULT:{focusableDepth:9999}},i={translateTo:function(a,b,c){a&&a.css("transform","translate3d("+b+"px,"+c+"px, 0)")},moveToCenter:function(a){if(a){var b=window.innerWidth/2-a[0].clientWidth/2,c=window.innerHeight/2-a[0].clientHeight/2;0>c&&(c=0),0>b&&(b=0),b-=1*a[0].offsetLeft,this.translateTo(a,b,c)}}},j={getVendorProperty:d,getVendorStyle:function(a){var b=d(a);return b!==a?"-"+b.replace(/[A-Z]/g,function(a,b){var c=a.toLowerCase();return 0===b?c:"-"+c}):b}};["transform","transition"].forEach(function(a){var b=d(a);b!==a&&(jQuery.cssHooks[a]={get:function(a){return jQuery.css(a,b)},set:function(a,c){a.style[b]=c}})}),a.constant("DialogConstant",h),a.constant("DialogUtil",i),a.constant("VendorUtil",j),a.provider({dialogManager:dialogManagerProvider,radiobuttonManager:radiobuttonManagerProvider,listItemLoader:ListItemLoaderProvider}),b.directive({caphDialogTitle:caphDialogTitleDirective,caphDialogContent:caphDialogContentDirective,caphDialogButtons:caphDialogButtonsDirective,caphDialog:caphDialogDirective,caphList:caphListDirective,caphButton:caphButtonDirective,caphTransclude:caphTranscludeDirective,caphContextMenuItemTemplate:caphContextMenuItemTemplateDirective,caphContextMenuArrowUpTemplate:caphContextMenuArrowUpTemplateDirective,caphContextMenuArrowDownTemplate:caphContextMenuArrowDownTemplateDirective,caphContextMenu:caphContextMenuDirective,caphCheckbox:caphCheckboxDirective,caphRadiobutton:caphRadioButtonDirective,caphDropdownListItemTemplate:caphDropdownListItemTemplateDirective,caphDropdownListPlaceholderTemplate:caphDropdownListPlaceholderTemplateDirective,caphDropdownListArrowUpTemplate:caphDropdownArrowUpTemplateDirective,caphDropdownListArrowDownTemplate:caphDropdownArrowDownTemplateDirective,caphDropdownList:caphDropdownListDirective,caphInput:caphInputDirective}),c.addBeforeDistanceCalculationHandler(function(a){var b=jQuery(a).data()||{};return!(!0===b.listItem&&!b.isVisibleListItem(b.listItemRowIndex,b.listItemColumnIndex))&&void 0})}]),function($){$.fn.smartTvKeyboard=function(opts){var smartTvKeyboards=this,noKeyBoard=smartTvKeyboards.length;return this.each(function(index){function init(){$.extend(options,opts),lang=options.defLang||getLangKeys()[0],mode=options.defMode||getModeKeys()[0],cursorPosition=that.val().length,parentElement="inline"===options.type?that.parent():$("body"),bind()}function bind(){that.on(options.openOn,showKeyboard)}function showKeyboard(){if(!keyboardElement){var title=that.attr("title");inputElement=that.clone().addClass("smart-tv-keyboard-input"),that.parent().addClass("focused"),inputElement.offset({top:that.offset().top+25,left:that.offset().left}),keyboardElement=$(keyboardTemplate),keyboardElement.find(".smart-tv-keyboard-input-section").append(inputElement),inputElement.val(that.val()),setCursorPosition(cursorPosition),setMainCursorPosition(cursorPosition),options.title?keyboardElement.find(".smart-tv-keyboard-title").text(options.title):keyboardElement.find(".smart-tv-keyboard-title").text(title),"inline"===options.type?that.after(keyboardElement):(backdropElement=$(backdropTemplate),parentElement.append(keyboardElement),parentElement.append(backdropElement),keyboardElement.toggleClass("smart-tv-keyboard-modal",!0)),renderGrid(),keepFocus(),bindInputKeydown()}}function processKeydown(evt){evt=evt||window.event,options.useNavKeys&&processKeyCode(evt.keyCode),!options.useDirectEdit&&evt.preventDefault()}function bindInputKeydown(){document.addEventListener("keydown",processKeydown)}function keepFocus(){inputElement.focus(),inputElement.on("blur",function(){this.focus()})}function renderGrid(){var x,language=options.layouts[lang],gridElement=keyboardElement.find(".smart-tv-keyboard-grid").empty(),y=0;for(var rowIndex in language[mode]){x=0;var rowValue=language[mode][rowIndex],rowElement=$(rowTemplate);for(var colIndex in rowValue){var value=rowValue[colIndex],button=$(buttonTemplate);button.attr("data-size",value.length),button.addClass("smart-tv-keyboard-button-length-"+value.length),button.addClass("smart-tv-keyboard-button-color-"+value.color),0===kbIndex&&"&&previous"===value.value?(value.value="&&close",value.text="Đóng"):"&&previous"===value.value?(value.value="&&previous",value.text="Quay lại",button.attr("id","backToUsername")):kbIndex===noKeyBoard-1&&"&&next"===value.value?(value.value="&&login",value.text="Đăng nhập"):kbIndex===noKeyBoard-1&&"&&login"===value.value?(value.value="&&next",value.text="Tiếp theo",button.attr("id","nextToPass")):kbIndex!==noKeyBoard-1||"&&previous"!==value.value&&"&&close"!==value.value?kbIndex<=noKeyBoard-2&&"&&login"===value.value?(value.value="&&next",value.text="Tiếp theo",button.attr("id","nextToPass")):kbIndex<=noKeyBoard-1&&"&&next"===value.value&&(value.value="&&next",value.text="Tiếp theo",button.attr("id","nextToPass")):(value.value="&&previous",value.text="Quay lại",button.attr("id","backToUsername")),button.text(value.text),bindBtnClick(button,value.value),rowElement.append(button);for(var i=0;i<value.length;i++)button.addClass(x+"-"+y),x++}y++,gridElement.append(rowElement)}x=0,y=0,selectBtn()}function bindBtnClick(btn,value){value&&btn&&btn.on("click",function(){processKeyValue(value),selectBtn(btn)})}function selectBtn(btn){if(selectedButtonElement&&selectedButtonElement.toggleClass("smart-tv-keyboard-button-selected",!1),btn){var coord=/\d+\-\d+/.exec(btn.attr("class"));if(coord&&coord[0]){var xy=coord[0].split("-");x=parseInt(xy[0],10),y=parseInt(xy[1],10),selectedButtonElement=btn}}else selectedButtonElement=keyboardElement.find("."+x+"-"+y);selectedButtonElement.toggleClass("smart-tv-keyboard-button-selected",!0)}function processKeyValue(value){var currentValue;switch(value){case"&&cursorMoveLeft":cursorMove(-1);break;case"&&cursorMoveRight":cursorMove(1);break;case"&&clear":inputElement.val(""),that.val(""),that.trigger("input"),that.trigger("change"),cursorPosition=0;break;case"&&back":cursorMove(-1),currentValue=inputElement.val(),currentValue=currentValue.slice(0,cursorPosition)+currentValue.slice(cursorPosition+1),inputElement.val(currentValue),that.val(currentValue),that.trigger("input"),that.trigger("change"),setCursorPosition(cursorPosition);break;case"&&switchMode":toggleMode(),renderGrid();break;case"&&switchLanguage":toggleLanguage(),renderGrid();break;case"&&enter":that.val(inputElement.val()),that.trigger("input"),that.trigger("change"),options.onEnter&&options.onEnter(inputElement.val()),that.show();break;case"&&next":options.onEnter&&options.onEnter(inputElement.val()),that.parent().removeClass("focused"),$(smartTvKeyboards[kbIndex]).parent().attr("focused",!1),$(smartTvKeyboards[kbIndex+1]).parent().attr("focused",!0),that.parent().find(".smart-tv-keyboard")[0].remove(),destroy(),smartTvKeyboards[kbIndex+1].click();break;case"&&previous":options.onEnter&&options.onEnter(inputElement.val()),that.parent().removeClass("focused"),$(smartTvKeyboards[kbIndex]).parent().attr("focused",!1),$(smartTvKeyboards[kbIndex-1]).parent().attr("focused",!0),that.parent().find(".smart-tv-keyboard")[0].remove(),destroy(),smartTvKeyboards[kbIndex-1].click();break;case"&&login":that.val(inputElement.val()),that.trigger("input"),that.trigger("change"),options.onEnter&&options.onEnter(inputElement.val()),removeKeyboardListenerFunc=removeEventListener,$(".btn-login").click();break;case"&&close":destroy(),$(".btn-login-cancel").click();break;case"&&cancel":options.onCancel&&options.onCancel(inputElement.val()),that.show();break;default:cursorPosition++,currentValue=inputElement.val(),currentValue=currentValue.slice(0,cursorPosition)+value+currentValue.slice(cursorPosition),inputElement.val(currentValue),that.val(currentValue),that.trigger("input"),that.trigger("change"),setCursorPosition(cursorPosition)}}function processKeyCode(code){var KEYS=options.navKeys;switch(code){case KEYS.UP:move("UP");break;case KEYS.DOWN:move("DOWN");break;case KEYS.LEFT:move("LEFT");break;case KEYS.RIGHT:move("RIGHT");break;case KEYS.RETURN:options.onCancel&&options.onCancel(inputElement.val()),destroy(),smartTvKeyboards.removeClass("focused");break;case KEYS.EXIT:options.onCancel&&options.onCancel(inputElement.val()),destroy(),$(".btn-login-cancel").click();break;case KEYS.ENTER:keyboardElement.find("."+x+"-"+y).click()}}function move(direction){var matrix=options.layouts[lang][mode],maxY=matrix.length-1,maxX=-1;for(var index in matrix[y])maxX+=matrix[y][index].length;switch(direction){case"LEFT":x=--x<0?maxX:x;break;case"RIGHT":x=++x>maxX?0:x;break;case"UP":y=--y<0?maxY:y;break;case"DOWN":y=++y>maxY?0:y}if(keyboardElement.find("."+x+"-"+y).hasClass("smart-tv-keyboard-button-color-disabled")||selectedButtonElement&&selectedButtonElement.hasClass(x+"-"+y))return move(direction);selectBtn()}function cursorMove(step){var value=inputElement.val();cursorPosition+=step,cursorPosition<0?cursorPosition=0:cursorPosition>value.length&&(cursorPosition=value.length),setCursorPosition(cursorPosition)}function setCursorPosition(pos){var el=inputElement[0];if(el.setSelectionRange)el.setSelectionRange(pos,pos);else if(el.createTextRange){var range=el.createTextRange();range.collapse(!0),range.moveEnd("character",pos),range.moveStart("character",pos),range.select()}}function setMainCursorPosition(pos){var el=that;if(el.setSelectionRange)el.setSelectionRange(pos,pos);else if(el.createTextRange){var range=el.createTextRange();range.collapse(!0),range.moveEnd("character",pos),range.moveStart("character",pos),range.select()}}function getLangKeys(){return Object.keys(options.layouts)}function getModeKeys(){return Object.keys(options.layouts[lang])}function toggleMode(){for(var modes=getModeKeys(),newMode=modes[0],i=0;i<modes.length;i++)mode===modes[i]&&modes[i+1]&&(newMode=modes[i+1]);return mode=newMode,newMode}function toggleLanguage(){for(var layouts=getLangKeys(),newLang=layouts[0],i=0;i<layouts.length;i++)lang===layouts[i]&&layouts[i+1]&&(newLang=layouts[i+1]);return lang=newLang,newLang}function destroy(){backdropElement&&backdropElement.remove(),keyboardElement&&keyboardElement.remove(),keyboardElement=null,removeEventListener()}function removeEventListener(){document.removeEventListener?document.removeEventListener("keydown",processKeydown):document.detachEvent&&document.detachEvent("keydown",processKeydown)}var lang,mode,keyboardElement,parentElement,inputElement,selectedButtonElement,backdropElement,kbIndex=index,that=$(this),cursorPosition=0,x=0,y=0,keyboardTemplate='<div class="smart-tv-keyboard"><div class="smart-tv-keyboard-title"></div><div class="smart-tv-keyboard-input-section"></div><div class="smart-tv-keyboard-grid"></div></div>',rowTemplate='<div class="smart-tv-keyboard-row"></div>',buttonTemplate='<div class="smart-tv-keyboard-button"></div>',backdropTemplate='<div class="smart-tv-keyboard-backdrop"></div>',options={title:null,defLang:null,defMode:null,layouts:{},type:"inline",openOn:"click focus",onEnter:null,onCancel:null,useDirectEdit:!0,useNavKeys:!0,navKeys:{LEFT:37,UP:38,RIGHT:39,DOWN:40,ENTER:13,EXIT:8,RETURN:10009}};init()})}}(window.jQuery||window.Zepto),function(window,document){angular.module("toaster",[]).constant("toasterConfig",{limit:0,"tap-to-dismiss":!0,"close-button":!1,"close-html":'<button class="toast-close-button" type="button">&times;</button>',"newest-on-top":!0,"time-out":5e3,"icon-classes":{error:"toast-error",info:"toast-info",wait:"toast-wait",success:"toast-success",warning:"toast-warning"},"body-output-type":"","body-template":"toasterBodyTmpl.html","icon-class":"toast-info","position-class":"toast-top-center","title-class":"toast-title","message-class":"toast-message","prevent-duplicates":!1,"mouseover-timer-stop":!0}).run(["$templateCache",function($templateCache){$templateCache.put("angularjs-toaster/toast.html",'<div id="toast-container" ng-class="[config.position, config.animation]"><div ng-repeat="toaster in toasters" class="toast" ng-class="toaster.type" ng-click="click($event, toaster)" ng-mouseover="stopTimer(toaster)" ng-mouseout="restartTimer(toaster)"><div ng-if="toaster.showCloseButton" ng-click="click($event, toaster, true)" ng-bind-html="toaster.closeHtml"></div><div ng-class="config.title">{{toaster.title}}</div><div ng-class="config.message" ng-switch on="toaster.bodyOutputType"><div ng-switch-when="trustedHtml" ng-bind-html="toaster.html"></div><div ng-switch-when="template"><div ng-include="toaster.bodyTemplate"></div></div><div ng-switch-when="templateWithData"><div ng-include="toaster.bodyTemplate"></div></div><div ng-switch-when="directive"><div directive-template directive-name="{{toaster.html}}" directive-data="{{toaster.directiveData}}"></div></div><div ng-switch-default >{{toaster.body}}</div></div></div></div>')}]).service("toaster",["$rootScope","toasterConfig",function($rootScope,toasterConfig){function createTypeMethod(toasterType){return function(title,body,timeout,bodyOutputType,clickHandler,toasterId,showCloseButton,toastId,onHideCallback){return angular.isString(title)?this.pop(toasterType,title,body,timeout,bodyOutputType,clickHandler,toasterId,showCloseButton,toastId,onHideCallback):this.pop(angular.extend(title,{type:toasterType}))}}var Guid=function(){var Guid={};return Guid.newGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0;return("x"==c?r:3&r|8).toString(16)})},Guid}();this.pop=function(type,title,body,timeout,bodyOutputType,clickHandler,toasterId,showCloseButton,toastId,onHideCallback){if(angular.isObject(type)){var params=type;this.toast={type:params.type,title:params.title,body:params.body,timeout:params.timeout,bodyOutputType:params.bodyOutputType,clickHandler:params.clickHandler,showCloseButton:params.showCloseButton,closeHtml:params.closeHtml,toastId:params.toastId,onShowCallback:params.onShowCallback,onHideCallback:params.onHideCallback,directiveData:params.directiveData,tapToDismiss:params.tapToDismiss},toasterId=params.toasterId}else this.toast={type:type,title:title,body:body,timeout:timeout,bodyOutputType:bodyOutputType,clickHandler:clickHandler,showCloseButton:showCloseButton,toastId:toastId,onHideCallback:onHideCallback};return this.toast.toastId&&this.toast.toastId.length||(this.toast.toastId=Guid.newGuid()),$rootScope.$emit("toaster-newToast",toasterId,this.toast.toastId),{toasterId:toasterId,toastId:this.toast.toastId}},this.clear=function(toasterId,toastId){angular.isObject(toasterId)?$rootScope.$emit("toaster-clearToasts",toasterId.toasterId,toasterId.toastId):$rootScope.$emit("toaster-clearToasts",toasterId,toastId)};for(var type in toasterConfig["icon-classes"])this[type]=createTypeMethod(type)}]).factory("toasterEventRegistry",["$rootScope",function($rootScope){var toasterFactory,deregisterNewToast=null,deregisterClearToasts=null,newToastEventSubscribers=[],clearToastsEventSubscribers=[];return toasterFactory={setup:function(){deregisterNewToast||(deregisterNewToast=$rootScope.$on("toaster-newToast",function(event,toasterId,toastId){for(var i=0,len=newToastEventSubscribers.length;i<len;i++)newToastEventSubscribers[i](event,toasterId,toastId)})),deregisterClearToasts||(deregisterClearToasts=$rootScope.$on("toaster-clearToasts",function(event,toasterId,toastId){for(var i=0,len=clearToastsEventSubscribers.length;i<len;i++)clearToastsEventSubscribers[i](event,toasterId,toastId)}))},subscribeToNewToastEvent:function(onNewToast){newToastEventSubscribers.push(onNewToast)},subscribeToClearToastsEvent:function(onClearToasts){clearToastsEventSubscribers.push(onClearToasts)},unsubscribeToNewToastEvent:function(onNewToast){var index=newToastEventSubscribers.indexOf(onNewToast);index>=0&&newToastEventSubscribers.splice(index,1),0===newToastEventSubscribers.length&&(deregisterNewToast(),deregisterNewToast=null)},unsubscribeToClearToastsEvent:function(onClearToasts){var index=clearToastsEventSubscribers.indexOf(onClearToasts);index>=0&&clearToastsEventSubscribers.splice(index,1),0===clearToastsEventSubscribers.length&&(deregisterClearToasts(),deregisterClearToasts=null)}},{setup:toasterFactory.setup,subscribeToNewToastEvent:toasterFactory.subscribeToNewToastEvent,subscribeToClearToastsEvent:toasterFactory.subscribeToClearToastsEvent,unsubscribeToNewToastEvent:toasterFactory.unsubscribeToNewToastEvent,unsubscribeToClearToastsEvent:toasterFactory.unsubscribeToClearToastsEvent}
}]).directive("directiveTemplate",["$compile","$injector",function($compile,$injector){return{restrict:"A",scope:{directiveName:"@directiveName",directiveData:"@directiveData"},replace:!0,link:function(scope,elm,attrs){scope.$watch("directiveName",function(directiveName){if(angular.isUndefined(directiveName)||directiveName.length<=0)throw new Error("A valid directive name must be provided via the toast body argument when using bodyOutputType: directive");var directive;try{directive=$injector.get(attrs.$normalize(directiveName)+"Directive")}catch(e){throw new Error(directiveName+" could not be found. The name should appear as it exists in the markup, not camelCased as it would appear in the directive declaration, e.g. directive-name not directiveName.")}var directiveDetails=directive[0];if(!0!==directiveDetails.scope&&directiveDetails.scope)throw new Error("Cannot use a directive with an isolated scope. The scope must be either true or falsy (e.g. false/null/undefined). Occurred for directive "+directiveName+".");if(directiveDetails.restrict.indexOf("A")<0)throw new Error('Directives must be usable as attributes. Add "A" to the restrict option (or remove the option entirely). Occurred for directive '+directiveName+".");scope.directiveData&&(scope.directiveData=angular.fromJson(scope.directiveData));var template=$compile("<div "+directiveName+"></div>")(scope);elm.append(template)})}}}]).directive("toasterContainer",["$parse","$rootScope","$interval","$sce","toasterConfig","toaster","toasterEventRegistry",function($parse,$rootScope,$interval,$sce,toasterConfig,toaster,toasterEventRegistry){return{replace:!0,restrict:"EA",scope:!0,link:function(scope,elm,attrs){function setTimeout(toast,time){toast.timeoutPromise=$interval(function(){scope.removeToast(toast.toastId)},time,1)}function addToast(toast,toastId){if(toast.type=mergedConfig["icon-classes"][toast.type],toast.type||(toast.type=mergedConfig["icon-class"]),!0===mergedConfig["prevent-duplicates"]&&scope.toasters.length){if(scope.toasters[scope.toasters.length-1].body===toast.body)return;var i,len,dupFound=!1;for(i=0,len=scope.toasters.length;i<len;i++)if(scope.toasters[i].toastId===toastId){dupFound=!0;break}if(dupFound)return}var closeButton=mergedConfig["close-button"];if("boolean"==typeof toast.showCloseButton);else if("boolean"==typeof closeButton)toast.showCloseButton=closeButton;else if("object"==typeof closeButton){var closeButtonForType=closeButton[toast.type];void 0!==closeButtonForType&&null!==closeButtonForType&&(toast.showCloseButton=closeButtonForType)}else toast.showCloseButton=!1;switch(toast.showCloseButton&&(toast.closeHtml=$sce.trustAsHtml(toast.closeHtml||scope.config.closeHtml)),toast.bodyOutputType=toast.bodyOutputType||mergedConfig["body-output-type"],toast.bodyOutputType){case"trustedHtml":toast.html=$sce.trustAsHtml(toast.body);break;case"template":toast.bodyTemplate=toast.body||mergedConfig["body-template"];break;case"templateWithData":var fcGet=$parse(toast.body||mergedConfig["body-template"]),templateWithData=fcGet(scope);toast.bodyTemplate=templateWithData.template,toast.data=templateWithData.data;break;case"directive":toast.html=toast.body}scope.configureTimer(toast),!0===mergedConfig["newest-on-top"]?(scope.toasters.unshift(toast),mergedConfig.limit>0&&scope.toasters.length>mergedConfig.limit&&scope.toasters.pop()):(scope.toasters.push(toast),mergedConfig.limit>0&&scope.toasters.length>mergedConfig.limit&&scope.toasters.shift()),angular.isFunction(toast.onShowCallback)&&toast.onShowCallback()}function removeToast(toastIndex){var toast=scope.toasters[toastIndex];toast.timeoutPromise&&$interval.cancel(toast.timeoutPromise),scope.toasters.splice(toastIndex,1),angular.isFunction(toast.onHideCallback)&&toast.onHideCallback()}function removeAllToasts(toastId){for(var i=scope.toasters.length-1;i>=0;i--)isUndefinedOrNull(toastId)?removeToast(i):scope.toasters[i].toastId==toastId&&removeToast(i)}function isUndefinedOrNull(val){return angular.isUndefined(val)||null===val}var mergedConfig;mergedConfig=angular.extend({},toasterConfig,scope.$eval(attrs.toasterOptions)),scope.config={toasterId:mergedConfig["toaster-id"],position:mergedConfig["position-class"],title:mergedConfig["title-class"],message:mergedConfig["message-class"],tap:mergedConfig["tap-to-dismiss"],closeButton:mergedConfig["close-button"],closeHtml:mergedConfig["close-html"],animation:mergedConfig["animation-class"],mouseoverTimer:mergedConfig["mouseover-timer-stop"]},scope.$on("$destroy",function(){toasterEventRegistry.unsubscribeToNewToastEvent(scope._onNewToast),toasterEventRegistry.unsubscribeToClearToastsEvent(scope._onClearToasts)}),scope.configureTimer=function(toast){var timeout=angular.isNumber(toast.timeout)?toast.timeout:mergedConfig["time-out"];"object"==typeof timeout&&(timeout=timeout[toast.type]),timeout>0&&setTimeout(toast,timeout)},scope.removeToast=function(toastId){var i,len;for(i=0,len=scope.toasters.length;i<len;i++)if(scope.toasters[i].toastId===toastId){removeToast(i);break}},scope.toasters=[],scope._onNewToast=function(event,toasterId,toastId){(isUndefinedOrNull(scope.config.toasterId)&&isUndefinedOrNull(toasterId)||!isUndefinedOrNull(scope.config.toasterId)&&!isUndefinedOrNull(toasterId)&&scope.config.toasterId==toasterId)&&addToast(toaster.toast,toastId)},scope._onClearToasts=function(event,toasterId,toastId){("*"==toasterId||isUndefinedOrNull(scope.config.toasterId)&&isUndefinedOrNull(toasterId)||!isUndefinedOrNull(scope.config.toasterId)&&!isUndefinedOrNull(toasterId)&&scope.config.toasterId==toasterId)&&removeAllToasts(toastId)},toasterEventRegistry.setup(),toasterEventRegistry.subscribeToNewToastEvent(scope._onNewToast),toasterEventRegistry.subscribeToClearToastsEvent(scope._onClearToasts)},controller:["$scope","$element","$attrs",function($scope,$element,$attrs){$scope.stopTimer=function(toast){!0===$scope.config.mouseoverTimer&&toast.timeoutPromise&&($interval.cancel(toast.timeoutPromise),toast.timeoutPromise=null)},$scope.restartTimer=function(toast){!0===$scope.config.mouseoverTimer?toast.timeoutPromise||$scope.configureTimer(toast):null===toast.timeoutPromise&&$scope.removeToast(toast.toastId)},$scope.click=function(event,toast,isCloseButton){if(event.stopPropagation(),!0===("boolean"==typeof toast.tapToDismiss?toast.tapToDismiss:$scope.config.tap)||!0===toast.showCloseButton&&!0===isCloseButton){var removeToast=!0;toast.clickHandler&&(angular.isFunction(toast.clickHandler)?removeToast=toast.clickHandler(toast,isCloseButton):angular.isFunction($scope.$parent.$eval(toast.clickHandler))&&(removeToast=$scope.$parent.$eval(toast.clickHandler)(toast,isCloseButton))),removeToast&&$scope.removeToast(toast.toastId)}}}],templateUrl:"angularjs-toaster/toast.html"}}])}(window,document);var app=angular.module("vietteltv",["ngSanitize","caph.ui","ui.router","ngResource","caph.media","http-auth-interceptor","toaster","LocalStorageModule"]).config(["focusControllerProvider",function(focusControllerProvider){focusControllerProvider.setInitialDepth(1),focusControllerProvider.setInitialGroupOfDepth(3,"SIDEBAR_CATEGORY")}]);app.value("SETTINGS",{guest_access_token:"00536aefb1f78bca51f8b3fde6f643c5",access_token:"00536aefb1f78bca51f8b3fde6f643c5",refresh_token_expiration_date:"",expiration_date:"",login_access_token:"",token_secret:"",client_id:"viettelSdpClient2",app_secret:"viettelSdpUserprofile1"}),app.run(["SETTINGS","localStorageService","Auth","$rootScope",function(SETTINGS,localStorageService,Auth,$rootScope){Auth.authorize(!0,function(){if(localStorageService.get("token")){var token=localStorageService.get("token");SETTINGS.access_token=token.access_token,SETTINGS.token_secret=token.token_secret,SETTINGS.login_access_token=token.login_access_token,SETTINGS.refresh_token=token.refresh_token,SETTINGS.expiration_date=token.expiration_date,SETTINGS.refresh_token_expiration_date=token.refresh_token_expiration_date,$rootScope.isAppLoadedAfterLogin=!0}else SETTINGS.access_token="00536aefb1f78bca51f8b3fde6f643c5",SETTINGS.token_secret="",$rootScope.isAppLoadedAfterLogin=!1}),localStorageService.get("deviceUdid")||(new Fingerprint2).get(function(result,components){localStorageService.set("deviceUdid",result)})}]),app.config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["$q","$timeout","$injector",function($q,$timeout,$injector){return{response:function(response){return null===response||null===response.data?$timeout(function(){return $injector.get("$http")(response.config)},5e3):response}}}]),$httpProvider.interceptors.push("authInterceptor")}]);var isLoginOK=!1,removeKeyboardListenerFunc;$(document).ready(function(){void 0!==window.tizen&&registerKeys()}),String.prototype.toHHMMSS=function(){var sec_num=parseInt(this,10),hours=Math.floor(sec_num/3600),minutes=Math.floor((sec_num-3600*hours)/60),seconds=sec_num-3600*hours-60*minutes;return hours<10&&(hours="0"+hours),minutes<10&&(minutes="0"+minutes),seconds<10&&(seconds="0"+seconds),"00"===hours?minutes+":"+seconds:hours+":"+minutes+":"+seconds};var linkFn=function($scope,$element,$attr){$scope.title=$attr.title,$scope.id=1*$attr.id,$scope.listCategory=1*$attr.id,$attr.focusOption?$scope.focusable=$scope.$eval($attr.focusOption):$scope.focusable={depth:1,group:$attr.id}};app.directive("playList",function(){return{restrict:"E",templateUrl:"views/templates/playlist.html",scope:!0,link:linkFn}}),app.directive("categoryMenuList",function(){return{restrict:"E",templateUrl:"views/templates/categoryMenuList.html",scope:!0,link:function($scope,$element,$attr){$scope.title=$attr.title,$attr.focusOption?$scope.focusable=$scope.$eval($attr.focusOption):$scope.focusable={depth:1,group:$attr.id}}}}),app.directive("channelList",function(){return{restrict:"E",templateUrl:"views/templates/channelList.html",scope:!0,link:linkFn}}),app.directive("playListSm",function(){return{restrict:"E",templateUrl:"views/templates/playlistSm.html",scope:!0,link:linkFn}}).directive("relatedPlayList",function(){return{restrict:"E",templateUrl:"views/templates/relatedPlaylist.html",scope:!0}}).directive("episodePlayList",function(){return{restrict:"E",templateUrl:"views/templates/episodePlaylist.html",scope:!0}}),angular.module("caph.media",["caph.ui"],["$provide","$compileProvider",function($provide,$compileProvider){$compileProvider.directive({caphMedia:["$parse","$document",function($parse,$document){function invokeMethod(media,index,method,param){angular.isNumber(index)?media[index][method].apply(media[index],param):media.each(function(){this[method].apply(this,param)})}function setProperty(media,index,property,value){angular.isNumber(index)?media[index][property]=value:media.each(function(){this[property]=value})}function forEachProperty(media,index,property,callback){angular.isNumber(index)?callback(media[index][property]):media.each(function(){callback(this[property])})}function forEachTextTracks(media,callback,index){forEachProperty(media,index,"textTracks",function(textTracks){for(var i=0,length=textTracks.length;i<length;i++)callback(textTracks[i])})}var isFullScreen,requestFullScreen,exitFullScreen,CONSTANT={FORWARD_INTERVAL:15,FAST_FORWARD_INTERVAL:120},document=$document[0],documentElement=document.documentElement,isFullScreenEnabled=document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled;return isFullScreenEnabled&&(["fullscreenElement","webkitFullscreenElement","mozFullScreenElement","msFullscreenElement"].some(function(property){if(void 0!==document[property])return isFullScreen=property,!0}),["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"].some(function(method){if(documentElement[method])return requestFullScreen=method,!0}),["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"].some(function(method){if(document[method])return exitFullScreen=method,!0})),{restrict:"E",transclude:!0,scope:!0,controller:function($scope,$element,$attrs,$transclude){function doFullScreen(callback){isFullScreenEnabled&&callback($element[0])}var media,originalStyle={},isPlaying=!1,isChannel=!1;$scope.$watch($attrs.subtitle,function(subtitle){!0===subtitle?this.subTitle(!0):this.subTitle(!1)}.bind(this)),$scope.$watch($attrs.ischannel,function(ischannel){isChannel=ischannel}.bind(this)),$transclude(function(clone){$element.append(clone),media=$element.find("video, audio"),media.on("forward rewind next restart abort error stalled suspend loadstart durationchange loadedmetadata loadeddata progress canplay canplaythrough ended pause play playing ratechange seeked seeking timeupdate volumechange waiting",function(event){switch(event.type){case"play":case"playing":isPlaying=!0;break;case"pause":case"ended":isPlaying=!1}($parse($attrs[$attrs.$normalize("on-"+event.type)])||angular.noop)($scope,{$event:event})}),forEachTextTracks(media,function(textTrack){textTrack.oncuechange=function(event){($parse($attrs[$attrs.$normalize("on-"+event.type)])||angular.noop)($scope,{$event:event})}})}),$scope.$on("$destroy",function(){$element.remove()}),$element.on("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",function(){document[isFullScreen]?(this.style.display="block",this.style.width="100%",this.style.height="100%"):(this.style.display=originalStyle.display,this.style.width=originalStyle.width,this.style.height=originalStyle.height)}),["load","play","pause"].forEach(function(method){this[method]=function(index){invokeMethod(media,index,method)}},this),this.togglePlay=function(index){isChannel&&(isPlaying=!1),invokeMethod(media,index,isPlaying?"pause":"play")},this.restart=function(index){angular.isNumber(index)?setProperty(media,index,"currentTime",media[index].currentTime-CONSTANT.FAST_FORWARD_INTERVAL):media.each(function(i){setProperty(media,i,"currentTime",media[i].currentTime-CONSTANT.FAST_FORWARD_INTERVAL)})},this.rewind=function(index){angular.isNumber(index)?setProperty(media,index,"currentTime",media[index].currentTime-CONSTANT.FORWARD_INTERVAL):media.each(function(i){setProperty(media,i,"currentTime",media[i].currentTime-CONSTANT.FORWARD_INTERVAL)})},this.forward=function(index){angular.isNumber(index)?setProperty(media,index,"currentTime",media[index].currentTime+CONSTANT.FORWARD_INTERVAL):media.each(function(i){setProperty(media,i,"currentTime",media[i].currentTime+CONSTANT.FORWARD_INTERVAL)})},this.next=function(index){angular.isNumber(index)?setProperty(media,index,"currentTime",media[index].currentTime+CONSTANT.FAST_FORWARD_INTERVAL):media.each(function(i){setProperty(media,i,"currentTime",media[i].currentTime+CONSTANT.FAST_FORWARD_INTERVAL)})},["autoplay","controls","currentTime","loop","mediaGroup","muted","playbackRate","preload","src","volume"].forEach(function(property){this[$attrs.$normalize("set-"+property)]=function(value,index){setProperty(media,index,property,value)}},this),this.subTitle=function(show,language,index){forEachTextTracks(media,function(textTrack){!show||language&&language!==textTrack.language?textTrack.mode="hidden":textTrack.mode="showing"},index)},this.requestFullScreen=function(){doFullScreen(function(element){originalStyle.display=element.style.display,originalStyle.width=element.style.width,originalStyle.height=element.style.height,element[requestFullScreen]()})},this.exitFullScreen=function(){doFullScreen(function(){document[exitFullScreen]()})},this.isFullScreen=function(){return document[isFullScreen]},this.toggleFullScreen=function(){this.isFullScreen()?this.exitFullScreen():this.requestFullScreen()}}}}],caphMediaControls:[function(){return{restrict:"E",require:"^caphMedia",transclude:!0,link:function($scope,$element,$attrs,controller,$transclude){$scope.controls=controller,$transclude(function(clone){$element.append(clone)})}}}]})}]),app.directive("animateOnChange",["$timeout",function($timeout){return function(scope,element,attr){scope.$watch(attr.animateOnChange,function(nv,ov){nv!=ov&&(element.addClass("changed"),$timeout(function(){element.removeClass("changed")},0))})}}]);var imgChangeTimer;app.directive("imgChange",["$timeout",function($timeout){return function(scope,element,attr){scope.$watch(attr.imgChange,function(nv,ov){nv!=ov&&(imgChangeTimer=$timeout(function(){if(!element.find(".bk-img-top").attr("src")&&!element.find(".bk-img-bottom").attr("src"))return element.find(".bk-img-top").attr("src",nv),void element.find(".bk-img-bottom").attr("src",nv);"0"===element.find(".bk-img-top").css("opacity")?(element.find(".bk-img-top").attr("src",nv),element.find(".bk-img-top").removeClass("transparent")):(element.find(".bk-img-bottom").attr("src",nv),element.find(".bk-img-top").addClass("transparent"))},0))})}}]),app.directive("fadeIn",["$timeout",function($timeout){return{restrict:"A",link:function($scope,$element,attrs){$element.addClass("ng-hide-remove"),$element.removeClass("ng-hide-add"),$element.on("load",function(){$element.removeClass("ng-hide-remove"),$element.addClass("ng-hide-add")})}}}]),app.directive("trackProgressBar",[function(){return{restrict:"E",scope:{curVal:"@",maxVal:"@"},template:'<div class="progress-bar-bkgd"><div class="progress-bar-marker"></div></div>',link:function($scope,element,attrs){function updateProgress(){var progress=0,currentValue=$scope.curVal,maxValue=$scope.maxVal,progressBarWidth=progressBarBkgdElement.width();progress=Math.min(currentValue,maxValue)/maxValue*progressBarWidth,progressBarMarkerElement.css("width",progress+"px")}var progressBarBkgdElement=angular.element(element[0].querySelector(".progress-bar-bkgd")),progressBarMarkerElement=angular.element(element[0].querySelector(".progress-bar-marker"));$scope.$watch("curVal",updateProgress),$scope.$watch("maxVal",updateProgress)}}}]),app.directive("videoTrackProgressBar",[function(){return{restrict:"E",scope:{curVal:"@",maxVal:"@",playPos:"@",endPos:"@"},template:'<div class="video-progress-bar-wrapper"><div class="play-position"></div><div class="progress-bar-bkgd video"><div class="progress-bar-marker video"></div></div><div class="end-position"></div></div>',link:function($scope,element,attrs){function updateProgress(){var progress=0,currentValue=$scope.curVal,maxValue=$scope.maxVal,progressBarWidth=progressBarBkgdElement.width();progress=Math.min(currentValue,maxValue)/maxValue*progressBarWidth,progressBarMarkerElement.css("width",progress+"px")}function updateDisplayPosition(){var playPos=$scope.playPos,endPos=$scope.endPos;playPosElement.html(playPos),endPosElement.html(endPos)}var progressBarBkgdElement=angular.element(element[0].querySelector(".progress-bar-bkgd")),progressBarMarkerElement=angular.element(element[0].querySelector(".progress-bar-marker")),playPosElement=angular.element(element[0].querySelector(".play-position")),endPosElement=angular.element(element[0].querySelector(".end-position"));$scope.$watch("curVal",updateProgress),$scope.$watch("maxVal",updateProgress),$scope.$watch("playPos",updateDisplayPosition),$scope.$watch("endPos",updateDisplayPosition)}}}]),app.factory("CONSTANT",function(){var ITEM={loaded:!1};return{API_HOST:"http://otttv.viettel.com.vn",HTTPS_API_HOST:"https://otttv.viettel.com.vn",RECOMMENDATION_API_HOST:"http://otttv.viettel.com.vn",N0_VOD_ITEM:13,SERIES_CATEGORIES_BY_NAME:["PHIM BỘ","PHIM BỘ MIỄN PHÍ","KHU VƯỜN PHIM BỘ","Tiếng Anh lớp 6","Luyện Thi Toeic","YanTV","TV Show","Toán lớp 6","Tiếng Việt lớp 6","Toán lớp 10","Ngữ văn lớp 10","Tiếng Anh lớp 10","Toán THPTQG","Lý THPTQG","Hóa THPTQG","Giáo dục"],ITEM:ITEM,ITEMS:[ITEM,ITEM,ITEM,ITEM,ITEM,ITEM,ITEM,ITEM,ITEM,ITEM,ITEM,ITEM,ITEM,ITEM,ITEM,ITEM],CATEGORY:{MENU:0,CHANNEL:1,COLORS:2,ALPHABETS:3,NUMBERS:4,RELATED_PLAY_LIST:5,RELATED_PLAY_LIST2:6},EFFECT_DELAY_TIME:500,SCROLL_HEIGHT_OF_INDEX:380,MEDIA_CONTROLLER_TIMEOUT:3500,KEY_CODE:{RETURN:10009,ENTER:13,ESC:27,UP:38,DOWN:40,BACK:461,CHANNEL_UP:427,CHANNEL_DOWN:428,LG_CHANNEL_UP:33,LG_CHANNEL_DOWN:34,LG_POINT_APPEARED:1536,LG_POINT_DISAPPEARED:1537},SPOTLIGHT_BG_GRADIENT1:"linear-gradient(to right, rgba(0, 0, 0, 1) 0%, transparent)",SPOTLIGHT_BG_GRADIENT2:"linear-gradient(to top, rgba(0, 0, 0, 1) 5%, transparent)",SPOTLIGHT_BG_SIZE:"100%",SPOTLIGHT_BG_IMG_URL:"images/spotlight_movie.jpg",SPOTLIGHT_BG_WIDTH:"100%",CATEGORY_PAGE_BG_GRADIENT1:"linear-gradient(to right, rgba(0, 0, 0, 1) 0%, transparent)",CATEGORY_PAGE_BG_GRADIENT2:"linear-gradient(to top, rgba(0, 0, 0, 1) 0%, transparent)",CATEGORY_PAGE_BG_SIZE:"40% 100%, 0% 0%, 100% 100%",CATEGORY_PAGE_BG_IMG_URL:"images/spotlight_movie.jpg",CATEGORY_CHANNEL_PAGE_BG_GRADIENT1:"linear-gradient(to right, rgb(0, 0, 0) 0%, transparent)",CATEGORY_CHANNEL_PAGE_BG_GRADIENT2:"linear-gradient(to bottom, rgba(0, 0, 0, 0.75) 0%, transparent)",CATEGORY_CHANNEL_PAGE_BG_SIZE:"100% 100%, 100% 100%, 100% 100%",CATEGORY_CHANNEL_PAGE_BG_IMG_URL:"images/menu_bg_focused_1.jpg",MENU_BG_GRADIENT1:"linear-gradient(to right, rgba(0, 0, 0, 1) 0%, transparent)",MENU_BG_GRADIENT2:"linear-gradient(to top, rgba(0, 0, 0, 1) 0%, transparent)",MENU_BG_SIZE:"100%",MENU_BG_IMG_URL:"images/menu_bg_focused_0.jpg",MENU_BG_WIDTH:"100%",CATEGORY_BG_GRADIENT1:"linear-gradient(to right, rgb(0, 0, 0) 40%, transparent)",CATEGORY_BG_GRADIENT2:"linear-gradient(to top, rgb(0, 0, 0) 60%, transparent)",CATEGORY_BG_SIZE:"100% 100%, 60% 40%, 60% 100%",CATEGORY_VOD_BG_GRADIENT1:"linear-gradient(to right, rgb(0, 0, 0) 40%, transparent)",CATEGORY_VOD_BG_GRADIENT2:"linear-gradient(to top, rgb(0, 0, 0) 0%, transparent)",CATEGORY_VOD_BG_SIZE:"100% 100%, 60% 40%, 60% 100%",VOD_DETAIL_BG_GRADIENT1:"linear-gradient(to right, rgba(0, 0, 0, 1) 40%, transparent)",VOD_DETAIL_BG_GRADIENT2:"linear-gradient(to top, rgba(0, 0, 0, 1) 0%, transparent)",VOD_DETAIL_BG_SIZE:"100%",VOD_DETAIL_BG_IMG_URL:"images/spotlight_movie.jpg",VOD_DETAIL_BG_WIDTH:"60%",CHANNEL_BG_SIZE:"100% 100%, 100% 100%, 100%",CHANNEL_CATEGORY_LIST:[{name:"Tất cả các kênh",CONFIG_SERVICES:"154,193,194,150,141,20,9,157,158,133,192,53,16,17,51,18,180,38,186,218,15,52,177,208,181,198,207,234,72,221,222,223,37,145,205,226,210,159,32,30,239,277, 155,211,206,212,216,219,220,213,48,47,156,195,196,197,54,71,25,59,56,160,46,58,152,209,28,29,14,50,237,60,136,128,84,78,126,92,131,111,123,124,121,118,125,137,77,107,116,115,86"},{name:"Tin tức tổng hợp",CONFIG_SERVICES:"154,193,194,150,141,20,9,157,158,133,192"},{name:"Tin tức",CONFIG_SERVICES:"53,16,17,51,18,180,38,186,218,15,52,177,208,181,198"},{name:"Thiếu nhi",CONFIG_SERVICES:"207,72,234"},{name:"Thể thao",CONFIG_SERVICES:"221,222,223,37,145"},{name:"Phim truyện",CONFIG_SERVICES:"205,226,210,159,32,30"},{name:"Giải trí tổng hợp",CONFIG_SERVICES:"239,277,155,211,206,212,216,219,220,213,48,47,156,195,196,197,54,71,25,59,56,160,46,58,152,209,28,29,14,50,237,60"},{name:"Tỉnh/Thành phố",CONFIG_SERVICES:"136,128,84,78,126,92,131,111,123,124,121,118,125,137,77,107,116,115,86,127,132,112,76,97,10,103,93,94,138,100,96,102,140,110,85,119,83,88,129,98,114,99,117,90,122,104,108,109,81,105,139,87,120,95,80,101,106,130,135,79,91,134,89"}],SPOTLIGHT_VOD_LIST:[{img:"images/spotlight/spotlight_0.jpg",vodId:"58b132c3718cde303c411b8a"},{img:"images/spotlight/spotlight_1.jpg",vodId:"556fa737718c0e0711f2289f"},{img:"images/spotlight/spotlight_2.jpg",vodId:"571986dd718c03ef5c3bc177"}],PREPARED_DATA:{COLORS:[{description:"Bộ phim là câu chuyện xoay quanh luật sư James Donovan. Xuất thân là luật sư bảo hiểm, có ít kinh nghiệm về các vụ án hình sự, nhưng CIA đã lựa chọn và giao cho ông một nhiệm vụ an ninh tầm cỡ quốc gia vô cùng quan trọng trong thời kỳ cao điểm của Chiến tranh lạnh giữa Mỹ và Liên Xô những năm 60.",id:"color_1",name:"Người Đàm Phán",photo_urls:[{size:"144x206",url:"http://otttv.viettel.com.vn/api1/contents/pictures/586da1d9718cde303c37a8d5"}],color:"rgba(0, 0, 255,1)"},{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_2",name:"BROWN color",photo_urls:[{size:"144x206",url:"images/brown.png"}],color:"rgba(165, 42, 24,1)"},{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_3",name:"CITRUS color",photo_urls:[{size:"144x206",url:"images/citrus.png"}],color:"rgba(161, 197, 10,1)"},{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_4",name:"Deep Green color",photo_urls:[{size:"144x206",url:"images/deepGreen.png"}],color:"rgba(2, 89, 15,1)"},{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_5",name:"Dusk color",photo_urls:[{size:"144x206",url:"images/dusk.png"}],color:"rgba(78, 84, 129,1)"},{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_6",name:"Lime color",photo_urls:[{size:"144x206",url:"images/lime.png"}],color:"rgba(153, 255, 153,1)"},{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_7",name:"Maroon color",photo_urls:[{size:"144x206",url:"images/maroon.png"}],color:"rgba(101, 0,1,1)"},{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_8",name:"Merlot color",photo_urls:[{size:"144x206",url:"images/merlot.png"}],color:"rgba(102, 0, 51,1)"},{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_9",name:"Mint color",photo_urls:[{size:"144x206",url:"images/mint.png"}],color:"rgba(159, 254, 176,1)"},{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_10",name:"Mustard color",photo_urls:[{size:"144x206",url:"images/mustard.png"}],color:"rgba(255, 204, 102,1)"}],CHANNEL:[{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_0",name:"RED color",photo_urls:[{size:"144x206",url:"http://otttv.viettel.com.vn/api1/contents/pictures/586da1d9718cde303c37a8d5"}],color:"rgba(255, 0, 0,1)"},{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_1",name:"BLUE color",photo_urls:[{size:"144x206",url:"http://otttv.viettel.com.vn/api1/contents/pictures/586da1d9718cde303c37a8d5"}],color:"rgba(0, 0, 255,1)"},{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_2",name:"BROWN color",photo_urls:[{size:"144x206",url:"images/brown.png"}],color:"rgba(165, 42, 24,1)"},{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_3",name:"CITRUS color",photo_urls:[{size:"144x206",url:"images/citrus.png"}],color:"rgba(161, 197, 10,1)"},{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_4",name:"Deep Green color",photo_urls:[{size:"144x206",url:"images/deepGreen.png"}],color:"rgba(2, 89, 15,1)"},{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_5",name:"Dusk color",photo_urls:[{size:"144x206",url:"images/dusk.png"}],color:"rgba(78, 84, 129,1)"},{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_6",name:"Lime color",photo_urls:[{size:"144x206",url:"images/lime.png"}],color:"rgba(153, 255, 153,1)"},{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_7",name:"Maroon color",photo_urls:[{size:"144x206",url:"images/maroon.png"}],color:"rgba(101, 0,1,1)"},{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_8",name:"Merlot color",photo_urls:[{size:"144x206",url:"images/merlot.png"}],color:"rgba(102, 0, 51,1)"},{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_9",name:"Mint color",photo_urls:[{size:"144x206",url:"images/mint.png"}],color:"rgba(159, 254, 176,1)"},{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_10",name:"Mustard color",photo_urls:[{size:"144x206",url:"images/mustard.png"}],color:"rgba(255, 204, 102,1)"}],ALPHABETS:[{description:"This is alphabet description.",id:"alphabet_0",name:"Alphabet A",photo_urls:[{size:"144x206",url:"images/alphabet_a.png"}],color:"rgba(200, 191,11,1)"},{description:"This is alphabet description.",id:"alphabet_1",name:"Alphabet B",photo_urls:[{size:"144x206",url:"images/alphabet_b.png"}],color:"rgba(200, 191,11,1)"},{description:"This is alphabet description.",id:"alphabet_2",name:"Alphabet C",photo_urls:[{size:"144x206",url:"images/alphabet_c.png"}],color:"rgba(200, 191,11,1)"},{description:"This is alphabet description.",id:"alphabet_3",name:"Alphabet D",photo_urls:[{size:"144x206",url:"images/alphabet_d.png"}],color:"rgba(78, 84, 129,1)"},{description:"This is alphabet description.",id:"alphabet_4",name:"Alphabet E",photo_urls:[{size:"144x206",url:"images/alphabet_e.png"}],color:"rgba(78, 84, 129,1)"},{description:"This is alphabet description.",id:"alphabet_5",name:"Alphabet F",photo_urls:[{size:"144x206",url:"images/alphabet_f.png"}],color:"rgba(78, 84, 129,1)"},{description:"This is alphabet description.",id:"alphabet_6",name:"Alphabet G",photo_urls:[{size:"144x206",
url:"images/alphabet_g.png"}],color:"rgba(63, 72, 204,1)"},{description:"This is alphabet description.",id:"alphabet_7",name:"Alphabet H",photo_urls:[{size:"144x206",url:"images/alphabet_h.png"}],color:"rgba(63, 72, 204,1)"},{description:"This is alphabet description.",id:"alphabet_8",name:"Alphabet I",photo_urls:[{size:"144x206",url:"images/alphabet_i.png"}],color:"rgba(63, 72, 204,1)"},{description:"This is alphabet description.",id:"alphabet_9",name:"Alphabet J",photo_urls:[{size:"144x206",url:"images/alphabet_j.png"}],color:"rgba(2, 89, 15,1)"},{description:"This is alphabet description.",id:"alphabet_10",name:"Alphabet K",photo_urls:[{size:"144x206",url:"images/alphabet_k.png"}],color:"rgba(2, 89, 15,1)"},{description:"This is alphabet description.",id:"alphabet_11",name:"Alphabet L",photo_urls:[{size:"144x206",url:"images/alphabet_l.png"}],color:"rgba(2, 89, 15,1)"},{description:"This is alphabet description.",id:"alphabet_12",name:"Alphabet M",photo_urls:[{size:"144x206",url:"images/alphabet_m.png"}],color:"rgba(102, 0, 51,1)"},{description:"This is alphabet description.",id:"alphabet_13",name:"Alphabet N",photo_urls:[{size:"144x206",url:"images/alphabet_n.png"}],color:"rgba(102, 0, 51,1)"},{description:"This is alphabet description.",id:"alphabet_14",name:"Alphabet O",photo_urls:[{size:"144x206",url:"images/alphabet_o.png"}],color:"rgba(102, 0, 51,1)"},{description:"This is alphabet description.",id:"alphabet_15",name:"Alphabet P",photo_urls:[{size:"144x206",url:"images/alphabet_p.png"}],color:"rgba(101, 55, 0,1)"},{description:"This is alphabet description.",id:"alphabet_16",name:"Alphabet Q",photo_urls:[{size:"144x206",url:"images/alphabet_q.png"}],color:"rgba(101, 55, 0,1)"},{description:"This is alphabet description.",id:"alphabet_17",name:"Alphabet R",photo_urls:[{size:"144x206",url:"images/alphabet_r.png"}],color:"rgba(101, 55, 0,1)"},{description:"This is alphabet description.",id:"alphabet_18",name:"Alphabet S",photo_urls:[{size:"144x206",url:"images/alphabet_s.png"}],color:"rgba(136, 0, 21,1)"},{description:"This is alphabet description.",id:"alphabet_19",name:"Alphabet T",photo_urls:[{size:"144x206",url:"images/alphabet_t.png"}],color:"rgba(136, 0, 21,1)"},{description:"This is alphabet description.",id:"alphabet_20",name:"Alphabet U",photo_urls:[{size:"144x206",url:"images/alphabet_u.png"}],color:"rgba(136, 0, 21,1)"}],NUMBERS:[{description:"NUMBER Description",id:"number_1",name:"Number 1",photo_urls:[{size:"268x268",url:"images/1.png"}],color:"rgba(0, 162,12,1)"},{description:"NUMBER Description",id:"number_2",name:"Number 2",photo_urls:[{size:"268x268",url:"images/2.png"}],color:"rgba(0, 162,12,1)"},{description:"NUMBER Description",id:"number_3",name:"Number 3",photo_urls:[{size:"268x268",url:"images/3.png"}],color:"rgba(0, 162,12,1)"},{description:"NUMBER Description",id:"number_4",name:"Number 4",photo_urls:[{size:"268x268",url:"images/4.png"}],color:"rgba(0, 162,12,1)"},{description:"NUMBER Description",id:"number_5",name:"Number 5",photo_urls:[{size:"268x268",url:"images/5.png"}],color:"rgba(0, 162,12,1)"},{description:"NUMBER Description",id:"number_6",name:"Number 6",photo_urls:[{size:"268x268",url:"images/6.png"}],color:"rgba(0, 162,12,1)"},{description:"NUMBER Description",id:"number_7",name:"Number 7",photo_urls:[{size:"268x268",url:"images/7.png"}],color:"rgba(0, 162,12,1)"},{description:"NUMBER Description",id:"number_8",name:"Number 8",photo_urls:[{size:"268x268",url:"images/8.png"}],color:"rgba(0, 162,12,1)"},{description:"NUMBER Description",id:"number_9",name:"Number 9",photo_urls:[{size:"268x268",url:"images/9.png"}],color:"rgba(0, 162,12,1)"},{description:"NUMBER Description",id:"number_10",name:"Number 10",photo_urls:[{size:"268x268",url:"images/10.png"}],color:"rgba(0, 162,12,1)"}],CATEGORY_MENUS:[{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_0",name:"Tìm kiếm",photo_urls:[{size:"144x206",url:"images/deepGreen.png"}],color:"rgba(255, 0, 0,1)"},{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_1",name:"Phim",photo_urls:[{size:"144x206",url:"images/deepGreen.png"}],color:"rgba(0, 0, 255,1)"},{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_2",name:"Thiếu nhi",photo_urls:[{size:"144x206",url:"images/brown.png"}],color:"rgba(165, 42, 24,1)"},{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_3",name:"Nhạc",photo_urls:[{size:"144x206",url:"images/deepGreen.png"}],color:"rgba(161, 197, 10,1)"},{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_4",name:"Hài - Dân gian",photo_urls:[{size:"144x206",url:"images/deepGreen.png"}],color:"rgba(2, 89, 15,1)"},{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_5",name:"Dusk color",photo_urls:[{size:"144x206",url:"images/dusk.png"}],color:"rgba(78, 84, 129,1)"},{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_6",name:"Lime color",photo_urls:[{size:"144x206",url:"images/lime.png"}],color:"rgba(153, 255, 153,1)"},{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_7",name:"Maroon color",photo_urls:[{size:"144x206",url:"images/maroon.png"}],color:"rgba(101, 0,1,1)"},{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_8",name:"Merlot color",photo_urls:[{size:"144x206",url:"images/merlot.png"}],color:"rgba(102, 0, 51,1)"},{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_9",name:"Mint color",photo_urls:[{size:"144x206",url:"images/mint.png"}],color:"rgba(159, 254, 176,1)"},{description:"Put the description of color here. Put the description of blue color here. Put the description of color here. Put the description of color here. Put the description of blue color here. Put the description of color here.",id:"color_10",name:"Mustard color",photo_urls:[{size:"144x206",url:"images/mustard.png"}],color:"rgba(255, 204, 102,1)"}]}}}),function(){function DataService($rootScope,$http,$q,CONSTANT,SETTINGS,UltilService,localStorageService){function getChannelProduct(channelID){var channelProduct,url=CONSTANT.API_HOST+"/api1/contents/channels/"+channelID+"/?region=OTT&limit=1&format=long&include=product&include=multilang&include=purchase&include=fpackage",def=$q.defer();return $http.get(url).then(function(response){response.data?(channelProduct=UltilService.transformVOD(response.data),def.resolve(channelProduct)):def.resolve(channelProduct)},function(response){def.resolve(channelProduct)}),def.promise}function getChannelGuide(channelItem,date){var id=channelItem.channelId,def=$q.defer(),start=new Date;start.setHours(0,0,0,0);var end=new Date;end.setHours(23,59,59,999);var since=start.getTime(),until=end.getTime(),url=CONSTANT.API_HOST+"/api1/contents/channels/schedules?region=OTT&id="+id+"&include=product&since="+since+"&until="+until;return $http.get(url).then(function(response){var temp,start_time,data=response.data.data,item={};data.length>0?angular.forEach(data,function(value,key){temp=value.title[0].text.split(":"),item.org=value,item.program1=temp[0],item.program2=temp[1],item.program=item.program1+" : "+item.program2,start_time=value.start_time.split(":"),end_time=value.end_time.split(":"),item.time=start_time[0].substr(11,2)+":"+start_time[1]+" - "+end_time[0].substr(11,2)+":"+end_time[1],item.channelid=value.channel.id,item.id=value.id,item.service_id=value.service_id;var end_time=UltilService.strToTime(value.end_time);UltilService.addHours(end_time,2)<=new Date?(item.is_tvod=1,item.catchup_id=UltilService.getCatchupId(new Date(value.start_time),value.channel.pid,value.pid)):item.is_tvod=0;var parts=value.start_time.match(/\d+/g);start_time=new Date(parts[0],parts[1]-1,parts[2],parts[3],parts[4],parts[5]),parts=value.end_time.match(/\d+/g),(end_time=new Date(parts[0],parts[1]-1,parts[2],parts[3],parts[4],parts[5]))>=new Date&&start_time<=new Date&&(item.is_playing="now");var duration=end_time.getTime()-start_time.getTime();item.duration=duration,item.startTime=start_time,item.endTime=end_time,channelItem.guides.push(item),item={}}):(item.program1="Lịch phát sóng chưa được cập nhật",channelItem.guides.push(item)),def.resolve(channelItem)},function(response){}),def.promise}function getSpotlightContents(){var url=CONSTANT.API_HOST+"/api1/contents/campaigns/campaigns?pid=package.campaign://OTT.MAIN.PROMO.SMARTTV",def=$q.defer();return $http.get(url).then(function(response){var spotlightVodList=[];if(response.data.data){var programIds="",tenpArray=[];angular.forEach(response.data.data[0].data[0].campaigns,function(vodItem,key){programIds=programIds+vodItem.action_url+",",tenpArray.push({programId:vodItem.action_url,id:vodItem.id})}),getVodByProgramIdList(programIds).then(function(response){spotlightVodList=response;return angular.forEach(spotlightVodList,function(vodItem,key){var id=0;angular.forEach(tenpArray,function(item,key){item.programId===vodItem.program.id&&(id=item.id)}),vodItem.bigPhotoUrl=CONSTANT.API_HOST+"/api1/contents/pictures/"+id}),def.resolve(spotlightVodList)},function(response){def.resolve(spotlightVodList)})}else def.resolve(spotlightVodList)},function(response){}),def.promise}function getCategorySeriesVodListByCategoryId(categoryId,limit,offset,shortBy){var url="";url=void 0!==limit&&limit>0?void 0!==limit&&0!==offset?"popular"===shortBy?CONSTANT.API_HOST+"/api1/contents/categories/"+categoryId+"/categories?popular=true&offset="+offset+"&limit="+limit:CONSTANT.API_HOST+"/api1/contents/categories/"+categoryId+"/categories?offset="+offset+"&limit="+limit:"popular"===shortBy?CONSTANT.API_HOST+"/api1/contents/categories/"+categoryId+"/categories?popular=true&limit="+limit:CONSTANT.API_HOST+"/api1/contents/categories/"+categoryId+"/categories?limit="+limit:CONSTANT.API_HOST+"/api1/contents/categories/"+categoryId+"/categories?offset=0&limit="+CONSTANT.N0_VOD_ITEM;var seriesVodList=[],def=$q.defer();return $http.get(url).then(function(response){response.data.data?(seriesVodList=UltilService.transformSeriesVODList(response.data.data),def.resolve(seriesVodList)):def.resolve(seriesVodList)},function(response){def.resolve(seriesVodList)}),def.promise}function getEpisodesInSeries(seriesId,seriesSort,offset){var url="";url=offset?seriesSort?CONSTANT.API_HOST+"/api1/contents/programs/series?include=product&include=multilang&include=purchase&include=fpackage&id="+seriesId+"&format=long&offset="+offset+"&until=now&&series="+seriesSort:CONSTANT.API_HOST+"/api1/contents/programs/series?include=product&include=multilang&include=purchase&include=fpackage&id="+seriesId+"&format=long&offset="+offset+"&until=now&&series=asc":seriesSort?CONSTANT.API_HOST+"/api1/contents/programs/series?include=product&include=multilang&include=purchase&include=fpackage&id="+seriesId+"&format=long&offset=0&until=now&series="+seriesSort:CONSTANT.API_HOST+"/api1/contents/programs/series?include=product&include=multilang&include=purchase&include=fpackage&id="+seriesId+"&format=long&offset=0&until=now&series=asc";var def=$q.defer(),episodeVodList=[];return $http.get(url).then(function(response){response.data.data?(null!==response.data.data&&response.data.data.length>0&&(episodeVodList=UltilService.transformVODList(response.data.data)),def.resolve(episodeVodList)):def.resolve(episodeVodList)},function(){def.resolve(episodeVodList)}),def.promise}function getVodDetails(vodId){var url=CONSTANT.API_HOST+"/api1/contents/programs/"+vodId+"?include=product&include=multilang&include=purchase&include=fpackage&format=long",def=$q.defer();return $http.get(url).then(function(response){def.resolve(UltilService.transformVOD(response.data))},function(){def.reject("Failed to get getVodDetails")}),def.promise}function getVodURL(programId,productId,isFreeNoPair){var url;$rootScope.token.access_token;url=isFreeNoPair?CONSTANT.API_HOST+"/api1/watches/fvod/prepare?access_token="+SETTINGS.guest_access_token+"&id="+programId+"&product_id="+productId+"&version=1&bw_profile=5&category_id=VC_OTT&service_provider=SmartTV&user_id="+UltilService.getLoginUserId():CONSTANT.API_HOST+"/api1/watches/vod/prepare?id="+programId+"&region_id=GUEST&product_id="+productId+"&version=1&bw_profile=5&category_id=VC_OTT&service_provider=SmartTV&user_id="+UltilService.getLoginUserId();var def=$q.defer();return $http.get(url).then(function(response){def.resolve(response)},function(){def.reject("Failed to get getVodURL")}),def.promise}function getEpisodeListBySeriesId(categoryId,limit,offset){var url="";url=limit?offset?CONSTANT.API_HOST+"/api1/contents/categories/"+categoryId+"/programs?format=long&offset="+offset+"&until=now&include=product&include=purchase&include=fpackage&limit="+limit:CONSTANT.API_HOST+"/api1/contents/categories/"+categoryId+"/programs?format=long&offset=0&until=now&include=product&include=purchase&include=fpackage&limit="+limit:CONSTANT.API_HOST+"/api1/contents/categories/"+categoryId+"/programs?format=long&offset=0&until=now&include=product&include=purchase&include=fpackage&limit=-1";var def=$q.defer();return $http.get(url).then(function(response){var episodeVodList=UltilService.transformVODList(response.data.data);def.resolve(episodeVodList)},function(){def.reject("Failed to get getEpisodeListInSeries")}),def.promise}function getEpisodeListInSeries(seriesId,offset){var url="",seriesSort="desc";url=offset?CONSTANT.API_HOST+"/api1/contents/programs/series?id="+seriesId+"&include=purchase&include=fpackage&format=long&offset="+offset+"&until=now&series="+seriesSort:CONSTANT.API_HOST+"/api1/contents/programs/series?id="+seriesId+"&include=purchase&include=fpackage&format=long&offset=0&until=now&series="+seriesSort;var def=$q.defer();return $http.get(url).then(function(response){var episodeVodList=response.data.data;def.resolve(episodeVodList)},function(){def.reject("Failed to get getEpisodeListInSeries")}),def.promise}function getRelatedVodList(vodId){var url=CONSTANT.RECOMMENDATION_API_HOST+"/so-web-app/so/recommend?frmt=json&dp=VT_PHONE_016_VODINFO_AR_VOD&pc=1&cust=&program_id="+vodId+"&hot_max=12",def=$q.defer(),relatedVodList=[];return $http.get(url).then(function(response){if("NoScenarioResult"!==response.data.dp.status){var programIds="";angular.forEach(response.data.dp.itemList.items,function(vodItem,key){programIds=programIds+vodItem.basisInfo.basisList[0].value+","}),getVodByProgramIdList(programIds).then(function(response){null!==response&&response.length>0&&(relatedVodList=response),def.resolve(relatedVodList)},function(response){def.resolve(relatedVodList)})}else def.resolve(relatedVodList)},function(response){def.resolve(relatedVodList)}),def.promise}function getVodByProgramIdList(programIds){var url=CONSTANT.API_HOST+"/api1/contents/programs?id="+programIds+"&format=long&include=product&include=purchase&include=fpackage",def=$q.defer();return $http.get(url).then(function(response){var vodList=UltilService.transformVODList(response.data.data);def.resolve(vodList)},function(){def.reject("Failed to get getVodByProgramIdList")}),def.promise}function getVodMoreInfoByProgramIdList(programIds){var url=CONSTANT.API_HOST+"/api1/contents/programs?id="+programIds+"&format=long&include=product&include=purchase&include=fpackage",def=$q.defer();return $http.get(url).then(function(response){var vodList=new Array(response.data.data.length),index1=0,index2=0;angular.forEach(response.data.data,function(vod,key){if(vodList[key]=UltilService.transformVOD(vod),vodList[key].episodes=[],vod.program&&vod.program.series){vod.program.series.episodeName=vod.program.series.episode.replace(/^0+/,"");getEpisodesInSeries(vod.program.series.id).then(function(episodeVodList){if(index2++,vodList[key].episodes=episodeVodList,index1===vodList.length&&index2===vodList.length)return def.resolve(vodList)})}else index2++;getRelatedVodList(vod.program.id).then(function(res){if(index1++,vodList[key].relateds=res,index1===vodList.length&&index2===vodList.length)return def.resolve(vodList)})}),def.resolve(vodList)},function(){def.reject("Failed to get getVodByProgramIdList")}),def.promise}function getSeriesVodList(categoryId,offset,limit,shortBy){var url="";url=limit?offset?"popular"===shortBy?CONSTANT.API_HOST+"/api1/contents/categories/"+categoryId+"/categories?popular=true&offset="+offset+"&limit="+limit:CONSTANT.API_HOST+"/api1/contents/categories/"+categoryId+"/categories?offset="+offset+"&limit="+limit:"popular"===shortBy?CONSTANT.API_HOST+"/api1/contents/categories/"+categoryId+"/categories?popular=true&limit="+limit:CONSTANT.API_HOST+"/api1/contents/categories/"+categoryId+"/categories?limit="+limit:CONSTANT.API_HOST+"/api1/contents/categories/"+categoryId+"/categories?offset=0&limit=10";var def=$q.defer();return $http.get(url).then(function(response){var vodList=new Array(response.data.data.length),index=0;angular.forEach(response.data.data,function(seriesVOD,key){vodList[key]=seriesVOD,getEpisodeListBySeriesId(seriesVOD.id).then(function(episodeVodList){vodList[key]=episodeVodList[0],vodList[key].episodes=episodeVodList,vodList[key]=UltilService.transformVOD(vodList[key]),++index===vodList.length&&def.resolve(vodList)},function(response){def.resolve(vodList)})})},function(){def.reject("Failed to get albums")}),def.promise}function getChannelList(){var url=CONSTANT.API_HOST+"/api1/contents/channels?region=OTT&child=all&offset=0&limit=500",def=$q.defer();return $http.get(url).then(function(response){service.channelList=response.data.data.map(function(item,index){var photoUrl=CONSTANT.API_HOST+"/api1/contents/pictures/"+item.channel.id+"?type=original";return item.photoUrl=photoUrl,item.name=item.channel.name[0].text,item.firstTitle=item.channel.name[0].text,item.serviceId=item.service_id,item.channelId=item.service_id,item.isChannel=!0,item.guides=[],item.index=index,item.currentProgram=function(){},getChannelGuide(item),item}),def.resolve(service.channelList)},function(error){def.reject("Failed to get Channel list")}),def.promise}function getPrepareChannel(param){var token=localStorageService.get("token"),deviceId=UltilService.getDeviceUdid(),clientId=SETTINGS.client_id,appSecret=SETTINGS.app_secret,ts=(new Date).getTime(),hash=encodeURIComponent(CryptoJS.enc.Base64.stringify(CryptoJS.HmacSHA1(clientId+deviceId+UltilService.getLoginUserId()+ts,appSecret))),url=CONSTANT.API_HOST+"/api1/watches/handheld/live/preparetoken?access_token="+token.access_token+"&hash="+hash+"&ts="+ts+"&client_id="+clientId;$http.defaults.headers.post["Content-Type"]="application/json";var def=$q.defer();return $http.post(url,param).then(function(data,status,headers,config){def.resolve(data)},function(error){def.reject("Failed to get getPrepareChannel")}),def.promise}function getVodListByCategoryId(categoryId,offset,limit){var url=CONSTANT.API_HOST+"/api1/contents/categories/"+categoryId+"/programs?child=all&format=long&offset=0&include=product&include=purchase&include=fpackage&include=purchase&include=fpackage&until=now&limit="+CONSTANT.N0_VOD_ITEM;url=(offset||0===offset)&&limit?CONSTANT.API_HOST+"/api1/contents/categories/"+categoryId+"/programs?child=all&format=long&offset="+offset+"&include=product&include=purchase&include=fpackage&include=purchase&include=fpackage&until=now&limit="+limit:CONSTANT.API_HOST+"/api1/contents/categories/"+categoryId+"/programs?child=all&format=long&offset=0&include=product&include=purchase&include=fpackage&include=purchase&include=fpackage&until=now&limit="+CONSTANT.N0_VOD_ITEM;var def=$q.defer();return $http.get(url).then(function(response){var vodList=new Array(response.data.data.length),index2=0;return angular.forEach(response.data.data,function(vod,key){if(vodList[key]=UltilService.transformVOD(vod),vodList[key].episodes=[],vod.program&&vod.program.series){vod.program.series.episodeName=vod.program.series.episode.replace(/^0+/,"");vod.program.series.id}else index2++}),def.resolve(vodList)},function(error){def.reject("Failed to get getVodListByCategoryId")}),def.promise}function getCategoryVodListByCategoryId(categoryId,limit,offset){var url=CONSTANT.API_HOST+"/api1/contents/categories/"+categoryId+"/programs?child=all&format=long&offset=0&include=product&include=purchase&include=fpackage&include=purchase&include=fpackage&until=now&limit="+CONSTANT.N0_VOD_ITEM;url=void 0!==limit&&limit>0?void 0!==offset?CONSTANT.API_HOST+"/api1/contents/categories/"+categoryId+"/programs?child=all&format=long&offset="+offset+"&include=product&include=purchase&include=fpackage&include=purchase&include=fpackage&until=now&limit="+limit:CONSTANT.API_HOST+"/api1/contents/categories/"+categoryId+"/programs?child=all&format=long&offset=0&include=product&include=purchase&include=fpackage&include=purchase&include=fpackage&until=now&limit="+limit:CONSTANT.API_HOST+"/api1/contents/categories/"+categoryId+"/programs?child=all&format=long&offset=0&include=product&include=purchase&include=fpackage&include=purchase&include=fpackage&until=now&limit="+CONSTANT.N0_VOD_ITEM;var def=$q.defer();return $http.get(url).then(function(response){var vodList=UltilService.transformVODList(response.data.data);return def.resolve(vodList)},function(error){def.reject("Failed to get getVodListByCategoryId")}),def.promise}function getMenuCategories(){var url=CONSTANT.API_HOST+"/api1/contents/menus?version=Web_Live&child=all",def=$q.defer(),menuArray=[];return $http.get(url).then(function(response){var menuListLevel2=[],menuListLevel3=[],menuMap={};angular.forEach(response.data.data,function(item,key){var isItemHidden=!1;if(angular.forEach(item.config,function(config,key){"hidden"===config.name&&"true"===config.value&&(isItemHidden=!0)}),"__root"!==item.type&&!1===isItemHidden){if(1===(item.path_id.match(/\//g)||[]).length){var menuitem={name:item.name[0].text,this:item,children:[]};menuArray.push(menuitem),menuMap[item.id]=menuitem}2===(item.path_id.match(/\//g)||[]).length&&angular.forEach(menuArray,function(menu1,key){if(-1!==item.path_id.indexOf(menu1.this.path_id+"/")){var menuitem={name:item.name[0].text,this:item,children:[]};menu1.children.push(menuitem),menuListLevel2.push(menuitem),menuMap[item.id]=menuitem}}),3===(item.path_id.match(/\//g)||[]).length&&angular.forEach(menuListLevel2,function(menu2,key){if(-1!==item.path_id.indexOf(menu2.this.path_id+"/")){var menuitem={name:item.name[0].text,this:item,children:[]};menu2.children.push(menuitem),menuListLevel3.push(menuitem),menuMap[item.id]=menuitem}}),4===(item.path_id.match(/\//g)||[]).length&&angular.forEach(menuListLevel3,function(menu3,key){if(-1!==item.path_id.indexOf(menu3.this.path_id+"/")){var menuitem={name:item.name[0].text,this:item,children:[]};menu3.children.push(menuitem),menuMap[item.id]=menuitem}})}}),def.resolve(menuArray)},function(error){def.reject("Failed to get getMenuCategories")}),def.promise}var service={vodList:[],channelList:[],seriesVodList:[],getChannelList:getChannelList,getPrepareChannel:getPrepareChannel,getMenuCategories:getMenuCategories,getVodListByCategoryId:getVodListByCategoryId,getCategoryVodListByCategoryId:getCategoryVodListByCategoryId,getSeriesVodList:getSeriesVodList,getRelatedVodList:getRelatedVodList,getEpisodeListInSeries:getEpisodeListInSeries,getEpisodeListBySeriesId:getEpisodeListBySeriesId,getVodURL:getVodURL,getVodDetails:getVodDetails,getEpisodesInSeries:getEpisodesInSeries,getCategorySeriesVodListByCategoryId:getCategorySeriesVodListByCategoryId,getVodByProgramIdList:getVodByProgramIdList,getVodMoreInfoByProgramIdList:getVodMoreInfoByProgramIdList,getSpotlightContents:getSpotlightContents,getChannelGuide:getChannelGuide,getChannelProduct:getChannelProduct};return service}app.factory("DataService",DataService),DataService.inject=["$rootScope","$http","$q","CONSTANT","SETTINGS","UltilService","localStorageService"],DataService.$inject=["$rootScope","$http","$q","CONSTANT","SETTINGS","UltilService","localStorageService"]}(),function(){function UltilService($http,$q,CONSTANT,SETTINGS,localStorageService){function getDeviceUdid(){return localStorageService.get("deviceUdid")}function getChannelByIndex(channelList,index){var channel;return angular.forEach(channelList,function(channelItem,key){index===key&&(channel=channelItem,angular.break)}),channel}function getLoginUserId(){var token=localStorageService.get("token");return token.user_id}function getCatchupId(start_time,serviceId,pid){var yyyy=start_time.getFullYear(),mm=start_time.getMonth()<9?"0"+(start_time.getMonth()+1):start_time.getMonth()+1,dd=start_time.getDate()<10?"0"+start_time.getDate():start_time.getDate(),hh=start_time.getHours()<10?"0"+start_time.getHours():start_time.getHours(),min=start_time.getMinutes()<10?"0"+start_time.getMinutes():start_time.getMinutes(),ss=start_time.getSeconds()<10?"0"+start_time.getSeconds():start_time.getSeconds();return"".concat(yyyy).concat(mm).concat(dd).concat(hh).concat(min).concat(ss)+"_"+serviceId+"_"+pid}function addHours(time,h){return time.setTime(time.getTime()+60*h*60*1e3),time}function strToTime(str){var time_temp=str.split(":"),time=new Date;return time.setYear(time_temp[0].substr(0,4)),time.setMonth(time_temp[0].substr(5,2)-1),time.setDate(time_temp[0].substr(8,2)),time.setHours(time_temp[0].substr(11,2)),time.setMinutes(time_temp[1]),time.setSeconds(time_temp[2].substr(0,2)),time}function isSeriesCategory(menu){var isLeaf=!0;return!!(menu.this.config&&menu.this.config.length>0)&&(angular.forEach(menu.this.config,function(config,key2){"__leaf_category"===config.name&&"false"===config.value&&(isLeaf=!1,angular.break)}),"general"===menu.this.type||!isLeaf)}function getVodCategoryId(menu){var flag="";return menu.this.config?(angular.forEach(menu.this.config,function(config,key2){"__category"===config.name&&(flag=config.value,angular.break)}),flag):""}function checkFreeProduct(product){var temp=!1;return angular.forEach(product.locations,function(location,key){angular.forEach(location.parameter,function(parameter,key){"Audience"===parameter.name&&"private:All"===parameter.value&&(temp=!0)}),temp||angular.forEach(product.price,function(price,key){"VND"===price.currency&&0===price.value&&(temp=!0)})}),temp}function getLiteProduct(product){var temp={};temp.id=product.id,temp.type=product.type,temp.name=product.name,temp.description=product.description;var priceObj={},priceObjs=[];return product.rental_periods.length>0?angular.forEach(product.rental_periods,function(rental_period,key){angular.forEach(rental_period.price,function(price,key){priceObj={},"VND"===price.currency&&(priceObj.price=Math.ceil(price.value-product.discount_rate*price.value),priceObj.period=rental_period.period,priceObj.unit=rental_period.unit,priceObjs.push(priceObj))})}):angular.forEach(product.price,function(price,key){priceObj={},"VND"===price.currency&&(priceObj.price=Math.ceil(price.value-product.discount_rate*price.value),priceObjs.push(priceObj))}),temp.price=priceObjs,temp}function transformVOD(vod){var svod=vod;if(svod.isVisiable=!1,svod.isPublish=!1,svod.isVtvCab=!1,svod.isWifiPackage=!1,svod.isSingleVOD=!1,svod.isPurchasedPackage=!1,svod.isExclusivePackage=!1,svod.isPurchasedExclusive=!1,svod.isEncrypted=!1,svod.purchased_products=[],svod.purchasable_products=[],svod.program){svod.photoUrl=CONSTANT.API_HOST+"/api1/contents/pictures/"+vod.program.id+"?width=215.000000&height=307.000000",svod.bigPhotoUrl=CONSTANT.API_HOST+"/api1/contents/pictures/"+vod.program.id,svod.name=vod.program.title[0].text;var des=vod.program.synopsis[0].text,tm="Thuyết minh - ";0===des.indexOf(tm)&&(des=des.substring(tm.length-1,des.length-1)),tm="Phụ đề - ",0===des.indexOf(tm)&&(des=des.substring(tm.length-1,des.length-1)),tm="Phụ đề- ",0===des.indexOf(tm)&&(des=des.substring(tm.length-1,des.length-1)),svod.description=des.substring(0,398),svod.shortDescription=des.substring(0,300),vod.program.series?svod.isVodInSeries=!0:svod.isVodInSeries=!1,svod.name=svod.name.replace("–","-");var nameSplit=[];nameSplit=svod.name.indexOf(" - ")>0?svod.name.split(" - "):svod.name.indexOf(" – ")>0?svod.name.split(" – "):svod.name.indexOf("–")>0?svod.name.split("–"):svod.name.indexOf("-")>0?svod.name.split("-"):[svod.name],nameSplit.length>1?nameSplit[0].toUpperCase().indexOf("TẬP")>=0?4===nameSplit.length?(svod.firstTitle=nameSplit[2].trim()+" - "+nameSplit[3].trim(),svod.secondTitle=nameSplit[0].trim()+" : "+nameSplit[1].trim()):3===nameSplit.length?(svod.firstTitle=nameSplit[2].trim(),svod.secondTitle=nameSplit[0].trim()+" : "+nameSplit[1].trim()):2===nameSplit.length?(svod.firstTitle=nameSplit[1].trim(),svod.secondTitle=nameSplit[0].trim()):(svod.firstTitle=nameSplit[1],svod.secondTitle=""):nameSplit[0].toUpperCase().indexOf("PHẦN")>=0?3===nameSplit.length?(svod.firstTitle=nameSplit[2].trim(),svod.secondTitle=nameSplit[0].trim()+" : "+nameSplit[1].trim()):2===nameSplit.length?(svod.firstTitle=nameSplit[1].trim(),svod.secondTitle=nameSplit[0].trim()):(svod.firstTitle="",svod.secondTitle=""):3===nameSplit.length?(svod.firstTitle=nameSplit[1].trim()+" : "+nameSplit[2].trim(),svod.secondTitle=nameSplit[0].trim()):2===nameSplit.length?(svod.firstTitle=nameSplit[1].trim(),svod.secondTitle=nameSplit[0].trim()):(svod.firstTitle="",svod.secondTitle=""):(svod.firstTitle=nameSplit[0].trim(),svod.secondTitle=""),void 0!==vod.program.directors_text&&vod.program.directors_text.length>0&&""!==vod.program.directors_text[0].text?svod.directors=vod.program.directors_text[0].text:svod.directors="",void 0!==vod.program.actors_text&&vod.program.actors_text.length>0&&""!==vod.program.actors_text[0].text?svod.actors=vod.program.actors_text[0].text:svod.actors="",svod.genres="",void 0!==vod.program.genres&&null!==vod.program.genres?vod.program.genres.length>1?angular.forEach(vod.program.genres,function(genres,key){key===vod.program.genres.length-1?svod.genres=svod.genres+genres:svod.genres=svod.genres+genres+","}):svod.genres=vod.program.genres[0]:svod.genres="",void 0!==vod.program.production_country&&""!==vod.program.production_country?svod.country=vod.program.production_country.substring(0,vod.program.production_country.length-1):svod.country=""}if(void 0!==vod.program&&(svod.program_id=vod.program.id),void 0!==vod.visible&&vod.visible&&(svod.isVisiable=!0),void 0!==vod.config&&angular.forEach(vod.config,function(item,key){"Public"===item.name&&"1"===item.value&&(svod.isPublish=!0)}),
void 0!==vod.channel&&void 0!==vod.channel.genres&&angular.forEach(vod.channel.genres,function(item,key){"1:11:0:0"===item&&(svod.isVtvCab=!0)}),angular.forEach(vod.product,function(product,key){svod.isFreeNoPair=checkFreeProduct(product),void 0!==product.purchase&&"false"===product.purchasable&&(svod.isWifiPackage=!0),"single"!==product.type&&"true"===product.purchasable&&0===product.cclass.indexOf("HANDHELD")&&(void 0!==product.exclusive&&"true"===product.exclusive&&"true"===product.purchasable&&(svod.isExclusivePackage=!0,void 0!==product.purchase&&(svod.isPurchasedExclusive=!0)),void 0!==product.purchase?(svod.isPurchasedPackage=!0,svod.purchased_products.push(getLiteProduct(product))):svod.purchasable_products.push(getLiteProduct(product))),"single"===product.type&&product.cclass.indexOf("HANDHELD")>=0&&(svod.isSingleVOD=!0,svod.singleProductId=product.id,1===product.cclass.length?void 0!==product.location&&("handheld"===product.location.device&&(svod.vodLocator=product.location.locator),"handheld"===product.location.device&&"true"===product.location.encryption&&(svod.isEncrypted=!0)):angular.forEach(product.locations,function(location,key){"handheld"===location.device&&(svod.vodLocator=location.locator),"handheld"===location.device&&"true"===location.encryption&&(svod.isEncrypted=!0)})),vod.contentFormat&&"HD"===vod.contentFormat.toUpperCase()?svod.contentFormat="HD":svod.contentFormat="SD"}),svod.program){var take=vod.program.display_runtime.split(":"),minutes=0;take.length>1?minutes=60*parseFloat(take[0])+parseFloat(take[1]):1===take.length&&(minutes=parseFloat(take[0])),svod.duration=minutes}return svod}function transformSeriesVOD(seriesVod){var svod=seriesVod;return svod.isSeries=!0,svod.photoUrl=CONSTANT.API_HOST+"/api1/contents/categories/"+seriesVod.id+"/picture?width=215.000000&height=307.000000",svod.name=seriesVod.name[0].text,svod.firstTitle=svod.name,svod.secondTitle="",svod.description&&(svod.description=svod.description[0].text),svod.isSeriesEnd=!1,angular.forEach(seriesVod.config,function(config,key){"seriesend"===config.name&&"true"===config.value&&(svod.isSeriesEnd=!0)}),svod}function transformSeriesVODList(seriesVodList){var arrayTemp=[];return angular.forEach(seriesVodList,function(vod,key){var svod=transformSeriesVOD(vod);arrayTemp.push(svod)}),arrayTemp}function transformVODList(vodList){var arrayTemp=[];return angular.forEach(vodList,function(vod,key){var svod=transformVOD(vod);arrayTemp.push(svod)}),arrayTemp}return{vodList:[],channelList:[],getVodCategoryId:getVodCategoryId,checkFreeProduct:checkFreeProduct,getLiteProduct:getLiteProduct,transformVOD:transformVOD,transformVODList:transformVODList,isSeriesCategory:isSeriesCategory,transformSeriesVOD:transformSeriesVOD,transformSeriesVODList:transformSeriesVODList,strToTime:strToTime,addHours:addHours,getCatchupId:getCatchupId,getLoginUserId:getLoginUserId,getChannelByIndex:getChannelByIndex,getDeviceUdid:getDeviceUdid}}app.factory("UltilService",UltilService),UltilService.inject=["$http","$q","CONSTANT","SETTINGS","localStorageService"],UltilService.$inject=["$http","$q","CONSTANT","SETTINGS","localStorageService"]}(),function(){function VideoService($timeout,$http,$q,CONSTANT,SETTINGS,DataService,UltilService){function playStream(stream,video,def){defferStream=def,hls&&(hls.destroy(),hls.bufferTimer&&(clearInterval(hls.bufferTimer),hls.bufferTimer=void 0),hls=null),recoverDecodingErrorDate=recoverSwapAudioCodecDate=null,hls=new Hls({}),hls.loadSource(stream),hls.attachMedia(video),hls.on(Hls.Events.MANIFEST_PARSED,function(){}),hls.on(Hls.Events.LEVEL_LOADED,function(event,data){}),hls.on(Hls.Events.MEDIA_DETACHED,function(){}),hls.on(Hls.Events.ERROR,function(event,data){switch(data.details){case Hls.ErrorDetails.MANIFEST_LOAD_ERROR:try{data.response.code}catch(err){}break;case Hls.ErrorDetails.MANIFEST_LOAD_TIMEOUT:case Hls.ErrorDetails.MANIFEST_PARSING_ERROR:case Hls.ErrorDetails.LEVEL_LOAD_ERROR:case Hls.ErrorDetails.LEVEL_LOAD_TIMEOUT:case Hls.ErrorDetails.LEVEL_SWITCH_ERROR:case Hls.ErrorDetails.FRAG_LOAD_ERROR:case Hls.ErrorDetails.FRAG_LOAD_TIMEOUT:case Hls.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case Hls.ErrorDetails.FRAG_DECRYPT_ERROR:case Hls.ErrorDetails.FRAG_PARSING_ERROR:break;case Hls.ErrorDetails.KEY_LOAD_ERROR:case Hls.ErrorDetails.KEY_LOAD_TIMEOUT:errorData.name="ENCRYPTED_CONTENT_ERROR",errorData.description="error while loading key "+data.frag.decryptdata.uri,def.reject(errorData);break;case Hls.ErrorDetails.BUFFER_APPEND_ERROR:case Hls.ErrorDetails.BUFFER_ADD_CODEC_ERROR:case Hls.ErrorDetails.BUFFER_APPENDING_ERROR:}if(data.fatal)switch(data.type){case Hls.ErrorTypes.MEDIA_ERROR:handleMediaError();break;case Hls.ErrorTypes.NETWORK_ERROR:hls.destroy();var errorTxt="Nội dung này hiện tại không xem được. Xin vui lòng thử lại sau. Xin lỗi quý khách vì sự bất tiện này!";errorData.name="NETWORK_ERROR",errorData.description=errorTxt,defferStream.reject(errorData);break;default:hls.destroy();var errorTxt="Nội dung này hiện tại không xem được. Xin vui lòng thử lại sau. Xin lỗi quý khách vì sự bất tiện này!";errorData.name="UNRECOVERABLE_ERROR",errorData.description=errorTxt,defferStream.reject(errorData)}}),video.addEventListener("resize",handleVideoEvent),video.addEventListener("seeking",handleVideoEvent),video.addEventListener("seeked",handleVideoEvent),video.addEventListener("pause",handleVideoEvent),video.addEventListener("play",handleVideoEvent),video.addEventListener("canplay",handleVideoEvent),video.addEventListener("canplaythrough",handleVideoEvent),video.addEventListener("ended",handleVideoEvent),video.addEventListener("playing",handleVideoEvent),video.addEventListener("error",handleVideoEvent),video.addEventListener("loadedmetadata",handleVideoEvent),video.addEventListener("loadeddata",handleVideoEvent),video.addEventListener("durationchange",handleVideoEvent)}function playChannelStream(serviceId,video){var param={version:3,regionId:"GUEST",assetId:serviceId,channelId:serviceId,filename:serviceId+".m3u8",clientIP:"220.231.127.1",manifestType:"HLS",bwProfile:5,serviceProvider:"SmartTV",userId:UltilService.getLoginUserId()},def=$q.defer();return DataService.getPrepareChannel(param).then(function(response){if(void 0!==response.data.glbAddress&&response.data.glbAddress.length>0){if(response.data.glbAddress.length>0){for(var i=0;i<response.data.glbAddress.length;i++)var stream="http://"+response.data.glbAddress[i]+"/"+param.assetId+".m3u8?AdaptiveType=HLS&VOD_RequestID="+encodeURIComponent(response.data.requestId);playStream(stream,video,def)}}},function(data,status){}),def.promise}function playVODStream(vod,video,callback){cb=callback;var def=$q.defer(),playable=!1;return vod.isExclusivePackage?vod.isPurchasedExclusive&&(playable=!0):(vod.isFreeNoPair||vod.isWifiPackage||vod.isPurchasedPackage)&&(playable=!0),playable&&DataService.getVodURL(vod.program.id,vod.singleProductId,vod.isFreeNoPair).then(function(response){var vodRequestId=response.data.gsdm.vod_request_id,stream="";if(response.data.gsdm.glb_addresses.length>0)for(var i=0;i<response.data.gsdm.glb_addresses.length;i++)stream="http://"+response.data.gsdm.glb_addresses[i]+"/"+vod.vodLocator+"?AdaptiveType=HLS&VOD_RequestID="+encodeURIComponent(vodRequestId);playStream(stream,video,def,callback)},function(response){}),def.promise}function stopStream(){hls&&(hls.destroy(),hls.bufferTimer&&(clearInterval(hls.bufferTimer),hls.bufferTimer=void 0),hls=null)}function handleVideoEvent(evt){switch(evt.type){case"durationchange":case"resize":break;case"loadedmetadata":defferStream.resolve("PLAYING");break;case"loadeddata":case"canplay":case"canplaythrough":case"ended":case"seeking":case"play":case"playing":break;case"pause":case"waiting":case"stalled":case"error":if(Math.round(1e3*evt.target.currentTime),"error"===evt.type){var errorTxt,mediaError=evt.currentTarget.error;switch(mediaError.code){case mediaError.MEDIA_ERR_ABORTED:errorTxt="You aborted the video playback";break;case mediaError.MEDIA_ERR_DECODE:errorTxt="The video playback was aborted due to a corruption problem or because the video used features your browser did not support",handleMediaError();break;case mediaError.MEDIA_ERR_NETWORK:errorTxt="A network error caused the video download to fail part-way";break;case mediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:errorTxt="The video could not be loaded, either because the server or network failed or because the format is not supported",errorData.name="ENCRYPTED_CONTENT_ERROR",errorData.description=errorTxt,defferStream.reject(errorData)}}}}function handleMediaError(){var now=performance.now();!recoverDecodingErrorDate||now-recoverDecodingErrorDate>3e3?(recoverDecodingErrorDate=performance.now(),hls.recoverMediaError()):(!recoverSwapAudioCodecDate||now-recoverSwapAudioCodecDate>3e3)&&(recoverSwapAudioCodecDate=performance.now(),hls.swapAudioCodec(),hls.recoverMediaError())}var hls,cb,errorData={name:"",code:"",description:""};return{vodList:[],channelList:[],playStream:playStream,playChannelStream:playChannelStream,playVODStream:playVODStream,stopStream:stopStream};var defferStream,recoverDecodingErrorDate,recoverSwapAudioCodecDate}app.factory("VideoService",VideoService),VideoService.inject=["$timeout","$http","$q","CONSTANT","SETTINGS","DataService","UltilService"],VideoService.$inject=["$timeout","$http","$q","CONSTANT","SETTINGS","DataService","UltilService"]}(),function(){function Account(){function getAccount(){return""}return{getAccount:getAccount}}angular.module("vietteltv").factory("Account",Account)}(),function(){function AuthServerProvider($http,localStorageService,$q,SETTINGS,CONSTANT){function renewToken(){var oldToken=localStorageService.get("token"),param={refresh_token:oldToken.refresh_token,client_id:SETTINGS.client_id,hash:CryptoJS.enc.Base64.stringify(CryptoJS.HmacSHA1(oldToken.refresh_token+SETTINGS.client_id,SETTINGS.app_secret))},requestUrl=CONSTANT.API_HOST+"/ott/accounts/delegation";$http.defaults.headers.post["Content-Type"]="application/json";var def=$q.defer();return $http.post(requestUrl,param).then(function(response){if(void 0!==response.data.access_token&&void 0!==response.data.expiration_date&&void 0!==response.data.refresh_token&&void 0!==response.data.refresh_token_expiration_date){var token={access_token:response.data.access_token,token_secret:response.data.token_secret,login_access_token:response.data.access_token,refresh_token:response.data.refresh_token,expiration_date:response.data.expiration_date,refresh_token_expiration_date:response.data.refresh_token_expiration_date,temp_password:response.data.temp_password,user_id:oldToken.user_id,password:oldToken.password};localStorageService.set("token",token),def.resolve(response)}else def.reject("Failed to get renewToken")},function(){def.reject("Failed to get renewToken")}),def.promise}function getToken(){return localStorageService.get("accessToken")}function hasValidToken(){var token=this.getToken();return token&&token.expires&&token.expires>(new Date).getTime()}function login(credentials){var requestObj={};requestObj.client_id=SETTINGS.client_id,requestObj.id=credentials.username,requestObj.password=CryptoJS.enc.Base64.stringify(CryptoJS.HmacSHA1(requestObj.id+credentials.password,credentials.password));var deviceObject={};if(localStorageService.get("deviceUdid")){deviceObject.id=localStorageService.get("deviceUdid"),deviceObject.model="PC_WINDOWS",deviceObject.model_no="PC_WINDOWS",deviceObject.type="others",requestObj.device=deviceObject;var url=CONSTANT.API_HOST+"/ott/accounts/login";return $http.post(url,requestObj,{headers:{Accept:"application/json"}}).then(function(response){if(response.data.error){$q.defer().reject("Loi Dang nhap")}else{var token={access_token:response.data.access_token,token_secret:response.data.token_secret,login_access_token:response.data.access_token,refresh_token:response.data.refresh_token,expiration_date:response.data.expiration_date,refresh_token_expiration_date:response.data.refresh_token_expiration_date,temp_password:response.data.temp_password,user_id:credentials.username,password:credentials.password};localStorageService.set("token",token)}return response},function(error){return error})}(new Fingerprint2).get(function(result,components){localStorageService.set("deviceUdid",result),deviceObject.id=localStorageService.get("deviceUdid"),deviceObject.model="PC_WINDOWS",deviceObject.model_no="PC_WINDOWS",deviceObject.type="others",requestObj.device=deviceObject;var url=CONSTANT.API_HOST+"/ott/accounts/login";return $http.post(url,requestObj,{headers:{Accept:"application/json"}}).then(function(response){if(response.data.error){$q.defer().reject("Loi Dang nhap")}else{var token={access_token:response.data.access_token,token_secret:response.data.token_secret,login_access_token:response.data.access_token,refresh_token:response.data.refresh_token,expiration_date:response.data.expiration_date,refresh_token_expiration_date:response.data.refresh_token_expiration_date,temp_password:response.data.temp_password,user_id:credentials.username,password:credentials.password};localStorageService.set("token",token)}return response},function(error){return error})})}function logout(){var url=CONSTANT.API_HOST+"/ott/accounts/logout",def=$q.defer();return $http.post(url).then(function(data,status,headers,config){def.resolve(data)},function(error,status){def.reject("Failed to  logout")}),def.promise}return{getToken:getToken,hasValidToken:hasValidToken,login:login,logout:logout,renewToken:renewToken}}app.factory("AuthServerProvider",AuthServerProvider),AuthServerProvider.$inject=["$http","localStorageService","$q","SETTINGS","CONSTANT"]}(),function(){function Auth($rootScope,localStorageService,$q,Principal,AuthServerProvider,Account,LoginService){function authorize(force,callback){function authThen(){Principal.isAuthenticated();return cb()}var cb=callback||angular.noop;return Principal.identity(force).then(authThen)}function login(credentials,callback){function loginThen(data){return Principal.identity(!0).then(function(account){deferred.resolve(data)}),cb()}var cb=callback||angular.noop,deferred=$q.defer();return AuthServerProvider.login(credentials).then(loginThen).catch(function(err){return this.logout(),deferred.reject(err),cb(err)}.bind(this)),deferred.promise}function renewToken(credentials,callback){function renewTokenThen(data){return deferred.resolve(data),cb()}var cb=callback||angular.noop,deferred=$q.defer();return AuthServerProvider.renewToken().then(renewTokenThen).catch(function(err){return deferred.reject(err),cb(err)}.bind(this)),deferred.promise}function logout(){AuthServerProvider.logout(),Principal.authenticate(null),localStorageService.set("token",null)}return{authorize:authorize,login:login,logout:logout,renewToken:renewToken}}app.factory("Auth",Auth),Auth.$inject=["$rootScope","localStorageService","$q","Principal","AuthServerProvider","Account","LoginService"]}(),function(){function LoginService(focusController,$timeout){function openLoginPage(callback){var cb=callback||angular.noop;return $("#login-page").addClass("login-page-show"),$timeout(function(){$("#username").click()},1e3),cb()}function closeLoginPage(callback){var cb=callback||angular.noop;return $("#login-page").removeClass("login-page-show"),$(".login-row").removeClass("focused"),cb()}return{openLoginPage:openLoginPage,closeLoginPage:closeLoginPage}}angular.module("vietteltv").factory("LoginService",LoginService),LoginService.$inject=["focusController","$timeout"]}(),function(){function Principal($q,Account,localStorageService){function authenticate(identity){_identity=identity,_authenticated=null!==identity}function hasAnyAuthority(authorities){if(!_authenticated||!_identity||!_identity.authorities)return!1;for(var i=0;i<authorities.length;i++)if(-1!==_identity.authorities.indexOf(authorities[i]))return!0;return!1}function hasAuthority(authority){return _authenticated?this.identity().then(function(_id){return _id.authorities&&-1!==_id.authorities.indexOf(authority)},function(){return!1}):$q.when(!1)}function identity(force){var deferred=$q.defer();return!0===force&&(_identity=void 0),angular.isDefined(_identity)?(deferred.resolve(_identity),deferred.promise):(localStorageService.get("token")?(_identity="LOGIN_SUCCESS",_authenticated=!0):(_identity="LOGIN_FAILED",_authenticated=!1),deferred.resolve(_identity),deferred.promise)}function isAuthenticated(){return _authenticated}function isIdentityResolved(){return angular.isDefined(_identity)}var _identity,_authenticated=!1;return{authenticate:authenticate,hasAnyAuthority:hasAnyAuthority,hasAuthority:hasAuthority,identity:identity,isAuthenticated:isAuthenticated,isIdentityResolved:isIdentityResolved}}angular.module("vietteltv").factory("Principal",Principal),Principal.$inject=["$q","Account","localStorageService"]}(),app.factory("authInterceptor",["$rootScope","$q","$location","$injector","localStorageService","SETTINGS","CONSTANT","httpBuffer",function($rootScope,$q,$location,$injector,localStorageService,SETTINGS,CONSTANT,httpBuffer){var inFlightAuthRequest=null,loginAgainKickRequest=null,renewErrorRequest=null,responseNullRequest=null;return{request:function(config){config.headers=config.headers||{};var token=localStorageService.get("token");return $rootScope.token=token,token?(config.url.indexOf("watches/fvod/prepare")<0&&(config.headers.Authorization="Bearer "+token.access_token),config):(config.headers.Authorization="Bearer "+SETTINGS.guest_access_token,config)},responseError:function(response){var deferred=$q.defer(),token=localStorageService.get("token");if(null===response.data){var Auth=$injector.get("Auth");return responseNullRequest||(responseNullRequest=Auth.login({username:token.user_id,password:token.password})),responseNullRequest.then(function(r){responseNullRequest=null,httpBuffer.append(response.config,deferred),$injector.get("$http")(response.config).then(function(resp){deferred.resolve(resp)},function(resp){deferred.reject()})},function(r){responseNullRequest=null,deferred.reject()}),response||$q.when(response)}if("C0201"===response.data.error.code||"C0202"===response.data.error.code||"C0203"===response.data.error.code){if(null!==token&&null===token.refresh_token&&!inFlightAuthRequest){var Auth=$injector.get("Auth");inFlightAuthRequest=Auth.login({username:token.user_id,password:token.password})}if(null!==token&&null!==token.refresh_token&&!inFlightAuthRequest){var Auth=$injector.get("Auth");inFlightAuthRequest=Auth.renewToken()}return inFlightAuthRequest.then(function(r){inFlightAuthRequest=null,httpBuffer.append(response.config,deferred),$injector.get("$http")(response.config).then(function(resp){deferred.resolve(resp)},function(resp){deferred.reject()})},function(r){if(!renewErrorRequest){var Auth=$injector.get("Auth");renewErrorRequest=Auth.login({username:token.user_id,password:token.password})}renewErrorRequest.then(function(r){renewErrorRequest=null,$injector.get("$http")(response.config).then(function(resp){deferred.resolve(resp)},function(resp){deferred.reject()})},function(r){renewErrorRequest=null,deferred.reject()})}),deferred.promise}if("U0124"===response.data.error.code){var Auth=$injector.get("Auth");return loginAgainKickRequest||(loginAgainKickRequest=Auth.login({username:token.user_id,password:token.password})),loginAgainKickRequest.then(function(r){loginAgainKickRequest=null,deferred.reject(),httpBuffer.retryAll()},function(r){loginAgainKickRequest=null,deferred.reject()}),deferred.promise}return response||$q.when(response)}}}]),angular.module("vietteltv").controller("Controller",Controller),Controller.$inject=["$rootScope","$scope","$state","$timeout","$document","FocusUtil","FocusConstant","focusController","CONSTANT","DataService","$http","UltilService","VideoService","Principal","LoginService","Auth","toaster","$interval","localStorageService"],$("document").ready(function(){$(".login-input").smartTvKeyboard({title:null,defLang:null,defMode:null,layouts:{en:smartTvKeyboardLayouts.enBoxed},type:"inline",openOn:"click focus",onEnter:null,onCancel:null,useDirectEdit:!0,useNavKeys:!0,navKeys:{LEFT:37,UP:38,RIGHT:39,DOWN:40,ENTER:13,EXIT:8,RETURN:10009}})}),angular.module("vietteltv").run(["$templateCache",function($templateCache){$templateCache.put("views/about.html","<p>This is the about view.</p>"),
$templateCache.put("views/main.html",'\x3c!--<div ng-style="{\'opacity\':bgImgCoverOpacity,\'width\':bgImgCoverWidth}" class="bg-img-cover" ng-hide="currentDepth===DEPTH.CATEGORY"></div>--\x3e <div id="menu-container" class="move-container menu-container" ng-show="currentDepth===DEPTH.INDEX"> <div class="logo"></div> <div class="category-menu-header"> <h1 class="category-menu-header-h1" ng-bind-html="focusedMenu.this.name[0].text"></h1> </div> <div class="category-menu-list"> <category-menu-list id="11" title="Chuyên mục"></category-menu-list> </div> <div class="spotlight-overview"> <img ng-src="{{spotlightOverview.bigPhotoUrl}}" alt="" class="spotlight-overview-img"> </div> </div> <div class="home-page"> <div id="move-container" class="move-container overview-container" ng-class="{\'reset-position\':currentDepth===DEPTH.DETAIL || currentDepth===DEPTH.PLAYER}"> <div class="logo" ng-class="{\'logo-fadeIn\':currentDepth !== DEPTH.PLAYER && currentDepth !== DEPTH.DETAIL &&  currentDepthZone !== DEPTH_ZONE.INDEX.CATEGORY,\'logo-fadeOut\':currentDepth === DEPTH.PLAYER || currentDepth === DEPTH.DETAIL ||  currentDepthZone === DEPTH_ZONE.INDEX.CATEGORY}"></div> <div class="spotlight-page" ng-show="currentDepth===DEPTH.INDEX || currentDepth===DEPTH.DETAIL" ng-hide="isForceSpotlightHide && isSpotlightShown !== true" ng-class="{\'spotlight-page-fadeOut\': currentDepthZone!==DEPTH_ZONE.INDEX.SPOTLIGHT,\'spotlight-page-fadeIn\': currentDepthZone===DEPTH_ZONE.INDEX.SPOTLIGHT}" animate-on-change="spotlightOverview.firstTitle"> \x3c!-- <div class=" logo"></div> --\x3e \x3c!-- OVERVIEW --\x3e <div class="overview" ng-class="{ \'spotlight\':currentDepth===DEPTH.INDEX}"> <div class="font-header" ng-bind-html="spotlightOverview.firstTitle"></div> <div class="font-header-small" ng-bind-html="spotlightOverview.secondTitle"></div> </div> \x3c!-- page: SPOTLIGHT  --\x3e <div class="overview desc font-body" ng-show="currentDepth===DEPTH.INDEX " ng-bind-html="spotlightOverview.description"></div> <div class="btn-wrapper"> <div id="btnSpotlightView" focusable="{depth: DEPTH.INDEX,initialFocus: true,name: \'btnView\'}" class="btn btn-gap" ng-class="{ \'btn-view\':true, \'btn-resume\': false}" on-selected="onBtnViewSpotlightSelected($event,spotlightOverview)" on-focused="onBtnViewSpotlightFocused($event,\r\n            $originalEvent)"> <div class="btn-icon"></div> \x3c!--<div class="btn-icon icon-caph icon-caph-view"></div>--\x3e </div> </div> </div> <div class="channel-page" ng-show="currentDepth===DEPTH.INDEX && currentDepthZone===DEPTH_ZONE.INDEX.CHANNEL || (currentOverview.isChannel && currentDepth===DEPTH.PLAYER && lastDepth !== DEPTH.CATEGORY) || isForceChannelInfoShown"> \x3c!--<div class="overview" ng-class="{ \'channel\':currentDepth===DEPTH.INDEX && currentDepthZone===DEPTH_ZONE.INDEX.CHANNEL}">--\x3e <div class="channel-header" ng-class="{\'channel-header-fadein\':isChannelHeaderShown,\'channel-header-fadeout\':!isChannelHeaderShown}"> <div class="overview channel-headline"> <div class="font-header name" ng-bind-html="channelOverview.name"></div> <div class="font-header program1" ng-show="channelOverview.playingProgram.program1">{{channelOverview.playingProgram.program1}} </div> <div class="font-header program2" ng-show="channelOverview.playingProgram.program2">{{channelOverview.playingProgram.program2}} </div> </div> </div> \x3c!-- <ul class="channel-quick-list" ng-class="{\'channel-quick-list-fadein\':isChannelQuicklistShown}" ng-hide="!isPlayerShown">\r\n                <li ng-repeat="itemChannel in allChannelList">\r\n                    <div class="channel-quick-list-item" focusable="{depth: DEPTH.PLAYER}" id="channel-quick-list-item-{{itemChannel.channelId}}" on-focused="onQuickChannelFocused($event, listCategory, itemChannel)" on-selected="onQuickChannelSelected($event, listCategory, itemChannel)">\r\n                        <div class="channel-icon"><img ng-src="{{itemChannel.photoUrl}}" alt=""></div>\r\n                        <div class="channel-name">\r\n                            <div class="channel-name-container">\r\n                                <span class="title program1" ng-show="itemChannel.playingProgram.program1">{{itemChannel.playingProgram.program1}}</span>\r\n                                <span class="title program2" ng-show="itemChannel.playingProgram.program2">{{itemChannel.playingProgram.program2}}</span>\r\n                                <span class="duration">{{itemChannel.playingProgram.time}}</span>\r\n                                <track-progress-bar cur-val=\'{{itemChannel.playingProgram.passedDuration}}\' max-val=\'{{itemChannel.playingProgram.duration}}\'></track-progress-bar>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </li>\r\n\r\n\r\n            </ul> --\x3e \x3c!--<div class="channel-prewatch-wraper">\r\n            <div class="channel-prewatch">\r\n                <div class="loader" ng-show="channelWatchPreviewLoaded !==t rue"></div>\r\n                <video id="videoPrewatch" autoplay ng-hide="channelWatchPreviewLoaded !==t rue"></video>\r\n        </div>--\x3e </div> <div class="category-section" ng-show="(currentDepth===DEPTH.INDEX && currentDepthZone===DEPTH_ZONE.INDEX.CATEGORY) || (currentDepth===DEPTH.DETAIL && isInfoShownInPlayer) || (currentOverview.isChannel && currentDepth===DEPTH.PLAYER)|| (currentDepth===DEPTH.PLAYER && isInfoShownInPlayer) || isForceInfoShown"> \x3c!-- OVERVIEW --\x3e <div class="overview" ng-show="overview.duration"> <div class="font-header">{{overview.firstTitle}}</div> <div class="font-header-small" ng-bind-html="overview.secondTitle"></div> <ul class="short-info"> <li class="short-info-li short-info-1"><span class="short-info-1">HD</span></li> <li class="short-info-li short-info-2"><span class="short-info-2"> | {{overview.duration}} phút | </span></li> <li class="short-info-li short-info-3"><span class="short-info-3">{{overview.country}} | </span></li> <li class="short-info-li short-info-3"><span class="short-info-3">{{overview.genres}}</span></li> </ul> </div> \x3c!-- page: INDEX (OVERVIEW) --\x3e <div class="page" ng-class="{ \'page-fade-in\': currentDepth===DEPTH.INDEX}" ng-show="overview.duration"> <div class="overview desc font-body" ng-bind-html="overview.description.substring(0,300)"></div> </div> <div class="page" ng-class="{ \'page-fade-in\': currentDepth===DEPTH.DETAIL}" ng-show="overview.duration"> \x3c!-- page: DETAIL (OVERVIEW) --\x3e <div class="overview desc font-body" ng-bind-html="overview.description"></div> <div class="vod-directors" ng-bind-html="overview.directors"></div> <div class="vod-actors" ng-bind-html="overview.actors"></div> <div class="vod-detail-btnGroup" ng-show="currentDepth===DEPTH.DETAIL && isPlayDisabled !== true"> <div class="btn-wrapper vod-detail-play" ng-show="currentDepth===DEPTH.DETAIL "> <div focusable="{depth: DEPTH.DETAIL, initialFocus: true,name: \'btnPlay\'}" class="btn btn-gap" ng-class="{ \'btn-play\':true, \'btn-resume\': false}" on-focused="onBtnVodPlayFocusInDetail($event, $originalEvent)" on-selected="onBtnVodPlaySelected($event)"> <div class="btn-icon"></div> \x3c!--<div class="btn-icon icon-caph icon-caph-play"></div>--\x3e </div> </div> <div class="btn-wrapper vod-detail-episode" ng-show="currentDepth===DEPTH.DETAIL && (overview.isSeries || overview.isVodInSeries) && !isEpisodeBtnNotShown"> <div focusable="{depth: DEPTH.DETAIL, name: \'btnEpisode\'}" class="btn btn-gap" ng-class="{ \'btn-vod-episode\':true, \'btn-resume\': false}" on-focused="onBtnVodEpisodeFocusInDetail($event, $originalEvent)" on-selected="selectPlayButton()"> <div class="btn-icon"></div> \x3c!--<div class="btn-icon icon-caph icon-caph-play"></div>--\x3e </div> </div> </div> \x3c!-- page: Related VOD (LIST) --\x3e </div> </div> </div> <div class="related-play-list" ng-class="{ \'related-show\':isRelatedShown, \'related-hide\':!isRelatedShown}" ng-show="isRelatedShown  && isPlayDisabled !== true"> <related-play-list ng-show="currentDepth===DEPTH.DETAIL" title="Nội dung liên quan"></related-play-list> </div> <div class="episode-play-list" ng-class="{ \'episode-show\':isEpisodeShown, \'episode-hide\':!isEpisodeShown}" ng-show="isPlayDisabled !== true"> <episode-play-list ng-show="currentDepth===DEPTH.DETAIL" title="Danh sách tập phim"></episode-play-list> </div> \x3c!-- page: INDEX (LIST)  --\x3e <div class="list-wrapper page" ng-class="{ \'page-fade-in\': currentDepth===DEPTH.INDEX || (currentOverview.isChannel && currentDepth===DEPTH.PLAYER),\'list-page-fadeOut\':isListPageFadeOut , \'list-wrapper-spotlight\': currentDepthZone===DEPTH_ZONE.INDEX.SPOTLIGHT}"> <div id="list-category" class="list-category"> <channel-list id="0" title="Kênh TV"></channel-list> \x3c!--<play-list ng-repeat="category in homeCategoryList" id="{{category.index}}" title="{{category.name}}"></play-list>--\x3e \x3c!--<play-list id="1" title="homeCategoryList"></play-list>--\x3e <play-list id="1"></play-list> <play-list id="2"></play-list> <play-list id="3"></play-list> <play-list id="4"></play-list> <play-list id="5"></play-list> <play-list id="6"></play-list> <play-list id="7"></play-list> <play-list id="8"></play-list> <play-list id="9"></play-list> \x3c!--<play-list-sm id="{{CATEGORY.NUMBERS}}" title="Numbers"></play-list-sm>--\x3e </div> </div> </div> <div class="category-page" ng-cloak ng-show="currentDepth===DEPTH.CATEGORY || (currentOverview.isChannel && currentDepth===DEPTH.PLAYER && lastDepth === DEPTH.CATEGORY) "> <div class="category-page-header"> <div class="overview" ng-show="overview && currentDepthZone===DEPTH_ZONE.CATEGORY.VOD"> <div class="font-header" ng-bind-html="overview.firstTitle"></div> <div class="font-header-small" ng-bind-html="overview.secondTitle"></div> <ul class="short-info" ng-show="overview.contentFormat"> <li class="short-info-li short-info-1"><span class="short-info-1">{{overview.contentFormat}}</span></li> <li class="short-info-li short-info-2"><span class="short-info-2"> | {{overview.duration}} phút | </span></li> <li class="short-info-li short-info-3"><span class="short-info-3">{{overview.country}} | </span></li> <li class="short-info-li short-info-3"><span class="short-info-3">{{overview.genres}}</span></li> </ul> </div> <div class="overview channel" ng-show="overview && currentDepthZone===DEPTH_ZONE.CATEGORY.CHANNEL"> <div class="font-header" ng-bind-html="overview.firstTitle"></div> <div class="font-header-small" ng-bind-html="overview.secondTitle"></div> </div> </div> <div ng-cloak class="w3-sidebar w3-bar-block w3-card-2 category-sidebar" id="mySidebar" ng-class="{ \'collapsed\':isVodCategoryOpened}"> \x3c!--<button class="w3-bar-item w3-button w3-large" onclick="w3_close()">Close &times;</button>--\x3e \x3c!--<a href="#" ng-if="currentDepthZone===DEPTH_ZONE.CATEGORY.CHANNEL" id="sidebar-category-item-{{$index}}" focusable="{depth: DEPTH.CATEGORY,initialFocus: {{$index===0 }},name:category-vod-item-{{$index}}}" data-focusable-group="SIDEBAR_CATEGORY" class="w3-bar-item w3-button"\r\n            ng-repeat="item in sidebarCategories" on-focused="onSidebarCategoryFocused($event,item, $index)" ng-bind-html="item.name"></a>--\x3e <a href="#" id="sidebar-category-item-{{$index}}" focusable="{depth: DEPTH.CATEGORY,initialFocus: {{$index===0 }},name:sidebar-category-item-{{$index}}}" data-focusable-group="SIDEBAR_CATEGORY" class="w3-bar-item w3-button" ng-repeat="item in sidebarCategories" on-focused="onSidebarCategoryFocused($event,item, $index)" ng-bind-html="item.name"></a> </div> <div ng-cloak id="main" class="category-container-wrapper" ng-class="{ \'opened\':isVodCategoryOpened}"> <div class="nav-category-title"> <div class="nav-category-icon"></div> <div class="category-title" ng-bind-html="selectedCategoryMenu"></div> </div> <div class="category-container" ng-cloak> <div id="category-vod-item-{{$index}}" class="item category-vod-item" ng-class="{ \'channel-item\':currentDepthZone===DEPTH_ZONE.CATEGORY.CHANNEL}" ng-repeat="item in vodListByCategory track by $index" focusable="{depth: DEPTH.CATEGORY}\r\n           " data-focusable-group="VOD_LIST_CATEGORY" data-focusable-name="category-vod-item-{{currentDepthZone===DEPTH_ZONE.CATEGORY.CHANNEL?item.channelId:item.id}}" data-focusable-next-focus-left="{{$index%8===0? \'group:SIDEBAR_CATEGORY\':null}}" on-focused="onCategoryVodFocused($event, item, this, $index)" on-blurred="onVodBlurred($event, listCategory, item)" on-selected="onCategoryVodSelected($event, item, $index)"> <div class="loader" ng-show="item.loaded===false"></div> <div class="content" ng-hide="item.loaded===false" style="background: url({{item.photoUrl || \'\'}});-webkit-background-size:100% 100%"> </div> </div> </div> </div> </div>'),$templateCache.put("views/templates/categoryMenuList.html",'<div class="list-area-menu"> <div class="title font-label">{{title}}</div> <caph-list id="list-{{listCategory}}" container-class="list-container" wrapper-class="list-scroll-wrapper" items="item in menuArray" on-scroll-start="onScrollStart($context)" on-scroll-finish="onScrollFinish($context)" mouse-scroll-area-size="40"> <div id="item-{{$index}}" class="item item-playlist" focusable data-focusable-depth="1" data-focusable-group="MENU" data-focusable-next-focus-down="btnView" on-focused="onCategoryMenuFocused($event, listCategory, this,$index)" on-blurred="onCategoryMenuBlurred($event, listCategory, this)" on-selected="onCategoryMenuSelected($event, listCategory, this,$index)"> <div class="loader" ng-show="item.loaded===false"></div> <div class="content" ng-hide="item.loaded===false" style="background: {{item.color || \'\'}};-webkit-background-size:100% 100%"> <div class="playlist-text font-label"> <h2> {{item.this.name[0].text}} </h2> </div> </div> </div> </caph-list> </div>'),$templateCache.put("views/templates/channelList.html",'<div class="list-area channel-list" ng-class="{\'list-fadeout\': currentCategory !== listCategory && currentDepthZone !== DEPTH_ZONE.INDEX.SPOTLIGHT}"> <div class="title font-label" ng-class="{ \'title-opacity\': currentCategory !== listCategory}">{{title}}</div> <caph-list id="list-{{listCategory}}" container-class="channel-list-container" wrapper-class="list-scroll-wrapper" items="item in dataCategory[listCategory]" on-scroll-start="onScrollStart($context)" on-scroll-finish="onScrollFinish($context)" mouse-scroll-area-size="40"> <div id="channel-item-{{item.channelId}}" class="item channel" focusable data-focusable-depth="1" on-focused="onChannelFocused($event, listCategory, this)" on-blurred="onChannelBlurred($event, listCategory, this)" on-selected="onChannelSelected($event, listCategory, item)"> <div class="loader" ng-show="item.loaded===false"></div> <div class="content" ng-hide="item.loaded === false" style="background: url({{item.photoUrl || \'\'}});-webkit-background-size:100% 100%"> </div> </div> </caph-list> </div>'),$templateCache.put("views/templates/episodePlaylist.html",'<div class="list-area"> <div class="title font-label">{{title}} Tập phim</div> <caph-list id="list-episode-vod" container-class="list-container" wrapper-class="list-scroll-wrapper" items="item in episodePlaylist" mouse-scroll-area-size="30"> <div class="item" focusable="{depth: DEPTH.DETAIL}" on-focused="onEpisodeVodFocused($event, CATEGORY.EPISODE_PLAY_LIST, this)" on-selected="onEpisodeVodSelected($event, CATEGORY.EPISODE_PLAY_LIST, this,$index)"> <div class="loader" ng-show="item.loaded === false"></div> <div class="content" ng-hide="item.loaded === false" style="background: url({{item.photoUrl || \'\'}});-webkit-background-size:100% 100%"> <div class="text font-label"> <div class="font-info">{{item.name}}</div> </div> </div> </div> </caph-list> </div>'),$templateCache.put("views/templates/playlist.html",'<div class="list-area" ng-class="{\'list-fadeout\': currentCategory !== listCategory,\'second-category\':currentCategory === 0 && id === 1}"> \x3c!-- opacity 0.2 --\x3e <div class="title font-label" ng-class="{\'title-opacity\': currentCategory !== listCategory}">{{homeCategoryNameList[id-1].name}}</div> <caph-list id="list-{{listCategory}}" loop container-class="list-container" wrapper-class="list-scroll-wrapper" items="item in dataCategory[listCategory]" on-scroll-start="onScrollStart($context)" on-scroll-finish="onScrollFinish($context)" mouse-scroll-area-size="40"> <div id="{{listCategory}}-{{item.id}}" class="item" ng-class="{\'item-blank\': item.isBlank === true}" focusable="{depth: DEPTH.INDEX}" on-focused="onVodFocused($event, listCategory, item, $index,this)" on-blurred="onVodBlurred($event, listCategory, this)" on-selected="onVodSelected($event, listCategory, item, $index)"> <div class="loader" ng-show="item.loaded === false"></div> <div class="content" ng-hide="item.loaded === false" style="background: url({{item.photoUrl || \'\'}});-webkit-background-size:100% 100%"> \x3c!--<div class="text font-label">\r\n                    <div class="font-info">{{item.name}}</div>\r\n                </div>--\x3e </div> </div> </caph-list> </div>'),$templateCache.put("views/templates/playlistSm.html",'<div class="list-area" ng-class="{\'list-fadeout\': currentCategory !== listCategory}"> <div class="title font-label" ng-class="{\'title-opacity\': currentCategory !== listCategory}">{{title}}</div> <caph-list id="list-{{listCategory}}" container-class="list-container" wrapper-class="list-scroll-wrapper" items="item in dataCategory[listCategory]" on-scroll-start="onScrollStart($context)" on-scroll-finish="onScrollFinish($context)" mouse-scroll-area-size="40"> <div id="item-{{$index}}" class="item item-playlist" focusable="{{focusable}}" on-focused="focus($event, listCategory, this)" on-blurred="blur($event, listCategory, this)" on-selected="selected($event, listCategory, this)"> <div class="loader" ng-show="item.loaded === false"></div> <div class="content" ng-hide="item.loaded === false" style="background: url({{item.photo_urls[0].url || \'\'}});-webkit-background-size:100% 100%"> <div class="playlist-text font-label"><div class="font-info">Small Item</div>{{item.name}}</div> </div> </div> </caph-list> </div>'),$templateCache.put("views/templates/relatedPlaylist.html",'<div class="list-area"> <div class="title font-label">{{title}} Nội dung liên quan</div> <caph-list id="list-related-vod" container-class="list-container" wrapper-class="list-scroll-wrapper" items="item in relatedPlaylist" mouse-scroll-area-size="30"> <div class="item" focusable="{depth: DEPTH.DETAIL}" on-focused="onRelatedVodFocused($event, CATEGORY.RELATED_PLAY_LIST, item,$index)" on-selected="onRelatedVodSelected($event, CATEGORY.RELATED_PLAY_LIST, item,$index)"> <div class="loader" ng-show="item.loaded === false"></div> <div class="content" ng-hide="item.loaded === false" style="background: url({{item.photoUrl || \'\'}});-webkit-background-size:100% 100%"> <div class="text font-label"> \x3c!--<div class="font-info">{{item.name}}</div>{{item.name}}</div>\r\n            </div>--\x3e </div> </div></div></caph-list> </div>')}]);